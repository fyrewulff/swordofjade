#Quest HSI
#for all that other scripting greatness
#
#oh yes.
#MORE SCRIPTING
#WONDERFUL
#I HATE SARCASM :(
#</stockohrpublichumor>

define script (autonumber,jadeup,2,2,1)
define script (autonumber,wpalout,1,0)
define script (autonumber,wpalin,1,0)
define script (autonumber,heroclothes,0)
define script (160,saveinnkeeper,0)
define script (autonumber,killbutter,0)
define script (161,childwantsicon,0)
define script (162,fightevil,0)
define script (163,noshot,0)
define script (164,bandithuntmayor,0)
define script (autonumber,bandithuntbandits,0)
define script (165,weepingwoman,0)
define script (autonumber,jigfool,0)
define script (166,thehorror,0)
define script (autonumber,jighorror,0)
define script (167,jadedwarrior,0)
define script (autonumber,forestpasswobbler,0)
define script (168,hopelessromantic,0)
define script (169,waterjar,0)
define script (170,fralingraves,0)
define script (171,fralininn,0)
define script (172,fralinicon,0)
define script (173,fralinitem,0)
define script (174,fralinstat,0)
define script (175,fralinavis,0)
define script (176,itemresttrigger,0)
define script (177,fralintrader,0)
define script (178,avistrigger,0)
define script (179,thiefgetaway,0)
define script (180,piratebooty,1,0)
define script (181,dackenmorph,0)
define script (autonumber,dackenmorph1,0)
define script (autonumber,dackenmorph2,0)
define script (autonumber,dackenmorph3,0)
define script (autonumber,dackenmorph4,0)
define script (182,fralinmazing,0)
define script (autonumber,fralinmanx,0)
define script (autonumber,fralinmanx1,0)
define script (autonumber,fralinmanx2,0)
define script (autonumber,fralinmanx3,0)
define script (183,lazyfarmer,0)
define script (184,ghostatinn,0)
define script (185,badadvice,0)
define script (autonumber,badadvice2,0)
define script (186,buybeer,0)
define script (187,fralinindoorload,0)
define script (188,gitlockdoor,0)
define script (189,gitlehtreasure,0)
define script (190,gitlehautoload,1,0)
define script (191,gitlehdrain,0)
define script (192,shhsomeonecoming,0)
define script (193,adlezinn,0)
define script (194,adlezicon,0)
define script (195,adlezitem,0)
define script (196,adleztrainer,0)
define script (197,adleztrader,0)
define script (198,adlezavis,1,0)
define script (199,adlezshop,0)
define script (200,naivedreams,0)
define script (201,elusiveprey,0)
define script (202,minimaleffort,0)
define script (203,storytime,1,0)
define script (204,dreamwork,0)
define script (205,wanderingwiseman,0)
define script (206,annoyingknave,0)
define script (207,oreget,0)
define script (208,balancedangle,0)
define script (209,bunnywhistle,0)
define script (210,yakkityyak,0)
define script (211,fortuneteller,0)
define script (212,cabinload,0)
define script (213,keltaninn,0)
define script (214,keltanicon,0)
define script (215,keltanitem,0)
define script (216,keltantrainer,0)
define script (217,keltantrader,0)
define script (218,keltanavis,0)
define script (219,missingperson,0)
define script (220,aspiringsinger,0)
define script (221,iconcollector,0)
define script (autonumber,iconcollector2,0)
define script (222,jadeneurosis,0)
define script (223,haystackneedle,0)
define script (224,refineore,0)
define script (225,keltanload,0)
#define script (226,raiderbattles,1,0)
define script (227,dun3locks,0)
define script (228,dun3chests,0)
define script (autonumber,archsword,0)
define script (autonumber,fyrblade,0)
define script (autonumber,vicehand,0)
define script (autonumber,manxrunsaway,0)
define script (229,pleasurebusiness,1,0)
define script (230,masterdao,0)
define script (autonumber,daodog,0)
define script (autonumber,daomi,0)
define script (autonumber,daojo,0)
define script (autonumber,daopy,0)
define script (autonumber,daonoicon,0)
define script (autonumber,daodogfight,0)
define script (autonumber,daodogafter,0)
define script (autonumber,daomifight,0)
define script (autonumber,daomiafter,0)
define script (autonumber,daojofight,0)
define script (autonumber,daojoafter,0)
define script (autonumber,daopyfight,0)
define script (autonumber,daopyafter,0)
define script (231,bountycollect,0)
define script (autonumber,pybounty1,3,0,0,0)
define script (autonumber,pybounty2,0)
define script (autonumber,pybounty3,3,0,0,0)
define script (232,rebuildcastle,0)
define script (233,worldending,1,0)
define script (autonumber,worldending1,0)
define script (autonumber,worldending2,0)
define script (autonumber,worldending3,0)
define script (autonumber,worldending4,0)
define script (autonumber,worldending5,1,0)
define script (234,mazinggo,0)
define script (autonumber,zing1,0)
define script (autonumber,zing2,0)
define script (autonumber,zing3,0)
define script (autonumber,zing4,0)
define script (autonumber,zing5,0)
define script (235,gamblegame,0)
define script (236,falsejade,0)
define script (237,lootcyport,0)
define script (autonumber,lootcyport1,0)
define script (autonumber,lootcyport2,0)
define script (autonumber,lootcyport3,0)
define script (238,etcetera,1,0)
define script (239,wanderingjoke,0)
define script (240,nix,0)
define script (autonumber,jignix,0)
define script (autonumber,nix1,0)
define script (autonumber,nix2,0)
define script (autonumber,nix3,0)
define script (241,fedoraharmtile,0)
define script (242,cyinn,0)
define script (243,cyitem,0)
define script (244,cyicona,0)
define script (245,cyiconb,0)
define script (246,cytrainer,0)
define script (247,cytrader,0)
define script (248,cyavis,0)
define script (249,daodeath,0)
define script (250,wobblerbounty,0)
define script (251,cycomauto,0)
define script (252,pecu,0)
define script (253,castlepayment,0)
define script (254,cyportnorthauto,0)
define script (255,rorcicona,0)
define script (256,rorciconb,0)
define script (257,cyportmisc,1,0)
define script (258,cycentralautoload,0)
define script (259,cysignposts,0)
define script (260,rorcbridge,0)
define script (261,rorcbusted,0)
define script (262,rorcladder,0)
define script (263,rorcdiver,0)
define script (264,rorcspunk,0)
define script (265,rorcmap,0)
define script (266,rorcten,0)
define script (267,rorckeeljack,1,0)
define script (268,finaldao,0)
define script (269,mysterious,0)
define script (270,rorcitems,0)
define script (271,shodachests,0)
define script (272,shodadoors,0)
define script (273,scarfsixone1,0)
define script (274,scarfsixone2,0)
define script (275,scarfsixone3,0)
define script (276,scarfsixone4,0)
define script (277,scarfsixone5,0)
define script (278,scarf2end,0)
define script (autonumber,whisper,0)
define script (autonumber,lavascarfintro,0)
define script (279,lavascarf,0)
define script (280,scarfwanderer,0)
define script (autonumber,exitcave,0)
define script (281,prematurescarf,0)
define script (282,meetbackup,0)
define script (283,badfeeling,0)
define script (284,badhmm,0)
define script (autonumber,thisisit,0)
define script (autonumber,thisisit1,0)
define script (autonumber,thisisit2,0)
define script (autonumber,thisisit3,0)
define script (285,itisover,0)
define script (286,goodbyescarf,0)
define script (287,rorcsave,0)
define script (288,rorcavis,0)
#define script (289,fpoobat,1,0)
#define script (290,fpanbat,1,0)
#define script (291,fpnibat,1,0)
#define script (292,fpmonbat,1,0)
define script (293,hunt,0)
define script (autonumber,shodaspunk,0)
define script (321,wobblerloot,0)
define script (322,cybooks,0)
define script (323,limeverdant,0)
define script (324,charfyreicon,0)
define script (325,rorctrader,0)
define script (326,unknowntombautoload,0)
define script (327,broinn,0)
define script (328,bunnyhophop,0)
define script (329,clockitem,0)
define script (autonumber,intropolish,0)
define script (autonumber,intropolish1,0)
define script (autonumber,intropolish2,0)
define script (autonumber,intropolish3,0)
define script (autonumber,intropolish4,0)
define script (autonumber,intropolish5,0)
define script (330,partytime,1,0)
define script (331,nixescapefinal,0)
define script (332,partydoor,0)
define script (333,keltanindoorload,0)
define script (334,fralinautoload,0)
define script (335,secrettoeveryone,0)
define script (autonumber,hithaggard,0)
define script (autonumber,npcfaceplayer,1,0)
define script (336,skillitemtrigger,0)
define script (337,scarf1auto,0)

##############################
script, jadeup, howmany, time, begin

wpalout(time)
set variable(jadecounter,jadecounter+howmany)
set variable(jadecounter2,jadecounter2+(howmany*4))
wpalin(time)

end
###

############################
script, wpalout, time, begin
if (time<>0) then(
tweak palette (5,5,5)
update palette
wait (time)
tweak palette (10,10,10)
update palette
wait (time)
tweak palette (20,20,20)
update palette
wait (time)
tweak palette (40,40,40)
update palette
wait (time)
tweak palette (111,111,111)
update palette
wait (time)
)
end
###

############################
script, wpalin, time, begin
if (time<>0) then(
reset palette
tweak palette (40,40,40)
update palette
wait (time)
reset palette
tweak palette (20,20,20)
update palette
wait (time)
reset palette
tweak palette (10,10,10)
update palette
wait (time)
reset palette
tweak palette (5,5,5)
update palette
wait (time)
reset palette
update palette
)
end
###

##########################
script, heroclothes, begin

#old old old
#may not set correctly
#if dogero has a different picture set
#if(get hero picture(find hero(0))==1) then(
#alter npc(1,NPCstat:picture,12)
#alter npc(2,NPCstat:picture,13)
#alter npc(3,NPCstat:picture,138)
#)
#if(get hero picture(find hero(0))==229) then(
#alter npc(1,NPCstat:picture,232)
#alter npc(2,NPCstat:picture,234)
#alter npc(3,NPCstat:picture,138)
#)
#if(get hero picture(find hero(0))==230) then(
#alter npc(1,NPCstat:picture,233)
#alter npc(2,NPCstat:picture,235)
#alter npc(3,NPCstat:picture,236)
#)

#winter clothes
if(check tag(174)) then(
	alter npc(1,NPCstat:picture,233)
	alter npc(2,NPCstat:picture,235)
	alter npc(3,NPCstat:picture,236)
)
else(
	#desert clothes
	if(check tag(123)) then(
		alter npc(1,NPCstat:picture,232)
		alter npc(2,NPCstat:picture,234)
		alter npc(3,NPCstat:picture,138)
	)
	#starter clothes
	else(
		alter npc(1,NPCstat:picture,12)
		alter npc(2,NPCstat:picture,13)
		alter npc(3,NPCstat:picture,138)
	)
)

end
###

#################################
script, saveinnkeeper, begin
suspend player
suspend npcs
set tag(8,1)

if(check tag(211)==false) then(
palout(1)
set tag(211,1)
teleport to map (currentmap+4,5,25)
stop song
alter npc(1,NPCstat:picture,209)
alter npc(1,NPCstat:palette,50)
alter npc(2,NPCstat:picture,210)
alter npc(2,NPCstat:palette,62)
alter npc(3,NPCstat:picture,211)
alter npc(3,NPCstat:palette,126)
set npc position(1,3,22)
set npc position(2,2,21)
set npc position(3,4,21)
set npc direction(1,up)
set npc direction(2,right)
set npc direction(3,left)
alter npc(5,NPCstat:picture,24)
pan camera(south,0,0)
wait(1)
palin(1)

wait(5)
variable(nx)
variable(ny)
set variable(nx,npc pixel x(5))
set variable(ny,npc pixel y(5))
variable(i)
for(i,1,6,1) do(
put npc(5,nx--1,ny)
wait(1)
put npc(5,nx+1,ny)
wait(1)
)
put npc(5,nx,ny)

wait(3)
jig npc(2)
tb(2369)
jig npc(3)
tb(2370)
alter npc(5,NPCstat:picture,21)
jig npc(5)
tb(2371)
wait(2)
set npc direction(3,down)
set npc direction(1,right)
wait(2)
set npc direction(1,down)
set npc direction(2,down)
play song(15)
wait(15)
jig npc(1)
tb(2372)
wait(2)
tb(2373)

if(check tag(213)) then(
wait(15)
jig npc(1)
tb(2374)
jig npc(3)
if(check tag(45),or,check tag(46)) then(tb(2376))
else(tb(2375))
jig npc(1)
tb(2377)

battleflash
ff(110,0,false)
stop song
set npc position(1,0,1)
set npc position(2,1,1)
set npc position(3,2,1)

pan camera(north,3,2)
wait for camera

set hero speed(0,2)
walk hero(0,up,4)
wait for hero(0)
walk hero(0,left,1)
wait for hero(0)
set hero frame(0,0)
jig hero(0)
tb(2378)
wait(5)
for(i,1,3,1) do(
put npc(5,nx--1,ny)
wait(1)
put npc(5,nx+1,ny)
wait(1)
)
put npc(5,nx,ny)
alter npc(5,NPCstat:picture,24)
for(i,1,3,1) do(
put npc(5,nx--1,ny)
wait(1)
put npc(5,nx+1,ny)
wait(1)
)
put npc(5,nx,ny)
tb(2382)
wait(10)
tb(2383)

palout(10)
camera follows hero(0)
teleport to map(currentmap+1,5,22)
set tag(6,0)
set tag(3,1)
set variable(hour,morningtime)
set hero direction(0,left)
set npc position(5,4,22)
set npc direction(5,right)
set hp
set hero speed(0,hspeed)
innrest
wait(1)
palin(10)

wait(10)
jig npc(5)
tb(2384)
tb(2385)

jig hero(0)
if(check tag(19)) then(
tb(2386)
)
if(check tag(20)) then(
tb(2387)
)
if(check tag(21)) then(
tb(2388)
jig npc(5)
tb(2389)
wait(10)
)
if(check tag(22)) then(
tb(2390)
)

jig npc(5)
tb(2391)
jig hero(0)
tb(2392)
alter npc(5,NPCstat:display text,0)
alter npc(5,NPCstat:script,0)
jadeup(2,1)
wait(2)
set tag(8,0)
save game
wait(2)
alter npc(5,NPCstat:display text,2391)
)
else(
wait(2)
set hero direction(0,right)
wait(2)
walk hero(0,down,1)
wait for hero(0)
palout(1)
set tag(212,1)
camera follows hero(0)
teleport to map (currentmap--4,94,14)
palin(1)
)
)
else(
palout(1)
teleport to map (currentmap+4,5,25)
palin(1)
)

set tag(8,0)
resume npcs
resume player
end
###

#########################
script, killbutter, begin
suspend player
suspend npcs
suspend obstruction

set tag(214,1)
pan camera (up,6,10)
walk hero (0,up,4)
alter npc(23,NPCstat:picture,10)
alter npc(23,NPCstat:palette,17)
alter npc(22,NPCstat:picture,212)
alter npc(22,NPCstat:palette,101)
set npc direction(22,down)
set npc direction(23,down)
set npc position(23,26,29)
set npc position(22,27,30)
wait for camera
reset palette
tweak palette (-3,-3,4)
update palette
pan camera (up,6,10)
wait for camera
wait for hero (0)

stop song

variable(nx)
variable(ny)
set variable(nx,npc pixel x(23))
set variable(ny,npc pixel y(23))
variable(i)
for(i,1,6,1) do(
put npc(23,nx--1,ny)
wait(1)
put npc(23,nx+1,ny)
wait(1)
)
put npc(23,nx,ny)
play song(15)
tb(4409)

set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
walk npc(1,right,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
wait(2)
jig hero(0)
tb(4410)
wait(2)
jig npc(1)
tb(4411)
wait(3)
set hero direction(0,right)
wait(4)
jig hero(0)
show text box(4412)
wait(5)
set hero direction(0,up)
wait for text box
wait(3)
jig npc(1)
tb(4413)
set variable(nx,npc pixel x(22))
set variable(ny,npc pixel y(22))
for(i,1,3,1) do(
put npc(22,nx--1,ny)
wait(1)
put npc(22,nx+1,ny)
wait(1)
)
put npc(22,nx,ny)
tb(4414)
jig hero(0)
tb(4415)
set npc direction(1,left)
jig npc(1)
tb(4416)
wait(3)
set hero direction(0,right)
wait(15)
set hero frame(0,1)
wait(4)
set hero frame(0,0)
tb(4417)
jig npc(1)
tb(4418)
set hero direction(0,up)
set npc direction(1,up)

battleflash
set party in
ff(111,0,false)
stop song
set npc position(22,0,0)
swap by position(find hero(0),0)
set hero speed(0,4)
reset palette
tweak palette (-3,-3,4)
update palette
wait(2)
walk hero(0,up,1)
walk npc(1,left,1)
wait for hero(0)
walk hero(0,up,3)
walk npc(1,up,3)
wait for hero(0)
walk npc(1,left,1)
set hero frame(0,0)
set hero direction(0,left)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)

jig npc(23)
jig npc(23)
tb(4419)
jig hero(0)
tb(4420)
wait(5)
set npc direction(23,right)
wait(10)
jig npc(23)
tb(4421)
wait(3)
set hero direction(0,down)
wait(3)
jig hero(0)
tb(4422)

palout(5)
suspend npcs
camera follows hero(0)
teleport to map(5+poff,6,57)
wait(1)
pan camera(south,0,0)
set hero position(0,7,61)
set npc position(1,7,61)
alter npc(6,NPCstat:picture,5)
alter npc(7,NPCstat:picture,10)
set npc position(6,6,56)
set npc position(7,7,61)
alter npc(6,NPCstat:movespeed,2)
alter npc(7,NPCstat:movespeed,4)
set hp
wait(1)
palin(5)

wait(5)
walk npc(7,up,4)
walk npc(6,down,1)
wait for npc(7)
set npc frame(7,0)
set npc direction(7,left)
wait fo rnpc(6)
set npc frame(6,0)
set npc direction(6,right)
jig npc(6)
show text box(4423)
wait(2)
set hero speed(0,4)
walk hero(0,up,2)
walk npc(1,up,1)
wait for npc(1)
walk npc(1,right,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
walk npc(1,up,1)
wait for npc(1)
set npc frame(1,0)
wait for text box
jig npc(7)
tb(4424)

wait(3)
jadeup(2,1)
wait(3)

jig hero(0)
tb(4425)
wait(4)
set npc direction(6,down)
wait(2)
jig npc(6)
tb(4426)
jig hero(0)
tb(4427)
jig npc(6)
tb(4428)

palout(1)
camera follows hero(0)
teleport to map(1+poff,87,43)
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
wait(1)
palin(1)

wait(15)
set npc position(1,87,42)
walk npc(1,down,1)
wait for npc(1)
set hero position(0,87,42)
walk npc(1,right,1)
walk hero(0,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait(3)
set npc direction(1,left)
wait(3)
jig npc(1)
tb(4429)
wait(2)
set hero direction(0,right)
wait(2)
jig hero(0)
tb(4430)
jig npc(1)
tb(4431)
wait(25)
jig hero(0)
stop song
tb(4432)
jig npc(1)
tb(4433)
play song(32)
set npc direction(1,down)
wait(2)
set npc direction(1,right)
wait(2)
jig npc(1)
tb(4434)
set hero picture(0,81)
jig hero(0)
tb(4435)
alter npc(1,NPCstat:picture,80)
set npc direction(1,down)
wait(2)
set npc direction(1,left)
jig npc(1)
tb(4436)
jig hero(0)
set hero direction(0,down)
tb(4437)
wait(2)
alter npc(1,NPCstat:picture,82)
wait(2)
tb(4438)
set hero speed(0,2)
walk hero(0,down,3)
wait(15)
alter npc(1,NPCstat:picture,76)
show text box(4439)
jig npc(1)
jig npc(1)
wait for hero(0)
set hero frame(0,0)
wait for text box
wait(5)
set hero direction(0,right)
wait(2)
se thero direction(0,up)
jig hero(0)
show text box(4440)
wait(2)
alter npc(1,NPCstat:picture,12)
set npc direction(1,down)
wait for text box
jig npc(1)
tb(4441)

palout(2)
set hero picture(0,1)
set hero speed(0,hspeed)
set party in
camera follows hero(0)
teleport to map(9+poff,77,146)
set hero direction(0,down)
wait(1)
palin(2)

set tag(8,0)
save game

resume obstruction
resume npcs
resume player
end
###

#############################
script, childwantsicon, begin
suspend player
suspend npcs
suspend obstruction

if(current map==1,or,current map==2,or,current map==3,or,current map==4) then(
	jig npc(5)
	if(check tag(20)) then(tb(4443))
	else(tb(4442))
	jig hero(0)
	tb(4444)
	jig npc(5)
	tb(4448)

	#variable(canpay)
	#set variable(canpay,pay money(3))

	if(check tag(215)) then(
		if(pay money(3)) then(
			wait(3)
			tb(4449)
			jig npc(5)
			tb(4450)

			if(herox(0)==118) then(
				walk npc(5,down,1)
				wait for npc(5)
				walk npc(5,left,1)
				wait for npc(5)
			)
			else(
				walk npc(5,left,1)
				wait for npc(5)
				walk npc(5,down,1)
				wait for npc(5)
			)
			walk npc(5,down,3)
			show text box(4451)
			wait for npc(5)
			walk npc(5,right,4)
			wait for npc(5)
			walk npc(5,up,1)
			wait for npc(5)
			set npc position(5,0,0)
			set tag(217,1)
			set tag(710,1)
			wait for text box
		)

		#don't have enough money
		else(
			jig npc(5)
			tb(6498)
		)
	)

	if(check tag(216)) then(
		jig npc(5)
		tb(4460)
		jig hero(0)
		tb(4461)
		jig npc(5)
		tb(4465)
		if(herox(0)==118) then(
			walk npc(5,down,1)
			wait for npc(5)
			walk npc(5,left,1)
			set hero direction(0,down)
			wait for npc(5)
		)
		else(
			walk npc(5,left,1)
			set hero direction(0,left)
			wait for npc(5)
			walk npc(5,down,1)
			wait for npc(5)
			set hero direction(0,down)
		)
		walk npc(5,down,3)
		wait for npc(5)
		walk npc(5,right,4)
		wait for npc(5)
		walk npc(5,up,1)
		wait for npc(5)
		set npc position(5,0,0)
		set tag(217,1)
		wait(10)
		jig hero(0)
		tb(4466)
	)
)

if(current map==5,or,current map==6,or,current map==7,or,current map==8) then(
	if(check tag(218)==false) then(
		jig npc(8)
		tb(4470)
		jig hero(0)
		tb(4471)
		jig npc(8)
		tb(4475)
		jig hero(0)
		tb(4476)
		jig npc(8)
		tb(4480)
		wait(3)
		jadeup(2,1)
		wait(3)
		set tag(218,1)
	)
	else(
		tb(6486)
	)
)

if(current map==9,or,current map==10,or,current map==11,or,current map==12) then(
	if(check tag(218)==false) then(
		variable(rand)
		set variable(rand,random(0,3))
		tb(4452+rand)
		get item(104+rand)
		jig hero(0)
		tb(4456)
		set tag(218,1)
	)
	else(
		tb(4456)
	)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, fightevil, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(223)) then(
jig npc(6)
jig npc(6)
tb(4500)
)

if(check tag(219),and,check tag(221)==false) then(
jig hero(0)
wait(5)
set npc direction(6,left)
wait(2)
tb(4482)
wait(6)
alter npc(6,NPCstat:picture,214)
if(herox(0)==npcx(6)) then(set npc direction(6,down))
wait(3)
jig npc(6)
tb(4483)
jig hero(0)
tb(4484)
jig npc(6)
tb(4488)
tb(4489)
wait(5)
jig hero(0)
tb(4490)
wait(3)
set npc frame(6,1)
wait(4)
set npc frame(6,0)
wait(3)
tb(4494)

if(check tag(220)) then(
jig hero(0)
tb(4501)
jig npc(6)
tb(4505)

palout(1)
set hero position(0,104,14)
set hero direction(0,up)
set npc position(7,104,12)
set npc direction(7,down)
set npc frame(7,0)
set tag(222,1)
wait(15)
palin(1)

wait(10)
jig npc(7)
tb(4506)
jig hero(0)
tb(4507)
jig npc(7)
tb(4513)
jig hero(0)
tb(4514)

battleflash
if(check tag(4)) then(ff(112,0,false))
if(check tag(5)) then(ff(113,0,false))
if(check tag(3)) then(ff(114,0,false))

wait(1)
jig npc(7)
tb(4518)
walk npc(7,right,1)
wait(3)
show text box(4519)
wait for npc(7)
walk npc(7,down,1)
wait for npc(7)
set npc frame(7,0)
wait(2)
set npc frame(7,1)
wait(2)
set npc frame(8,1)
wait(2)
set npc frame(7,0)
wait(2)
set npc frame(8,0)
wait for text box
wait(4)
set npc direction(7,right)
wait(10)
jig npc(7)
tb(4520)
jig npc(8)
tb(4521)
wait(12)
set npc direction(7,down)
wait(5)
jig npc(7)
tb(4522)
wait(3)
jadeup(2,1)
wait(3)
)

if(check tag(221),and,check tag(223)==false) then(
jig hero(0)
tb(4495)
wait(3)
set npc frame(6,1)
wait(4)
set npc frame(6,0)
wait(3)
tb(4499)
set npc direction(6,left)
alter npc(6,NPCstat:picture,215)
wait(3)
set npc direction(6,down)
set tag(223,1)
)

)

if(check tag(219)==false) then(
jig npc(6)
jig npc(6)
tb(4481)
set tag(219,1)
)

resume obstruction
resume npcs
resume player
end
###

#####################
script, noshot, begin
suspend player
suspend npcs
suspend obstruction

#at forest pass and have read first text box
if(check tag(227),and,(currentmap==9,or,currentmap==10,or,currentmap==11,or,currentmap==12)) then(
	#if did not interrupt, he will always say this
	if(check tag(228)) then(
		jig npc(5)
		tb(4541)
	)
	#time to interrupt him
	else(
		jig npc(5)
		tb(4528)
		if(npcx(5)<>herox(0)) then(
			walk hero(0,down,1)
			wait for hero(0)
			walk hero to x(0,npcx(5))
			wait for hero(0)
			set hero direction(0,up)
		)
		jig hero(0)
		tb(4529)

		jig npc(5)
		tb(4533)
		jig npc(5)
		tb(4534)

		if(check tag(225)==false) then(
			jig npc(5)
			tb(4535)
			jig npc(5)
			tb(4536)
		)
		if(check tag(225)==false) then(
			jig npc(5)
			tb(4537)
			jig npc(5)
			tb(4538)
		)
		if(check tag(225)==false) then(
			jig npc(5)
			tb(4539)
			jig npc(5)
			tb(4540)
			set tag(228,1)
		)

		#interrupted him
		if(check tag(225)) then(
			jig hero(0)
			tb(4542)
			jig npc(5)
			tb(4546)
			jig npc(5)
			tb(4547)
			tb(4548)
			jig npc(5)
			tb(4617)
			jig hero(0)
			tb(4549)
			jig npc(5)
			tb(4559)

			variable(nx)
			variable(ny)
			set variable(nx,npc pixel x(5))
			set variable(ny,npc pixel y(5))
			#variable(i)
			#for(i,1,4,1) do(
			#put npc(5,nx+random(-1,1),ny+random(-1,1))
			#wait(1)
			#)
			wait(1)
			put npc(5,nx,ny+1)
			wait(1)
			put npc(5,nx,ny--1)
			wait(1)
			put npc(5,nx,ny)
			wait(1)
			alter npc(5,NPCstat:picture,216)
			set npc direction(5,down)
			wait(5)
			play song(69)
			jig npc(5)
			tb(4560)
			wait(3)
			walk npc(5,left,1)
			wait for npc(5)
			walk npc(5,down,1)
			set hero direction(0,left)
			wait for npc(5)
			walk npc(5,down,1)
			set hero direction(0,down)
			wait for npc(5)
			set npc frame(5,0)
			wait(15)
			jig npc(5)
			tb(4561)
			wait(5)
			tb(4562)
			wait(3)
			set npc direction(5,right)
			wait(3)
			set npc direction(5,up)
			wait(3)
			jig npc(5)
			tb(4563)
			set npc direction(5,left)
			wait(2)
			walk npc(5,left,9)
			wait(15)
			set hero direction(0,left)
			wait for npc(5)
			wait(3)
			stop song
			jadeup(2,1)
			wait(3)
			play song(70)
			set tag(226,1)
		)
	)
)
else(
	#at forest pass and have NOT read first text box
	if(check tag(227)==false,and,(currentmap==9,or,currentmap==10,or,currentmap==11,or,currentmap==12)) then(
		jig npc(5)
		tb(4527)
		set tag(227,1)
	)
)

if(currentmap==37,or,currentmap==38,or,currentmap==39,or,currentmap==40) then(
	if(check tag(228)) then(
		jig npc(4)
		tb(6487)
	)
	else(
		stop song
		jig npc(4)
		tb(4564)
		if(npcy(4)<>heroy(0)) then(
			walk hero(0,right,1)
			wait for hero(0)
			set npc direction(4,right)
			walk hero to y(0,npcy(4))
			wait for hero(0)
			set hero direction(0,left)
		)
		hero clothes
		pright
		wait(5)
		jig hero(0)
		play song(69)
		tb(4565)
		jig npc(4)
		tb(4566)
		wait(5)
		jig npc(4)
		tb(4567)
		wait(3)
		variable(rand)
		set variable(rand,random(0,3))
		tb(4568+rand)
		get item(61+rand,2)
		wait(3)
		jig hero(0)
		tb(4572)
		jig npc(4)
		tb(4573)
		wait(3)
		jadeup(2,1)
		wait(3)
		set tag(228,1)
		ppright
	)
)

resume obstruction
resume npcs
resume player
end
###

##############################
script, bandithuntmayor, begin
suspend player
suspend npcs
suspend obstruction

#finished
if(check tag(230)) then(
tb(6491)
)

#after init
if(check tag(229),and,check tag(230)==false) then(
	tb(4598)
)

#init
if(check tag(229)==false,and,check tag(230)==false) then(
tb(4575)
jig hero(0)
tb(4576)
if(herox(0)==npcx(9)) then(
set npc direction(9,right)
wait(3)
set npc direction(9,down)
)
if(herox(0)>>npcx(9)) then(
set npc direction(9,right)
)
jig npc(9)
tb(4580)
wait(5)
jig npc(9)
tb(4581)
jig npc(9)
tb(4618)
tb(4582)
tb(4583)
jig npc(9)
tb(4584)
jig hero(0)
tb(4585)
jig npc(9)
tb(4589)
tb(4590)
wait(5)
jig npc(9)
tb(4591)
jig hero(0)
tb(4592)
jig npc(9)
tb(4596)
tb(6490)
wait(5)
jig npc(9)
tb(4597)
wait(3)
set npc direction(9,right)
wait(3)
set npc direction(9,up)
set tag(229,1)
)

resume obstruction
resume npcs
resume player
end
###

################################
script, bandithuntbandits, begin
suspend player
suspend npcs
suspend obstruction

pan camera(down,9,20)
set hero speed(0,10)
walk hero(0,down,9)
variable(goon1)
variable(goon2)
set variable(goon1,create npc(6,94,55,up))
set variable(goon2,create npc(6,95,55,up))
wait for hero(0)
set hero speed(0,hspeed)
set hero frame(0,0)
camera follows hero(0)

play song(15)
jig npc(goon1)
tb(4599)
jig npc(goon2)
if(check tag(45),or,check tag(46)) then(tb(4600))
else(tb(4601))
jig npc(goon1)
if(check tag(45),or,check tag(46)) then(tb(4602))
else(tb(4603))
set npc direction(goon2,left)
jig npc(goon2)
if(check tag(45),or,check tag(46)) then(tb(4604))
else(tb(4605))
set npc direction(goon1,right)
jig npc(goon1)
tb(4606)
wait(2)
set npc direction(goon1,up)
jig npc(goon1)
show text box(4607)
wait(2)
set npc direction(goon2,up)
wait for text box
set party out
swap by position(find hero(0),0)
jig hero(0)
if(check tag(45),or,check tag(46)) then(tb(4609))
else(tb(4608))
set npc direction(goon2,left)
jig npc(goon2)
tb(4610)
set npc direction(goon2,up)
jig npc(goon2)
tb(4611)

set tag(10,0)
palout(1)
set hero position(0,34,68)
set hero direction(0,up)
create npc(7,34,66,right)
set npc position(goon1,32,65)
set npc position(goon2,36,66)
set npc direction(goon1,down)
set npc direction(goon2,down)
create npc(6,31,67,right)
create npc(6,33,70,up)
create npc(6,37,68,left)
alter npc(29,NPCstat:picture,202)
alter npc(29,NPCstat:palette,13+poff)
set npc position(29,35,66)
wait(15)
palin(1)

wait(15)
jig npc(7)
tb(4612)
tb(4613)
wait(5)
jig hero(0)
tb(4614)
wait(3)
jig npc(7)
tb(4615)
jig hero(0)
tb(4616)

stop song
battleflash
set party in
ff(91+poff,0,false)
stop song
set tag(230,1)
wait(1)
pan camera(south,0,0)
set hero speed(0,2)
walk hero(0,up,3)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,right)
wait(10)

palout(2)
set tag(10,1)
set hero speed(0,hspeed)
camera follows hero(0)
teleport to map(5+poff,5,95)
set party out
swap by position(find hero(0),0)
set hero direction(0,up)
set npc position(9,5,93)
set npc direction(9,up)
wait(15)
palin(2)

wait(10)
set npc direction(9,left)
wait(3)
set npc direction(9,down)
wait(3)
jig npc(9)
tb(4619)
alter npc(1,NPCstat:picture,202)
alter npc(1,NPCstat:palette,13+poff)
wait(2)
set npc position(1,5,94)
wait(10)
set npc frame(9,1)
wait(4)
set npc frame(9,0)
wait(2)
tb(4620)
wait(5)
jig npc(9)
tb(4621)
tb(4622)
wait(5)
jig npc(9)
tb(4623)
wait(3)
jig hero(0)
if(check tag(45),or,check tag(46)) then(tb(4625))
else(tb(4624))
wait(3)
jadeup(3,1)
wait(3)
jig hero(0)
tb(4626)

palout(1)
show backdrop(0)
wait(1)
palin(1)
wait(5)
tb(4627)
wait(5)
palout(1)
show map
get money(30)
set party in
teleport to map(1+poff,105,55)
set hero direction(0,down)
wait(1)
palin(1)

resume obstruction
resume npcs
resume player
end
###

###########################
script, weepingwoman, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(231)==false,and,check tag(233),and,currentmap==3) then(
fade screen out(20,20,20)
walk hero(0,down,1)
wait for hero(0)
set hero direction(0,up)
create npc(5,herox(0),heroy(0)--1,left)
set tag(231,1)
wait(1)
fade screen in

wait(15)
jig fool
tb(4634)
jig hero(0)
tb(4635)
jig fool
tb(4639)
wait(10)
jig fool
tb(4640)
jig fool
tb(4641)
jig fool
tb(4642)
wait(15)
jig fool
tb(4643)
wait(5)
jig fool
tb(4644)
jig fool
tb(4645)

fade screen out(20,20,20)
destroy npc(5)
wait(1)
fade screen in

wait(2)
tb(4646)
get item(252,1)
wait(2)
)

if(check tag(231),and,(currentmap==1,or,currentmap==2,or,currentmap==4)) then(
tb(4647)
walk hero to y(0,21)
wait for hero(0)
walk hero to x(0,149)
wait for hero(0)
set hero direction(0,up)
jig hero(0)
tb(4648)
wait(2)
set npc direction(9,left)
wait(5)
set npc direction(9,down)
wait(10)
jig hero(0)
tb(4652)
delete item(252,1)
jig npc(9)
tb(4653)
jig npc(9)
tb(4654)
jig npc(9)
tb(4655)
jig hero(0)
tb(4656)
jig npc(9)
tb(4660)
jig hero(0)
tb(4661)
jig npc(9)
tb(4665)
jig hero(0)
tb(4666)
wait(20)
tb(4675)
wait(3)
jadeup(2,1)
wait(3)
walk npc(9,left,1)
wait for npc(9)
walk npc(9,up,2)
wait for npc(9)
walk npc(9,left,1)
wait for npc(9)
walk npc(9,up,4)
wait for npc(9)
set tag(232,1)
)
if(check tag(231)==false,and,(currentmap==1,or,currentmap==2,or,currentmap==4)) then(
tb(4628)
set tag(233,1)
)

resume obstruction
resume npcs
resume player
end
###

######################
script, jigfool, begin
tweak palette (2,2,2)
update palette
wait (1)
tweak palette (3,3,3)
update palette
wait (1)
tweak palette (5,5,5)
update palette
reset palette
wait (1)
tweak palette (3,3,3)
update palette
reset palette
wait (1)
tweak palette (2,2,2)
update palette
wait (1)
reset palette
update palette
end
###

########################
script, thehorror, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(234),and,check tag(235),and,check tag(236),and,check tag(237)) then(
jig horror
tb(4681)
jig hero(0)
tb(4682)
jig horror
tb(4686)
jig horror
tb(4687)
jig hero(0)
tb(4688)
jig horror
tb(4692)
jig horror
tb(4693)
wait(10)
jig horror
stop song
tb(4694)
play song(15)
jig horror
tb(4695)
wait(15)
jig horror
tb(4696)
create npc(11,119,52,up)
walk npc(11,up,3)
wait for npc(11)
walk npc(11,up,2)
wait(2)
set hero direction(0,left)
jig hero(0)
show text box(4697)
wait for npc(11)
set npc frame(11,0)
wait for text box
wait(2)
set npc direction(11,right)
wait(2)
jig npc(11)
tb(4701)
wait(5)
jig npc(11)
tb(4702)
jig hero(0)
tb(4703)
wait(3)
set npc direction(11,up)
jig npc(11)
tb(4707)

jig horror
show text box(4708)
variable(nx)
variable(ny)
set variable(nx,npc pixel x(11))
set variable(ny,npc pixel y(11))
variable(hor1)
variable(hor2)
variable(hor3)
variable(hor4)
wait for text box

wait(5)
tweak palette (-2,-2,-2)
update palette
wait (5)
tweak palette (-3,-3,-3)
update palette
wait (5)
tweak palette (-5,-5,-5)
update palette
wait(5)

set variable(hor1,create npc(6,npcx(11),npcy(11)--1,down))
set variable(hor2,create npc(6,npcx(11)+1,npcy(11),down))
set variable(hor3,create npc(6,npcx(11),npcy(11)+1,down))
set variable(hor4,create npc(6,npcx(11)--1,npcy(11),down))

variable(i)
for(i,20,0,-4) do(
put npc(hor1,nx,ny--i)
put npc(hor2,nx+i,ny)
put npc(hor3,nx,ny+i)
put npc(hor4,nx--i,ny)
wait(2)
put npc(hor1,0,0)
put npc(hor2,0,0)
put npc(hor3,0,0)
put npc(hor4,0,0)
wait(2)
)

destroy npc(hor1)
destroy npc(hor2)
destroy npc(hor3)
destroy npc(hor4)

reset palette
wait (5)
tweak palette (-3,-3,-3)
update palette
reset palette
wait (5)
tweak palette (-2,-2,-2)
update palette
wait (5)
reset palette
update palette

alter npc(11,NPCstat:picture,489)
wait(5)
set npc direction(11,right)
wait(5)
set npc direction(11,down)

wait(15)
jig horror
tb(4709)
jig horror
tb(4710)

if(herox(0)<<npcx(6)) then(set hero direction(0,right))
else(set hero direction(0,up))

if(check tag(19)) then(
jig hero(0)
tb(4711)
jig horror
tb(4712)
jig hero(0)
tb(4713)
jig npc(11)
tb(4714)
jig horror
tb(4715)
)
if(check tag(20)) then(
jig hero(0)
tb(4716)
jig horror
tb(4717)
jig hero(0)
tb(4718)
)
if(check tag(21)) then(
jig hero(0)
tb(4719)
jig horror
tb(4720)
)
if(check tag(22)) then(
jig hero(0)
tb(4721)
jig horror
tb(4722)
)

battleflash
ff(96,0,false)
stop song

wait(1)
for(i,1,3,1) do(
alter npc(7,NPCstat:picture,0)
alter npc(8,NPCstat:picture,0)
alter npc(9,NPCstat:picture,0)
alter npc(10,NPCstat:picture,0)
alter npc(11,NPCstat:picture,0)
wait(1)
alter npc(7,NPCstat:picture,223)
alter npc(8,NPCstat:picture,223)
alter npc(9,NPCstat:picture,224)
alter npc(10,NPCstat:picture,224)
alter npc(11,NPCstat:picture,489)
wait(1)
)
for(i,1,2,1) do(
alter npc(7,NPCstat:picture,0)
alter npc(8,NPCstat:picture,0)
alter npc(9,NPCstat:picture,0)
alter npc(10,NPCstat:picture,0)
alter npc(11,NPCstat:picture,0)
wait(2)
alter npc(7,NPCstat:picture,223)
alter npc(8,NPCstat:picture,223)
alter npc(9,NPCstat:picture,224)
alter npc(10,NPCstat:picture,224)
alter npc(11,NPCstat:picture,489)
wait(2)
)
destroy npc(7)
destroy npc(8)
destroy npc(9)
destroy npc(10)
destroy npc(11)

wait(15)
jig horror
tb(4723)
jig horror
tb(4724)
jig horror
tb(4725)
jig hero(0)
tb(4726)
wait(10)
set npc direction(6,right)
wait(3)
jig horror
tb(4730)
for(i,1,4,1) do(
alter npc(6,NPCstat:picture,0)
wait(1)
alter npc(6,NPCstat:picture,222)
wait(1)
)
for(i,1,3,1) do(
alter npc(6,NPCstat:picture,0)
wait(2)
alter npc(6,NPCstat:picture,222)
wait(2)
)
alter npc(6,NPCstat:picture,0)
set tag(238,1)
wait(3)
jadeup(3,2)
wait(3)
play song(4)
)
else(
tb(4676)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, jighorror, begin
tweak palette (-2,-2,-2)
update palette
wait (1)
tweak palette (-3,-3,-3)
update palette
wait (1)
tweak palette (-5,-5,-5)
update palette
reset palette
wait (1)
tweak palette (-3,-3,-3)
update palette
reset palette
wait (1)
tweak palette (-2,-2,-2)
update palette
wait (1)
reset palette
update palette
end
###

###########################
script, jadedwarrior, begin
suspend player
suspend npcs
suspend obstruction

#quest is over, only sword remains
if(check tag(246)) then(tb(6502))

#charlocke tells his story
if(check tag(243),and,check tag(244)==false) then(
focus camera(130,80,2)
show text box(4737)
wait for camera
variable(hx)
variable(hy)
set variable(hx,herox(0))
set variable(hy,heroy(0))
if(hx==131,and,hy==81) then(
walk hero(0,left,1)
wait for hero(0)
set hero direction(0,up)
)
if(hx==132,and,hy==82) then(
walk hero(0,left,2)
wait for hero(0)
walk hero(0,up,1)
wait for hero(0)
)
if(hx==132,and,hy==80) then(
walk hero(0,left,1)
wait for hero(0)
walk hero(0,down,1)
wait for hero(0)
walk hero(0,left,1)
wait for hero(0)
set hero direction(0,up)
)
if(hx==133,and,hy==81) then(
walk hero(0,down,1)
wait for hero(0)
walk hero(0,left,3)
wait for hero(0)
walk hero(0,up,1)
wait for hero(0)
)
wait for text box
wait(10)
tb(4738)
tb(4739)
wait(15)
tb(4740)
jig hero(0)
tb(4741)

wait(15)
tb(4745)
palout(7)
show backdrop(0)
stop song
wait(1)
palin(1)

suspend box advance
textout(1)
show text box(4746)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4747)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4748)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4749)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4750)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4751)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box

palout(1)
play song(19)
show map
camera follows hero(0)
set hero position(0,45,53)
wait(1)
pan camera(south,0,0)
set hero position(0,54,54)
alter npc(10,NPCstat:picture,226)
alter npc(1,NPCstat:picture,212)
alter npc(1,NPCstat:palette,145+poff)
set npc position(10,45,47)
set npc position(1,45,45)
set npc position(11,44,46)
set npc direction(11,left)
set npc direction(1,right)
wait(1)

reset palette
greyscale palette
tweak palette (-40,-40,-40)
update palette
wait (7)
reset palette
greyscale palette
tweak palette (-20,-20,-20)
update palette
wait (7)
reset palette
greyscale palette
tweak palette (-10,-10,-10)
update palette
wait (7)
reset palette
greyscale palette
tweak palette (-5,-5,-5)
update palette
wait (7)
reset palette
greyscale palette
update palette

wait(15)
textout(1)
show text box(4752)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4753)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4754)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box
show text box(4755)
wait(3)
textin(1)
wait for key(usekey)
textout(1)
advance text box

wait(15)
walk npc(10,down,3)
set npc direction(10,up)
wait(5)
pan camera(up,6,1)
wait for camera
wait for npc(10)
pan camera(up,2,1)

palout(7)
wait for camera
alter npc(10,NPCstat:picture,227)
set npc position(10,130,80)
set npc direction(10,down)
set npc frame(10,1)
set npc position(11,132,82)
set npc direction(11,right)
camera follows hero(0)
set hero position(0,130,81)
set hero direction(0,up)
resume box advance
wait(1)
palin(1)

if(check tag(3)) then(play song(35))
if(check tag(4)) then(play song(28))
if(check tag(5)) then(play song(36))
if(check tag(6)) then(play song(4))

wait(10)
tb(4756)
set tag(244,1)
set tag(239,0)
set tag(240,0)
)

#finish the quest by talking to charlocke
if(check tag(245),and,check tag(246)==false,and,( (herox(0)==129,and,heroy(0)==80),or,(herox(0)==130,and,heroy(0)==81),or,(herox(0)==131,and,heroy(0)==80) ) ) then(
if(herox(0)<>npcx(10)) then(
walk hero to y(0,npcy(10)+1)
wait for hero(0)
walk hero to x(0,npcx(10))
wait for hero(0)
)
set hero direction(0,up)
wait(5)
set npc frame(10,1)
wait(2)
tb(4779)
jig hero(0)
tb(4780)
stop song
wait(10)
set npc frame(10,0)
wait(5)
tb(4784)
wait(20)
jadeup(2,1)
alter npc(10,NPCstat:picture,226)
set npc direction(10,down)
wait(10)
jig npc(10)
play song(69)
tb(4785)
jig npc(10)
tb(4786)
wait(5)
set npc direction(10,left)
wait(15)
jig npc(10)
tb(4787)
tb(4789)
wait(15)
set npc direction(10,down)
jig npc(10)
tb(4790)
alter npc(10,NPCstat:movespeed,2)
walk npc(10,left,2)
wait for npc(10)
walk npc(10,down,1)
set hero direction(0,left)
wait for npc(10)
walk npc(10,left,2)
wait for npc(10)
wait(15)
set npc direction(10,down)
wait(3)
set npc direction(10,right)
wait(3)
jig npc(10)
tb(4791)
jig hero(0)
tb(4792)
jig npc(10)
show text box(4796)
wait(5)
set npc direction(10,down)
wait(2)
set npc direction(10,left)
wait for text box
walk npc(10,left,5)
wait for npc(10)
set tag(246,1)
#if(check tag(3)) then(play song(35))
#if(check tag(4)) then(play song(28))
#if(check tag(5)) then(play song(36))
#if(check tag(6)) then(play song(4))
)
#sword text for in-between bit
else(
if(check tag(245),and,check tag(246)==false) then(tb(6502))
)

resume obstruction
resume npcs
resume player
end
###

################################
script, forestpasswobbler, begin
suspend player
suspend npcs
suspend obstruction

pan camera(south,0,0)
walk hero(0,left,5)
variable(hy)
set variable(hy,heroy(0))
wait(3)
palout(3)
wait for hero(0)
camera follows hero(0)
variable(os)
if(hy==80) then(set variable(os,0))
else(set variable(os,1))
teleport to map (currentmap+8,156,98+os)
wait(1)
pan camera(south,0,0)
set hero position(0,161,98+os)
create npc(8,153,heroy(0),right)
wait(1)
walk hero(0,left,5)
wait(3)
palin(3)
wait for hero(0)
camera follows hero(0)

wait(5)
jig npc(8)
show text box(4760)
wait(2)
alter npc(8,NPCstat:picture,227)
set npc direction(8,up)
wait for text box
jig hero(0)
tb(4761)
alter npc(8,NPCstat:picture,228)
set npc direction(8,right)
jig npc(8)
tb(4765)
jig npc(8)
show text box(4766)
wait(4)
alter npc(8,NPCstat:picture,227)
set npc direction(8,up)
wait for text box
tb(4767)
tb(4768)
tb(4769)
jig hero(0)
tb(4770)
alter npc(8,NPCstat:picture,228)
set npc direction(8,right)
jig npc(8)
tb(4774)
wait(3)
set npc direction(8,down)
wait(3)
set npc direction(8,left)
wait(10)
jig npc(8)
tb(4775)

set tag(245,1)

resume obstruction
resume npcs
resume player
end
###

###############################
script, hopelessromantic, begin
suspend player
suspend npcs
suspend obstruction

#romantic - don't have flute text
if(check tag(248)==false,and,(currentmap==1,or,currentmap==2,or,currentmap==4)) then(
	tb(4797)
	set tag(251,1)
)

#romantic - have flute text
if(check tag(248),and,(currentmap==1,or,currentmap==2,or,currentmap==4)) then(
	jig npc(13)
	tb(4815)
	wait(5)
	set npc direction(13,right)
	jig npc(13)
	jig npc(13)
	tb(4816)
	tb(4817)
	jig hero(0)
	tb(4818)
	jig npc(13)
	tb(4822)
	wait(10)
	jig npc(13)
	tb(4823)
	jig hero(0)
	tb(4824)
	wait(2)
	tb(4828)
	delete item(16,1)
	jig npc(13)
	tb(4829)

	if(check tag(19)) then(
		jig hero(0)
		tb(4830)
		jig npc(13)
		tb(4831)
		jig hero(0)
		tb(4832)
		jig npc(13)
		tb(4833)
	)
	if(check tag(20)) then(
		jig hero(0)
		tb(4834)
		jig npc(13)
		tb(4835)
		jig hero(0)
		tb(4836)
		jig npc(13)
		tb(4837)
		jig hero(0)
		tb(4838)
	)
	if(check tag(21)) then(
		jig hero(0)
		tb(4839)
		jig npc(13)
		tb(4840)
		jig hero(0)
		tb(4841)
		jig npc(13)
		tb(4842)
	)
	if(check tag(22)) then(
		jig hero(0)
		tb(4843)
	)

	wait(3)
	wpalout(1)
	set tag(249,1)
	set variable(jadecounter,jadecounter+3)
	set variable(jadecounter2,jadecounter2+(3*4))
	set hero direction(0,right)
	set hero position(0,155,47)
	wait(1)
	wpalin(1)
	wait(3)
)

#drunk
if(currentmap==6,or,currentmap==7,or,currentmap==8) then(

	#his before met flute playter text
	if(check tag(251)==false) then(tb(6503))

	#his after buying flute text
	if(check tag(687)) then(tb(6504))

	#buying process
	if(check tag(251),and,check tag(687)==false) then(
		if(check tag(250)==false) then(tb(4801))
		else(tb(4814))

		#check money
		if(pay money(1)) then(get money(1))
		else(set tag(247,0))

		#buy
		if(check tag(247)) then(
			lose money(1)
			tb(4802)
			tb(4803)
			tb(4807)
			get item(16,1)
			set tag(687,1)
		)

		#don't buy first time
		if(check tag(247)==false,and,check tag(250)==false) then(
			tb(4808)
			tb(4812)
			tb(4813)
			set tag(250,1)
		)
		
	)
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, waterjar, begin
suspend player
suspend npcs
suspend obstruction

#start quest by getting into hole
if(check tag(252)==false) then(

#already heard offer to get into hole
if(check tag(253)) then(
jig npc(17)
tb(4858)
)
#first offer
else(
jig npc(17)
tb(4845)
jig hero(0)
tb(4846)
jig npc(17)
tb(4850)
tb(6506)
jig npc(17)
tb(4851)
wait(5)
jig npc(17)
tb(4852)
set tag(253,1)
)

#enter hole
if(check tag(252)) then(
jig hero(0)
tb(4859)
jig npc(17)
tb(4863)
wait(3)
set npc direction(17,right)
wait(3)
walk npc(19,right,1)
wait for npc(19)
wait(3)

if(heroy(0)<<npcy(17)) then(set npc direction(17,up))
if(heroy(0)==npcy(17)) then(set npc direction(17,left))
if(heroy(0)>>npcy(17)) then(set npc direction(17,down))
wait(2)
jig npc(17)
tb(4864)
jig npc(17)
tb(4865)
palout(2)
teleport to map(69,33,106)
set pal(afternoon)
wait(1)
pan camera(south,0,0)
set hero position(0,33,109)
set npc position(4,33,109)
wait(15)
palin(2)
wait(10)
walk hero(0,up,3)
wait for hero(0)
walk npc(4,up,1)
set hero direction(0,left)
wait(2)
set hero direction(0,down)
wait for npc(4)
camera follows hero(0)
)

#do not enter
else(
jig hero(0)
tb(4853)
jig npc(17)
tb(4857)
set tag(253,1)
)
)

#meet hacho, who is fighting a monster
if(herox(0)==40) then(
jig hero(0)
stop song
tb(4881)
pan camera(right,4,10)
wait for camera
jig npc(5)
tb(4885)
play song(15)
set hero speed(0,10)
walk hero to y(0,77)
wait for hero(0)
walk hero(0,right,4)
wait for hero(0)
walk hero(0,down,3)
wait for hero(0)
set hero direction(0,right)
set hero frame(0,0)
set hero speed(0,hspeed)

battleflash
ff(104,0,false)
play song(69)
set tag(257,1)

wait(3)
focus camera(herox(0),heroy(0),4)
set npc direction(5,down)
wait(3)
set npc direction(5,left)
wait for camera
camera follows hero(0)
jig npc(5)
tb(4886)
wait(5)
jig npc(5)
tb(4887)
jig hero(0)
tb(4888)
jig npc(5)
tb(4892)
tb(4893)
jig hero(0)
tb(4894)
wait(5)
jig npc(5)
tb(4898)
jig npc(5)
tb(4899)
tb(4900)
jig npc(5)
tb(4901)
wait(3)
walk npc(5,left,1)
wait for npc(5)
set npc position(5,0,0)
set tag(254,1)
#play song(68)
)

#can we trust Hacho??
if(herox(0)==47) then(
set tag(717,1)
jig hero(0)
tb(4902)
stop song
set tag(254,0)
set npc position(5,herox(0),heroy(0))
walk npc(5,right,1)
wait for npc(5)
set npc frame(5,0)
set npc direction(5,down)
wait(2)
set npc direction(5,left)
jig npc(5)
tb(4906)
wait(5)
jig npc(5)
tb(4907)
jig npc(5)
tb(4908)
tb(4909)
jig npc(5)
tb(4910)
wait(3)
set npc direction(5,down)
wait(3)
walk npc(5,right,2)
wait for npc(5)
set npc frame(5,0)
wait(10)
jig npc(5)
tb(4911)
set tag(254,0)
)

#we can trust Hacho!!
if(herox(0)==49) then(
set tag(717,0)
play song(69)
set npc direction(5,down)
wait(3)
set npc direction(5,left)
wait(3)
jig npc(5)
tb(4912)
tb(4913)
walk npc(5,left,1)
wait for npc(5)
set npc position(5,0,0)
set tag(254,1)
#play song(68)
)

#fight evil lady
if(herox(0)==69,and,heroy(0)==82) then(
set tag(254,0)
set tag(256,1)
stop song
jig horror
tb(4914)
wait(5)
jig horror
tb(4915)
play song(15)
walk hero(0,down,5)
wait for hero(0)
walk hero(0,right,2)
wait for hero(0)
set hero frame(0,0)
set npc position(5,herox(0),heroy(0))
walk npc(5,up,1)
wait for npc(5)
set npc frame(5,0)
set npc direction(5,right)
walk npc(6,left,6)
wait for npc(6)
jig horror
tb(4916)
set npc direction(5,down)
jig npc(5)
tb(4917)
jig horror
tb(4918)
set npc direction(5,right)
jig npc(5)
tb(4919)

battleflash
ff(105,0,false)
play song(15)

wait(3)
jig horror
tb(4920)
wait(10)

alter npc(6,NPCstat:picture,147)
alter npc(6,NPCstat:palette,1)
set npc direction(6,up)
wait(2)
set npc direction(6,right)
wait(3)
set npc direction(6,down)
wait(2)
set npc direction(6,left)
wait(2)
set npc position(6,0,0)

stop song
jig hero(0)
tb(4921)
set npc direction(5,down)
jig npc(5)
play song(82)
tb(4925)
tb(4926)
wait(3)
jadeup(4,2)
wait(3)
set npc direction(5,right)
wait(10)
jig npc(5)
tb(4927)

wait(1)
palout(1)
set hp
teleport to map(1+poff,28,40)
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
wait(20)
palin(1)

walk npc(19,right,1)
wait for npc(19)
wait(5)
set hero speed(0,2)
set hero position(0,28,39)
walk hero(0,down,1)
wait for hero(0)
set hero speed(0,hspeed)
camera follows hero(0)
set hero frame(0,0)
walk npc(19,left,1)
wait for npc(19)
)

#exiting cave checks
if(check tag(254)==false,and,herox(0)==33) then(

	#exit via cave, didn't help hacho
	if(check tag(257)) then(
	walk npc(4,down,1)
	wait for npc(4)
	walk hero(0,down,2)
	wait for hero(0)

	wait(1)
	palout(1)
	set hp
	teleport to map(1+poff,28,40)
	wait(1)
	pan camera(south,0,0)
	set hero position(0,0,0)
	wait(20)
	palin(1)

	walk npc(19,right,1)
	wait for npc(19)
	wait(5)
	set hero speed(0,2)
	set hero position(0,28,39)
	walk hero(0,down,1)
	wait for hero(0)
	set hero speed(0,hspeed)
	set hero frame(0,0)
	camera follows hero(0)
	walk npc(19,left,1)
	walk npc(17,down,1)
	show text box(4928)
	wait for npc(17)
	set npc frame(17,0)
	set npc direction(17,right)
	wait for npc(19)
	wait for text box
	jig npc(17)
	tb(4929)
	set hero direction(0,left)
	jig hero(0)
	tb(4930)
	jig npc(17)
	tb(4934)

	battleflash
	ff(106+poff)
	set tag(256,1)
	)

	#attempt to exit, but haven't met Hacho
	else(
	tb(4866)
	)

)

resume obstruction
resume npcs
resume player
end
###

###########################
script, fralingraves, begin
suspend player
suspend npcs
suspend obstruction

if(herox(0)==149,and,heroy(0)==20) then(
	if(check tag(231)==false,and,currentmap==3) then(weepingwoman)
	else(tb(6492))
)
else(
#Scarf 1
if(herox(0)==162,and,heroy(0)==57) then(tb(7466))
)
do(
if(herox(0)==136,and,heroy(0)==20) then(tb(7465))
)
do(
if(herox(0)==138,and,heroy(0)==20) then(tb(7461))
)
do(
if(herox(0)==140,and,heroy(0)==20) then(tb(7464))
)
do(
if(herox(0)==142,and,heroy(0)==15) then(tb(7471))
)
do(
if(herox(0)==148,and,heroy(0)==17) then(tb(7459))
)
do(
if(herox(0)==150,and,heroy(0)==17) then(tb(7470))
)
do(
if(herox(0)==145,and,heroy(0)==20) then(tb(7463))
)
do(
if(herox(0)==147,and,heroy(0)==20) then(tb(7460))
)
do(
if(herox(0)==151,and,heroy(0)==20) then(tb(7467))
)
do(
if(herox(0)==148,and,heroy(0)==23) then(tb(7469))
)
do(
if(herox(0)==150,and,heroy(0)==23) then(tb(7462))
)
do(
if(herox(0)==152,and,heroy(0)==23) then(tb(7468))
)

resume obstruction
resume npcs
resume player
end
###

########################
script, fralininn, begin
suspend player
suspend npcs
suspend obstruction

#Ask if want to rest, cost is 1$
set tag(259,0)
tb(2399)
if(check tag(259)) then(
#tb(2401)

	#check if have to pay or not
	#sneaky, i will give them 1 gold for the room!
	if(check tag(213)) then(get money(1))
	
	#check money
	if(paymoney(1)) then(

		if(check tag(213)==false) then(tb(2407))

		tb(2406)
		wait(2)
		palout(2)

		innfancy

		set hp
		wait(1)
		teleport to map(5+poff,4,40)
		suspend npcs
		innrest
		wait(15)
		#end part
		set party out
		swap by position(find hero(0),0)
		wait(1)
		pan camera(south,0,0)
		set hero position(0,5,40)
		set hero direction(0,down)
		hero clothes
		if(check tag(85)) then(set npc position(1,7,40))
		if(check tag(86)) then(set npc position(2,5,36))
		if(check tag(87)) then(set npc position(3,7,36))
		set hero speed(0,2)
		alter npc(1,NPCstat:movespeed,2)
		alter npc(2,NPCstat:movespeed,2)
		alter npc(3,NPCstat:movespeed,2)
		wait(10)
		palin(2)

		wait(4)

		walk hero(0,left,1)
		walk npc(1,left,1)
		walk npc(2,left,1)
		walk npc(3,left,1)
		wait for hero(0)
		set hero frame(0,0)
		walk npc(1,up,1)
		walk npc(2,down,4)
		walk npc(3,down,2)
		wait for npc(3)
		walk npc(3,left,1)
		wait for npc(1)
		walk npc(1,up,1)
		wait for npc(3)
		walk npc(3,left,1)
		wait for npc(1)
		walk npc(1,left,1)
		wait for npc(2)
		set npc position(2,0,0)
		wait for npc(3)
		walk npc(3,down,1)
		wait for npc(1)
		walk npc(1,left,1)
		wait for npc(3)
		walk npc(3,down,1)
		wait for npc(1)
		walk npc(1,down,2)
		wait for npc(3)
		set npc position(3,0,0)
		wait for npc(1)
		set npc position(1,0,0)

		set party in
		wait(2)
		set hero direction(0,down)
		wait(2)
		set hero speed(0,hspeed)
		camera follows hero(0)
		alter npc(5,NPCstat:script,0)
		alter npc(5,NPCstat:displaytext,2408)
		if(check tag(4)) then(
		alter npc(5,NPCstat:picture,21)
		alter npc(5,NPCstat:whenactivated,npcwhenactivated:changedirection)
		set npc position(5,3,21)
		)
		save game
	)
	#don't have enough money
	else( tb(2405) )

)#end chose to rest

#choose not to rest
else(

#if night, goto ze ghost fool quest bit
if(check tag(6),and,check tag(293)==false) then(
	#quest resolved
	if(check tag(292)) then(
		tb(5156)
		tb(5157)
		tb(5161)
		tb(5162)
		tb(5166)
		tb(5167)
		set tag(293,1)
	)

	#innkeep init quest
	else(
		tb(5143)
		set tag(291,1)
	)
)

#stock choose not to rest message
else(tb(2422))

)

resume obstruction
resume npcs
resume player
end
###

#########################
script, fralinicon, begin
suspend player
suspend npcs
suspend obstruction

#check if waiting
if( fraliniconsave <> 0 ) then(
	#get icon
	if(iconwaitcheck(fraliniconsave,fraliniconhour,fraliniconday)) then(
		tb(6552)
		tb(6544 + (fraliniconsave -- 100 -- 8) )
		get item(fraliniconsave)
		set variable(fraliniconsave,0)
		set variable(fraliniconhour,0)
		set variable(fraliniconday,0)
	)
	#still waiting
	else(
		tb(6553)
	)
)

#main
set tag(258,0)
tb(6554)
if(check tag(258)) then( iconcraft(47,100,6512,3,2,1) )
else( tb(6555) )

resume obstruction
resume npcs
resume player
end
###

#########################
script, fralinitem, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(268),and,check tag(271)==false) then(
tb(4949)
set tag(271,1)
)

if(check tag(269),and,check tag(271)==false) then(
tb(4950)
set tag(271,1)
)

set tag(258,0)
tb(6593)

#check if want to buy
if(check tag(258)) then(

alter npc(12,NPCstat:script,0)
wait(3)
set tag(258,0)
tb(6596)
if(check tag(258)) then( use shop(1) )
else( itemfralin )
wait(1)
alter npc(12,NPCstat:script,173)

)#end check to buy

#don't want to buy
else(tb(6597))

resume obstruction
resume npcs
resume player
end
###

#########################
script, fralinstat, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(20)
tb(6608)

if(check tag(258)) then(
	#npc, firstscreen,firsttextbox,$cost,phasecost,
	#strup,accup,defup,ddgup,sklup,evdup,
	#strcap,acccap,defcap,ddgcap,sklcap,evdcap
	stattrain(20,83,6598,3,1,4,6,2,6,4,4,27,22,8,17,32,8)
)
else(
	wait(3)
	jig npc(20)
	tb(6609)
)

resume obstruction
resume npcs
resume player
end
###

###################
script, fralinavis, begin
suspend player
suspend npcs
suspend obstruction

#already have avis
if(check tag(262)) then(tb(6613))

#get avis
else(
	set tag(258,0)
	jig npc(21)
	tb(6611)
	wait(2)
	if(check tag(258)) then(
		if(pay money(10)) then(
			set tag(262,1)
			tb(6615)
			wait(2)
			if(check tag(261)==false) then(
				jig gahn
				tb(6616)
				set tag(261,1)
				get item(72,1)
			)
		)
		#not enough money
		else(tb(6614))
	)
	#chose not to buy
	else(tb(6612))
)

resume obstruction
resume npcs
resume player
end
###

##############################
script, itemresttrigger, begin
itemrest
end
###

###########################
script, fralintrader, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(23)
tb(6638)
if(check tag(258)) then( trader(6620,2) )
else(
wait(2)
jig npc(23)
tb(6639)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, avistrigger, begin
suspend player
suspend npcs
suspend obstruction
suspend npc walls

avis

resume npc walls
resume obstruction
resume npcs
resume player
end
###

###########################
script, thiefgetaway, begin
suspend player
suspend npcs
suspend obstruction

wait(20)
alter npc(1,NPCstat:picture,290)
alter npc(1,NPCstat:palette,221+poff)
set npc position(1,3,154)
walk npc(1,up,2)
wait(3)
set npc direction(12,down)
wait for npc(1)
set npc frame(1,0)
jig npc(1)
tb(4936)
stop song
tb(4937)
jig npc(12)
tb(4938)
jig npc(1)
tb(4939)

wait(2)
palout(2)
teleport to map(1+poff,118,63)
stop song
wait(1)
pan camera(south,0,0)
set hero position(0,118,65)
set npc position(24,0,0)
wait(10)
walk hero(0,up,2)
palin(2)

wait for hero(0)
set hero frame(0,0)
set npc position(24,112,64)
walk npc(24,down,1)
wait for npc(24)
walk npc(24,right,6)
wait for npc(24)
walk npc(24,up,1)
wait for npc(24)
set npc frame(24,0)

play song(8)
jig npc(24)
show text box(4940)
wait(2)
set hero direction(0,left)
wait(2)
set hero direction(0,down)
wait for text box

#stop thief
if(check tag(268)) then(

jig npc(24)
jig npc(24)
wait(4)
battleflash
if(check tag(4)) then(ff(97,0,false))
if(check tag(5)) then(ff(98,0,false))
if(check tag(3)) then(ff(99,0,false))
set tag(270,1)

wait(5)
alter npc(1,NPCstat:picture,256)
alter npc(1,NPCstat:palette,65+poff)
set npc position(1,112,64)
walk npc(1,down,1)
wait for npc(1)
walk npc(1,right,6)
wait for npc(1)
walk npc(1,up,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
jig npc(1)
tb(4941)
jig npc(1)
tb(4942)
wait(2)
set npc frame(1,1)
wait(2)
set hero frame(0,1)
wait(2)
set npc frame(1,0)
wait(2)
set hero frame(0,0)
wait(2)
tb(4943)
get item(65,4)
jig npc(1)
tb(4944)
jig hero(0)
tb(4945)

alter npc(1,NPCstat:movespeed,2)
set npc direction(1,left)
wait(2)
walk npc(1,down,1)
wait for npc(1)
walk npc(1,left,6)
wait for npc(1)
walk npc(1,up,1)
wait for npc(1)
set npc position(1,0,1)
alter npc(1,NPCstat:picture,12)
alter npc(1,NPCstat:palette,29+poff)
alter npc(1,NPCstat:movespeed,4)
wait(3)
jadeup(2,1)
wait(3)
camera follows hero(0)
)

#don't stop thief
else(
walk hero(0,left,1)
walk npc(24,up,7)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,up)
wait for npc(24)
set tag(270,1)
alter npc(1,NPCstat:picture,256)
alter npc(1,NPCstat:palette,65+poff)
wait(5)
set npc position(1,112,64)
walk npc(1,down,1)
wait for npc(1)
walk npc(1,right,2)
wait for npc(1)
set npc frame(1,0)
wait(15)
set npc direction(1,down)
wait(2)
alter npc(1,NPCstat:movespeed,2)
walk npc(1,left,2)
wait for npc(1)
walk npc(1,up,1)
wait for npc(1)
set npc position(1,0,1)
alter npc(1,NPCstat:picture,12)
alter npc(1,NPCstat:palette,29+poff)
alter npc(1,NPCstat:movespeed,4)
focus camera(herox(0),heroy(0),2)
wait for camera
camera follows hero(0)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, piratebooty, npcnum, begin
suspend player
suspend npcs
suspend obstruction

#captain
if(npcnum==9) then(
	#have init quest
	if(check tag(272)) then(
		jig npc(9)
		tb(4955)
		wait(2)
		tb(4956)
	)
	#haven't init quest
	else(
		jig npc(9)
		tb(4952)
		wait(2)
		tb(4953)
		set tag(272,1)
	)
)

#1st mate
if(npcnum==10) then(
	#have init quest
	if(check tag(272)) then(
		if(herox(0)==npcx(10)) then(
			set npc direction(10,down)
			wait(5)
			jig npc(10)
			tb(4954)
			walk npc(10,right,1)
			wait for npc(10)
			set npc frame(10,0)
			set npc direction(10,down)
		)
		else(
			set npc direction(10,right)
			wait(5)
			jig npc(10)
			tb(4954)
			walk npc(10,down,1)
			wait for npc(10)
			set npc frame(10,0)
		)
	wait(2)
	set npc direction(10,left)
	alter npc(10,NPCstat:script,0)
	alter npc(10,NPCstat:displaytext,4951)
	)
	#haven't init quest
	else(
	tb(4951)
	)
)

#found bag of gold
if(npcnum==1) then(
stop song
tb(4959)
get item(28,1)
wait(5)
battleflash
ff(86,0,false)
set tag(274,1)
write pass block(4,69,0)
#turn rest item back on
set tag(433,0)
)

#quest end
if(npcnum==2) then(
	if(check tag(273)) then(
	set tag(8,1)
	pan camera(south,0,0)
	walk hero(0,down,1)
	wait for hero(0)
	palout(2)
	camera follows hero(0)
	teleport to map(9+poff,58,50)
	wait(1)
	pan camera(south,0,0)
	set hero position(0,0,0)
	set hp
	wait(1)
	palin(2)
	set hero position(0,58,49)
	walk hero(0,down,1)
	wait for hero(0)
	camera follows hero(0)
	set tag(8,0)
	)
	else(
	set tag(8,1)
	pan camera(south,0,0)
	walk hero(0,down,1)
	wait for hero(0)
	palout(2)
	camera follows hero(0)
	teleport to map(9+poff,58,49)
	stop song
	wait(1)
	pan camera(south,0,0)
	set hero position(0,0,0)
	alter npc(9,NPCstat:picture,289)
	set npc position(9,58,50)
	set npc direction(9,up)
	set npc position(10,57,50)
	set npc direction(10,up)
	set hp
	wait(1)
	palin(2)
	wait(10)
	set hero position(0,58,49)
	wait(15)
	jig hero(0)
	tb(4960)
	wait(3)
	play song(15)
	tb(4964)
	tb(4965)
	stop song
	battleflash
	ff(87+poff,0,false)
	set tag(273,1)
	wait(5)
	camera follows hero(0)
	walk hero(0,down,1)
	wait for hero(0)
	wait(3)
	jadeup(4,1)
	wait(3)
	set tag(8,0)
	)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, dackenmorph, begin
suspend player
suspend npcs
suspend obstruction

#before it is too late
if(check tag(204)==false) then(dackenmorph1)

#it is too late
if(check tag(204)==true) then(
	#aftermath of fighting final dackenmorph
	if(check tag(278),and,check tag(279)==false) then(dackenmorph2)

	#fight final dackenmorph
	if(check tag(278)==false,and,check tag(279)==false) then(
		dackenmorph3
		dackenmorph4
	)
)

resume obstruction
resume npcs
resume player
end
###

###########################
script, dackenmorph1, begin
#fight baby dacken
if(check tag(276),and,check tag(275)) then(
	jig horror
	tb(4968)
	battleflash
	ff(100+poff,0,false)
	set tag(277,1)
	wait(3)
	jadeup(3,2)
	wait(3)
)
#second talk
if(check tag(275),and,check tag(276)==false) then(
	jig horror
	tb(4967)
	set tag(276,1)
)
#first talk
if(check tag(275)==false,and,check tag(276)==false) then(
	jig horror
	tb(4966)
	set tag(275,1)
)
end
###
###########################
script, dackenmorph2, begin
pan camera(south,0,0)
walk hero(0,down,1)
wait for hero(0)
palout(2)
camera follows hero(0)
set hero position(0,5,237)
wait(1)
pan camera(south,0,0)
set hero position(0,1,231)
hero clothes
set npc position(1,5,236)
set npc direction(1,down)
set npc position(2,7,235)
set npc direction(2,down)
set npc position(3,9,237)
set npc direction(3,left)
wait(1)
palin(2)

wait(10)
walk hero(0,down,7)
wait for hero(0)
walk hero(0,right,3)
wait for hero(0)
walk hero(0,right,1)
jig npc(4)
stop song
show text box(4990)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,up)
wait for text box
play song(97)
wait(5)
jig hero(0)
tb(4991)
jig npc(4)
tb(4992)
wait(4)
jig npc(2)
tb(4993)
jig npc(3)
tb(4994)
alter npc(1,NPCstat:picture,390)
set npc direction(1,up)
wait(2)
jig npc(1)
set npc direction(1,left)
jig npc(1)
tb(4995)
jig npc(2)
tb(4996)
alter npc(1,NPCstat:picture,233)
set npc direction(1,down)
wait(2)
set npc direction(1,right)
wait(2)
set npc direction(1,up)
jig npc(1)
tb(4997)
tb(4998)
jig hero(0)
tb(4999)
wait(5)
set npc direction(1,right)
wait(12)
set npc direction(1,down)
wait(5)
jig npc(1)
tb(5000)
jig npc(3)
tb(5001)
jig npc(2)
tb(5002)
jig hero(0)
tb(5003)
jig npc(4)
tb(5004)
wait(10)
jig hero(0)
tb(5005)
wait(2)
jig hero(0)
show text box(5006)
wait(2)
set hero direction(0,right)
wait(2)
set hero direction(0,down)
wait for text box
wait(2)

palout(2)
camera follows hero(0)
teleport to map(1+poff,162,79)
stop song
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
swap in hero(1)
swap in hero(2)
swap in hero(3)
wait(1)
set party in
wait(1)
palin(2)
wait(10)
set hero position(0,162,77)
walk hero(0,down,2)
wait for hero(0)
set hero frame(0,0)
set tag(8,0)
set tag(279,1)
set hero speed(0,hspeed)
camera follows hero(0)
save game

play song(17)

end
###
###########################
script, dackenmorph3, begin
stop song
jig horror
jig horror
show text box(4973)
jig horror
wait for text box
play song(17)

wait(2)
walk hero to x(0,93)
wait for hero(0)
set hero frame(0,0)
pan camera(south,0,0)
heroclothes
set party out
swap by position(find hero(0),0)
set hero speed(0,4)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk hero(0,up,1)
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,right)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait(2)
set hero direction(0,down)
set npc direction(1,left)
set npc direction(2,right)
set npc direction(3,up)

jig hero(0)
tb(4974)
set npc direction(1,up)
jig npc(1)
tb(4975)
jig npc(2)
show text box(4976)
wait(3)
set npc direction(1,left)
wait for text box
wait(6)
jig npc(3)
tb(4977)
set npc direction(1,down)
jig npc(1)
tb(4978)
stop song
jig horror
jig horror
show text box(4979)
jig horror
set npc direction(1,left)
wait for text box
wait(2)
set npc direction(2,up)
wait(12)
set npc direction(2,right)
wait(4)
set npc direction(2,down)
wait(12)
set npc direction(2,left)
wait(10)
set npc direction(2,down)
wait(2)
set npc direction(2,right)
jig npc(2)
tb(4980)
jig hero(0)
tb(4981)

play song(59)

variable(cx)
variable(cy)
set variable(cx, camera pixel x)
set variable(cy, camera pixel y)
variable(i)

jig horror

for(i,1,10,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)

suspend box advance
show text box(4982)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-1,1),cy)
wait(1)
)
advance text box

for(i,1,5,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)

show text box(4983)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-1,1),cy)
wait(1)
)
advance text box

for(i,1,5,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)

show text box(4984)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-1,1),cy)
wait(1)
)
advance text box

for(i,1,5,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)

show text box(4985)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-1,1),cy)
wait(1)
)
advance text box

for(i,1,5,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)

show text box(4986)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-3,3),cy+random(-3,3))
wait(1)
)
advance text box

for(i,1,10,1) do(
put camera(cx+random(-3,3),cy+random(-3,3))
wait(1)
)

show text box(4987)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-3,3),cy+random(-3,3))
wait(1)
)
advance text box

for(i,1,10,1) do(
put camera(cx+random(-3,3),cy+random(-3,3))
wait(1)
)

show text box(4988)
while(key is pressed(57)==false,and,key is pressed(28)==false,and,key is pressed(29)==false) do(
put camera(cx+random(-3,3),cy+random(-3,3))
wait(1)
)
advance text box
resume box advance
put camera(cx,cy)
stop song
wait(25)
jig horror
tb(4989)
end
###
###########################
script, dackenmorph4, begin
battleflash(1)
set party in
ff(603+poff)
stop song
set party out
swap by position(find hero(0))
palout(1)
camera follows hero(0)
teleport to map(5+poff,6,256)
stop song
wait(1)
set hero direction(0,down)
set hero picture(0,378)
set hero frame(0,1)
wait(40)
palin(10)
swap out hero(1)
swap out hero(2)
swap out hero(3)
wait(20)

set hero frame(0,0)
wait(2)
set hero frame(0,1)
wait(2)
set hero frame(0,0)
wait(2)
set hero frame(0,1)
wait(2)
set hero picture(0,230)
set tag(278,1)
set hero speed(0,hspeed)
end
###

###########################
script, fralinmazing, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

play song(91)

#have already talked to mazing
if(check tag(281)) then(
	walk hero to y(0,54)
	wait for hero(0)
	walk hero to x(0,89)
	wait for hero(0)
	set hero direction(0,up)
	set party out
	swap by position(find hero(0),0)
	jig npc(26)
	alter npc(26,NPCstat:picture,140)
	tb(5016)
)

#talk to first time
else(
	walk hero to y(0,54)
	wait for hero(0)
	walk hero to x(0,89)
	wait for hero(0)
	set hero direction(0,up)
	set party out
	swap by position(find hero(0),0)
	jig npc(26)
	jig npc(26)
	tb(5007)
	jig npc(26)
	tb(5008)
	jig hero(0)
	tb(5009)
	wait(5)
	jig npc(26)
	tb(5010)
	jig hero(0)
	tb(5011)
	alter npc(26,NPCstat:picture,140)
	jig npc(26)
	tb(5012)
	tb(5013)
	set tag(281,1)
)

#did invest
if(check tag(258)) then(

	if(pay money(30)) then(
		jig hero(0)
		tb(5019)
		wait(2)
		tb(5020)
		wait(2)
		jig npc(26)
		tb(5021)
		tb(5022)
		jig hero(0)
		tb(5023)
		jig npc(26)
		tb(5024)
		walk npc(26,right,3)
		wait for npc(26)
		walk npc(26,up,2)
		wait for npc(26)
		walk npc(26,up,1)
		jig hero(0)
		show text box(5025)
		wait for npc(26)
		set npc frame(26,0)
		wait for text box
		wait(2)
		set npc direction(26,left)
		wait(3)
		set npc direction(26,down)
		wait(6)
		jig npc(26)
		tb(5026)
		wait(15)
		jig hero(0)
		tb(5027)
		jig npc(26)
		tb(5028)
		wait(2)
		set npc direction(26,right)
		wait(2)
		walk npc(26,up,3)
		wait for npc(26)
		set tag(282,1)
		wait(3)
		jadeup(3,2)
		wait(3)
		set party in
	)
	else(
		jig hero(0)
		tb(5017)
		alter npc(26,NPCstat:picture,141)
		jig npc(26)
		tb(5018)
		set party in
		if(check tag(3)) then(play song(35))
		if(check tag(4)) then(play song(28))
		if(check tag(5)) then(play song(36))
		if(check tag(6)) then(play song(4))
	)
)

#did not invest
else(
	jig hero(0)
	tb(5014)
	alter npc(26,NPCstat:picture,141)
	jig npc(26)
	tb(5015)
	set party in
	if(check tag(3)) then(play song(35))
	if(check tag(4)) then(play song(28))
	if(check tag(5)) then(play song(36))
	if(check tag(6)) then(play song(4))
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, fralinmanx, begin
suspend player
suspend npcs
suspend obstruction

if(current map==1,or,currentmap==2,or,currentmap==3,or,currentmap==4) then(
	if(check tag(45)) then(fralinmanx1)

	#from entering the door
	palout(1)
	camera follows hero(0)
	teleport to map(currentmap+4,3,116)
	stop song
	wait(1)
	pan camera(south,0,0)
	set hero position(0,3,118)
	wait(1)
	palin(1)
	fralinmanx2
)
else(
#checking end part
if(check tag(45)) then(fralinmanx3)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, fralinmanx1, begin
#have mi'la, already seen it
if(check tag(284)) then(
	pan camera(south,0,0)
	set party out
	swap by position(find hero(0),0)
	walk hero(0,down,1)
	wait for hero(0)
	set npc position(1,herox(0),heroy(0))
	walk npc(1,left,1)
	set hero direction(0,left)
	wait for npc(1)
	set npc frame(1,0)
	alter npc(1,NPCstat:picture,82)
	set npc direction(1,right)
	wait(5)
	walk hero(0,up,1)
	wait for hero(0)
)
#have mi'la, first time entering
else(
	pan camera(south,0,0)
	set party out
	swap by position(find hero(0),0)
	walk hero(0,down,1)
	wait for hero(0)
	set npc position(1,herox(0),heroy(0))
	walk npc(1,left,1)
	set hero direction(0,left)
	wait for npc(1)
	set npc frame(1,0)
	alter npc(1,NPCstat:picture,82)
	set npc direction(1,right)
	tb(5029)
	wait(5)
	jig hero(0)
	tb(5030)
	alter npc(1,NPCstat:picture,12)
	jig npc(1)
	tb(5031)
	wait(2)
	alter npc(1,NPCstat:picture,82)
	set npc direction(1,up)
	wait(3)
	set npc direction(1,right)
	wait(6)
	tb(5032)
	wait(10)
	walk hero(0,up,1)
	wait for hero(0)
)
end
###
##########################
script, fralinmanx2, begin
#already seen it
if(check tag(283)) then(
play song(75)
)
#haven't seen it
else(
	wait(20)
	jig npc(13)
	show text box(5033)
	wait(3)
	set npc direction(13,left)
	wait(3)
	set npc direction(13,down)
	wait for text box
	pan camera(south,0,0)
	set hero speed(0,2)
	walk hero(0,up,1)
	wait for hero(0)
	set hero frame(0,0)
	jig hero(0)
	play song(75)
	tb(5034)
	wait(2)
	walk npc(13,left,1)
	show text box(5035)
	wait for npc(13)
	set npc frame(13,0)
	wait for text box
	wait(12)
	set npc direction(13,down)
	wait(5)
	jig npc(13)
	tb(5036)
	jig hero(0)
	tb(5037)
	wait(3)
	set npc frame(13,1)
	wait(3)
	set npc frame(13,0)
	wait(3)
	tb(5038)
	wait(25)
	alter npc(13,NPCstat:movespeed,1)
	walk npc(13,down,1)
	wait for npc(13)
	set npc frame(13,0)
	wait(5)
	set npc frame(13,1)
	wait(3)
	set npc frame(13,0)
	tb(5039)
	jig hero(0)
	tb(5040)
	jig npc(13)
	tb(5041)
	tb(5042)
	wait(25)
	tb(5043)
	wait(4)
	set npc direction(13,left)
	wait(10)
	jig npc(13)
	tb(5044)
	wait(15)
	set npc direction(13,down)
	wait(5)
	jig npc(13)
	tb(5045)
	wait(4)
	jig hero(0)
	tb(5046)
	jig npc(13)
	tb(5047)
	wait(10)
	jig hero(0)
	tb(5048)
	wait(2)
	tb(5049)
	wait(4)
	jig npc(13)
	set npc direction(13,right)
	jig npc(13)
	tb(5050)
	wait(15)
	jig npc(13)
	tb(5051)
	wait(15)
	set npc direction(13,down)
	jig npc(13)
	tb(5052)
	jig hero(0)
	tb(5053)
	alter npc(13,NPCstat:displaytext,5054)
	set tag(283,1)
	set hero speed(0,hspeed)
)
end
###
##########################
script, fralinmanx3, begin
#have mi'la, already seen it
if(check tag(284)) then(
	palout(1)
	camera follows hero(0)
	teleport to map(currentmap--4,107,41)
	wait(1)
	pan camera(south,0,0)
	set hero position(0,0,0)
	alter npc(1,NPCstat:picture,82)
	set npc direction(1,right)
	set npc position(1,106,41)
	wait(1)
	palin(1)
	wait(10)
	set hero position(0,107,40)
	walk hero(0,down,1)
	wait for hero(0)
	alter npc(1,NPCstat:picture,12)
	walk npc(1,right,1)
	wait for npc(1)
	set npc position(1,0,1)
	camera follows hero(0)
)

#have mi'la, first time entering
else(
	palout(1)
	camera follows hero(0)
	teleport to map(currentmap--4,107,41)
	wait(1)
	pan camera(south,0,0)
	set hero position(0,0,0)
	alter npc(1,NPCstat:picture,82)
	set npc direction(1,right)
	set npc position(1,106,41)
	wait(1)
	palin(1)
	wait(10)
	set hero position(0,107,40)
	walk hero(0,down,1)
	wait for hero(0)
	tb(5057)
	wait(2)
	set hero direction(0,left)
	wait(3)
	jig hero(0)
	tb(5058)
	wait(15)
	tb(5059)
	jig hero(0)
	tb(5060)
	tb(5061)
	wait(2)
	alter npc(1,NPCstat:picture,12)
	jig npc(1)
	tb(5062)
	jig hero(0)
	tb(5063)
	jig npc(1)
	tb(5064)
	walk npc(1,right,1)
	wait for npc(1)
	set npc position(1,0,1)
	set tag(284,1)
	camera follows hero(0)
)
end
###

#######################
script, lazyfarmer, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#4th part
if(check tag(287),and,check tag(288),and,check tag(289)) then(
	if(check tag(286)) then(
		tb(5142)
	)
	else(
		tb(5134)
		tb(5135)
		tb(5139)
		tb(5140)
		get money(10)
		tb(5141)
		set tag(286,1)
	)
)

#3rd part
if(check tag(287),and,check tag(288),and,check tag(289)==false) then(
	if(check tag(286)) then(
		tb(5128)
	)
	else(
		tb(5117)
		tb(5118)
		tb(5122)
		set tag(286,1)
	)

	#check if buy
	if(check tag(258)) then(
		tb(5129)
		tb(5133)
		palout(2)
		teleport to map(0,0,0)
		wait(1)
		palin(1)
		wait(10)
		set maps
		advance time of day (1)
		wait(10)
		palout(1)
		set hp
		wait(1)
		teleport to map(1+poff,43,16)
		set hero direction(0,down)
		set tag(289,1)
		wait(1)
		palin(2)
		set tag(286,0)
	)
	else(
		tb(5123)
		tb(5127)
	)
)

#2nd part
if(check tag(287),and,check tag(288)==false,and,check tag(289)==false) then(
	if(check tag(286)) then(
		tb(5111)
	)
	else(
		tb(5099)
		tb(5100)
		tb(5104)
		tb(5105)
		set tag(286,1)
	)

	#check if buy
	if(check tag(258)) then(
		tb(5112)
		tb(5116)
		palout(2)
		teleport to map(0,0,0)
		wait(1)
		palin(1)
		wait(10)
		set maps
		advance time of day (1)
		wait(10)
		palout(1)
		set hp
		wait(1)
		teleport to map(1+poff,43,16)
		set hero direction(0,down)
		set tag(288,1)
		wait(1)
		palin(2)
		set tag(286,0)
	)
	else(
		tb(5106)
		tb(5110)
	)
)

#1st part
if(check tag(287)==false,and,check tag(288)==false,and,check tag(289)==false) then(
	if(check tag(286)) then(
		tb(5093)
	)
	else(
		tb(5065)
		if(check tag(258)) then(
			set tag(258,0)
			tb(5071)
			tb(5075)
			tb(5076)
			tb(5080)
			tb(5081)
			tb(5082)
			tb(5086)
			tb(5087)
			set tag(286,1)
			set tag(290,1)
		)

		else(
			tb(5066)
			tb(5070)
			set tag(258,0)
		)

	)

	#check if buy
	if(check tag(258),and,check tag(290)) then(
		tb(5094)
		tb(5098)
		palout(2)
		teleport to map(0,0,0)
		wait(1)
		palin(1)
		wait(10)
		set maps
		advance time of day (1)
		wait(10)
		palout(1)
		set hp
		wait(1)
		teleport to map(1+poff,43,16)
		set hero direction(0,down)
		set tag(287,1)
		wait(1)
		palin(2)
		set tag(286,0)
	)
	else(
		if(check tag(290)) then(
		tb(5088)
		tb(5092)
		)
	)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, ghostatinn, begin
suspend player
suspend npcs
suspend obstruction

#innkeeper is dead
if(check tag(212)) then(
	tb(5154)
)
else(
#have heard innkeep mention ghost
if(check tag(291),and,check tag(212)==false) then(
	#have heard hooligan mention
	if(check tag(292)) then(
		tb(5153)
	)
	#have not heard hooligan mention
	else(
		tb(5146)
		tb(5147)
		tb(5151)
		tb(5152)
		set tag(292,1)
	)

)
#have not heard innkeep mention ghost
else(
	tb(5145)
)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, badadvice, begin
suspend player
suspend npcs
suspend obstruction

jig npc(29)
tb(5168)
#if read the bounty sign
if(check tag(449)) then(wobblerbounty)
else(
if(herox(0)==56) then(
	walk npc(29,right,1)
	wait for npc(29)
	set npc direction(29,left)
)
else(
	walk npc(29,left,1)
	wait for npc(29)
	if(herox(0)==57) then(set npc direction(29,down))
	else(set npc direction(29,right))
)
set npc frame(29,0)
wait(5)
jig hero(0)
tb(5169)
jig npc(29)
tb(5173)
alter npc(29,NPCstat:script,0)
alter npc(29,NPCstat:displaytext,5173)
)
resume obstruction
resume npcs
resume player
end
###

#########################
script, badadvice2, begin
suspend player
suspend npcs
suspend obstruction

palout(1)
teleport to map(5+poff,3,202)
stop song
wait(1)
pan camera(south,0,0)
set hero position(0,3,205)
wait(1)
palin(1)

wait(10)
walk hero(0,up,3)
wait for hero(0)
wait(10)
set hero direction(0,left)
wait(15)
set hero direction(0,up)
wait(3)
set hero direction(0,right)
wait(15)
set hero direction(0,up)
wait(3)

write pass block(3,203,128)
variable(i)
variable(cx)
variable(cy)
set variable(cx,camera pixel x)
set variable(cy,camera pixel y)
for(i,1,6,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)
write map block(3,202,0)
walk hero(0,down,2)
set hero direction(0,up)
for(i,1,6,1) do(
put camera(cx--1,cy)
wait(1)
put camera(cx+1,cy)
wait(1)
)
wait(10)
show backdrop(1)
wait(5)
palout(2)
show map
wait for hero(0)
camera follows hero(0)

teleport to map(0,0,0)
palin(1)
wait(15)
set maps
advance time of day (1)
palout(1)
set hp
wait(1)
teleport to map(1+poff,56,50)
stop song
wait(15)
palin(10)

if(paymoney(50)) then(set variable(wobblermoney,51))
else(
	if(paymoney(40)) then(set variable(wobblermoney,42))
	else(
		if(paymoney(30)) then(set variable(wobblermoney,33))
		else(
			if(paymoney(20)) then(set variable(wobblermoney,24))
			else(
				if(paymoney(10)) then(set variable(wobblermoney,15))
			)
		)
	)
)

if(check tag(44)) then(
set hero stat(find hero(0),0,get hero stat(find hero(0),0,current stat)--(get hero stat(find hero(0),0,current stat)/2),current stat)
if(get hero stat(find hero(0),0,currentstat)==0) then(
set hero stat (findhero(0),0,1,currentstat))
)
if(check tag(45)) then(
set hero stat(find hero(1),0,get hero stat(find hero(1),0,current stat)--(get hero stat(find hero(1),0,current stat)/2),current stat)
if(get hero stat(find hero(1),0,currentstat)==0) then(
set hero stat (findhero(1),0,1,currentstat))
)
if(check tag(46)) then(
set hero stat(find hero(2),0,get hero stat(find hero(2),0,current stat)--(get hero stat(find hero(2),0,current stat)/2),current stat)
if(get hero stat(find hero(2),0,currentstat)==0) then(
set hero stat (findhero(2),0,1,currentstat))
)
if(check tag(47)) then(
set hero stat(find hero(3),0,get hero stat(find hero(3),0,current stat)--(get hero stat(find hero(3),0,current stat)/2),current stat)
if(get hero stat(find hero(3),0,currentstat)==0) then(
set hero stat (findhero(3),0,1,currentstat))
)


wait(20)
jig horror
wait(4)
jig horror
wait(10)
set hero direction(0,left)
wait(15)
jig hero(0)
tb(5174)

set tag(294,1)

if(check tag(3)) then(play song(35))
if(check tag(4)) then(play song(28))
if(check tag(5)) then(play song(36))
if(check tag(6)) then(play song(4))

resume obstruction
resume npcs
resume player
end
###

######################
script, buybeer, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#have already bought the fool one
if(check tag(295)) then(
	tb(5196)
	if(check tag(258)) then(
		if(pay money(1)) then(
			tb(5190)
			tb(5194)
			tb(5195)
			set tag(258,1)
		)
		else(
			tb(5185)
			tb(5189)
		)
	)
	else(
		tb(5180)
		tb(5184)
	)
)

#first time through
else(
	tb(5178)
	tb(5179)
	if(check tag(258)) then(
		if(pay money(1)) then(
			tb(5190)
			tb(5194)
			tb(5195)
			set tag(258,1)
		)
		else(
			tb(5185)
			tb(5189)
		)
	)
	else(
		tb(5180)
		tb(5184)
	)
)

resume obstruction
resume npcs
resume player
end
###

###############################
script, fralinindoorload, begin

#if fralin npcs dead due to dormant monster, play the breeze fx
if(check tag(297)) then(play song(17))

if(check tag(297)) then(
write map block(3,73,16)
write map block(3,74,111)

write map block(9,97,16)
write map block(9,98,26)

write map block(3,130,114)
write map block(3,131,115)

write map block(3,19,16)
write map block(3,20,111)
)


#wobbler stuff
#if lost money and wobbler has been killed by party or charlock
if(check tag(605)==false,and,check tag(294),and,(check tag(246),or,check tag(442))) then(
	create npc(32,4,200)
)

#if wobbler has been killed by party
if(check tag(606)==false,and,check tag(246)==false,and,check tag(442)) then(
	create npc(32,3,199)
)

#if wobbler has been killed by charlocke
if(check tag(607)==false,and,check tag(246),and,check tag(442)==false) then(
	create npc(32,3,199)
)

end
###

##########################
script, gitlockdoor, begin
suspend player
suspend npcs
suspend obstruction

variable (d1)
variable (d2)
variable (d3)
variable (d4)
variable (xxx)
variable (i)
set tag(15,0)
set tag(27,0)

if(herox(0)==21,and,heroy(0)==18) then(
set hero direction(0,left)
	if (inventory (29)>>0) then(
		tb(222)
		if (check tag (15)) then(
			delete item (29,1)
			suspend npc walls

			set variable (xxx,hero pixel X (0))
			set variable (d1,NPC at spot (herox(0)--1,heroy(0)))
			set variable (d2,NPC at spot (herox(0)--1,heroy(0)--1))
			set variable (d3,NPC at spot (herox(0)--1,heroy(0)--2))

			for (i,1,40,1) do(
				put npc (d1,xxx--20,hero pixel y(0)+i)
				put npc (d2,xxx--20,hero pixel y(0)--20+i)
				put npc (d3,xxx--20,hero pixel y(0)--40+i)
				wait (1)
			)

			#set npc position (d1,0,2)
			#set npc position (d2,0,2)
			#set npc position (d3,0,2)
			#set npc position (npc at spot(herox(0),heroy(0)),0,2)
			destroy npc(d1)
			destroy npc(d2)
			destroy npc(d3)
			destroy npc(npc at spot(herox(0),heroy(0)))

			resume npc walls
			set tag(304,1)
			write pass block(21,18,0)
		)
	)
	else(tb(84))
)
else(
if(herox(0)==9,and,heroy(0)==16) then(
	set hero direction(0,up)
	if (inventory (29)>>0) then(
		tb(222)
		if (check tag (15)) then(
			delete item (29,1)
			suspend npc walls

			set variable (xxx,hero pixel X (0))
			set variable (d1,NPC at spot (herox(0),heroy(0)))
			set variable (d2,NPC at spot (herox(0),heroy(0)--1))
			set variable (d3,NPC at spot (herox(0),heroy(0)--2))
			set variable (d4,NPC at spot (herox(0),heroy(0)--3))
			write pass block(herox(0)--1,heroy(0)--1,128)

			for (i,1,20,1) do(
				put npc (d1,xxx--i,hero pixel y(0))
				put npc (d2,xxx--i,hero pixel y(0)--20)
				put npc (d3,xxx--i,hero pixel y(0)--40)
				put npc (d4,xxx--i,hero pixel y(0)--60)
				wait (1)
			)

			#set npc position (d1,0,2)
			#set npc position (d2,0,2)
			#set npc position (d3,0,2)
			#set npc position (d4,0,2)
			destroy npc(d1)
			destroy npc(d2)
			destroy npc(d3)
			destroy npc(d4)
			create npc(34,9,13)
			write pass block(herox(0)--1,heroy(0)--1,1+2+4+8)

			resume npc walls
			set tag(305,1)
			write pass block(9,16,0)
		)
	)
	else(tb(84))
)
)
do(
if(herox(0)==99,and,heroy(0)==53) then(
set hero direction(0,up)
	if (check tag(302)==false) then(
		if(check tag(308)) then(
			jig hero(0)
			tb(6662)
		)
	)
	if (check tag(308)==false) then(
		set party out
		swap by position(find hero(1),0)
		jig hero(0)
		tb(6661)
		set party in
		set tag(308,1)
	)

	if(check equipment(find hero(0),4)==206) then(unequip(find hero(0),4))
	if(check equipment(find hero(1),4)==206) then(unequip(find hero(1),4))
	if(check equipment(find hero(2),4)==206) then(unequip(find hero(2),4))

	if (inventory (206)>>0) then(
		tb(6665)
		suspend npc walls

		set variable (xxx,hero pixel X (0))
		set variable (d1,NPC at spot (herox(0),heroy(0)))
		set variable (d2,NPC at spot (herox(0),heroy(0)--1))
		set variable (d3,NPC at spot (herox(0),heroy(0)--2))
		set variable (d4,NPC at spot (herox(0),heroy(0)--3))
		write pass block(herox(0)--1,heroy(0)--1,128)

		for (i,1,20,1) do(
			put npc (d1,xxx--i,hero pixel y(0))
			put npc (d2,xxx--i,hero pixel y(0)--20)
			put npc (d3,xxx--i,hero pixel y(0)--40)
			put npc (d4,xxx--i,hero pixel y(0)--60)
			wait (1)
		)

		#set npc position (d1,0,2)
		#set npc position (d2,0,2)
		#set npc position (d3,0,2)
		#set npc position (d4,0,2)
		destroy npc(d1)
		destroy npc(d2)
		destroy npc(d3)
		destroy npc(d4)
		write pass block(herox(0)--1,heroy(0)--1,1+2+4+8)
		resume npc walls
		set tag(307,1)
		write pass block(99,53,0)
		delete item(206,1)
		get item(254,1)
	)
)
)

resume obstruction
resume npcs
resume player
end
###

#############################
script, gitlehtreasure, begin
suspend player
suspend npcs
suspend obstruction

#Ghost icon
if(herox(0)==29,or,herox(0)==30,or,herox(0)==31) then(
set npc position(npc at spot(30,20),0,2)
set tag(300,1)
get item(204,1)
tb(6657)
)
else(
#Shade icon
if(herox(0)==44,or,herox(0)==45,or,herox(0)==46) then(
set npc position(npc at spot(45,54),0,2)
set tag(301,1)
get item(205,1)
tb(6658)
)
)
do(
#Shadow icon
if(herox(0)==60,or,herox(0)==61,or,herox(0)==62) then(
set npc position(npc at spot(61,43),0,2)
set tag(303,1)
get item(207,1)
tb(6660)
)
)
do(
#Phantasm icon
if(herox(0)==97,or,herox(0)==98,or,herox(0)==99) then(
set npc position(npc at spot(98,19),0,2)
set tag(302,1)
get item(206,1)
tb(6659)
)
)

resume obstruction
resume npcs
resume player
end
###

###################################
script, gitlehautoload, ARGH, begin

#VONE TIM VONLY!
if(ARGH==0) then(
	if(check tag(300)) then( destroy npc(npc at spot(30,20)) )
	if(check tag(301)) then( destroy npc(npc at spot(45,54)) )
	if(check tag(302)) then( destroy npc(npc at spot(98,19)) )
	if(check tag(303)) then( destroy npc(npc at spot(61,43)) )
	if(check tag(304)) then(
		destroy npc (npc at spot(20,18))
		destroy npc (npc at spot(20,17))
		destroy npc (npc at spot(20,16))
		destroy npc (npc at spot(21,18))
		write pass block(21,18,0)
	)
	if(check tag(305)) then(
		destroy npc (npc at spot(9,13))
		destroy npc (npc at spot(9,14))
		destroy npc (npc at spot(9,15))
		destroy npc (npc at spot(9,16))
		write pass block(9,16,0)
		create npc(34,9,13)
	)
	if(check tag(306)) then(
		destroy npc (npc at spot(20,2))
		destroy npc (npc at spot(20,3))
		destroy npc (npc at spot(20,4))
		destroy npc (npc at spot(16,2))
		destroy npc (npc at spot(16,3))
		destroy npc (npc at spot(16,4))
		write pass block(15,4,0)
	)
	if(check tag(307)) then(
		destroy npc (npc at spot(99,50))
		destroy npc (npc at spot(99,51))
		destroy npc (npc at spot(99,52))
		destroy npc (npc at spot(99,53))
		write pass block(99,53,0)
	)
)

#passblocks taken care of outside of ARGH
if(check tag(304)) then(write pass block(21,18,0))
if(check tag(305)) then(write pass block(9,16,0))
if(check tag(306)) then(write pass block(15,4,0))
if(check tag(307)) then(write pass block(99,53,0))


#water drain
if(check tag(608)) then(
	variable(d)
	variable(top)
	variable(mid)
	variable(low)
	set variable(top,read map block(106,0))
	set variable(mid,read map block(106,1))
	set variable(low,read map block(106,2))
	write map block(82,17,top)
	write map block(83,17,top+1)
	write map block(82,18,mid)
	write map block(83,18,mid+1)
	for(d,19,55,1) do(
		write map block(82,d,low)
		write map block(83,d,low+1)
	)
	for(d,57,58,1) do(
		write map block(82,d,low)
		write map block(83,d,low+1)
	)
	write pass block(83,19,0)
	write pass block(82,44,0)
)

#check if rested and need to put trigger back in
if((herox(0)<<85,and,herox(0)>>72),and,(heroy(0)<<10,and,heroy(0)>>2)) then(
	set npc position(4,83,8)
	set npc direction(4,down)
	alter npc(4,NPCstat:picture,496)
	alter npc(4,NPCstat:palette,26)

	if( read map block(82,17) <> read map block(106,0) ) then(set npc frame(4,0))
	else(set npc frame(4,1))
)

end
###

##########################
script, gitlehdrain, begin
suspend player
suspend npcs
suspend obstruction

variable(top)
set variable(top,read map block(106,0))

if( read map block(82,17) <> top ) then(
	stop song
	set tag(608,1)
	set npc frame(4,1)
	wait(10)

	variable(mid)
	variable(low)
	set variable(mid,read map block(106,1))
	set variable(low,read map block(106,2))

	variable(cx)
	variable(cy)
	set variable(cx,camera pixel x)
	set variable(cy,camera pixel y)
	variable(i)
	for(i,1,6,1) do(
		put camera(cx--1,cy)
		wait(1)
		put camera(cx+1,cy)
		wait(1)
	)
	put camera(cx,cy)
	pan camera(south,12,10)
	wait for camera
	set variable(cx,camera pixel x)
	set variable(cy,camera pixel y)
	wait(10)
	for(i,1,6,1) do(
		put camera(cx--1,cy)
		wait(1)
		put camera(cx+1,cy)
		wait(1)
	)

	write map block(82,17,top)
	write map block(83,17,top+1)
	write map block(82,18,mid)
	write map block(83,18,mid+1)
	wait(2)
	for(i,19,55,1) do(
		write map block(82,i,low)
		write map block(83,i,low+1)
		wait(2)
	)
	for(i,57,58,1) do(
		write map block(82,i,low)
		write map block(83,i,low+1)
		wait(1)
	)
	pan camera(up,12,4)
	wait for camera
	write pass block(83,19,0)
	write pass block(82,44,0)
	play song(66)
)

resume obstruction
resume npcs
resume player
end
###

###############################
script, shhsomeonecoming, begin
suspend player
suspend npcs
suspend obstruction

tb(1349)
battleflash
ff(125)
tweak palette(-1,-1,-1)
update palette
if((knows spell(find hero(2),576+1))==false) then(
	set party out
	swap by position(find hero(2),0)
	wait(3)
	jig hero(0)
	tb(1350)
	jig hero(0)
	jig hero(0)
	jig hero(0)
	tb(1353)
	write spell(find hero(2),0,11,576+1)
	wait(3)
	tb(1351)
	jig gahn
	tweak palette(-1,-1,-1)
	update palette
	tb(1352)
	set party in
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, adlezinn, begin
suspend player
suspend npcs
suspend obstruction

#n is the npc number
variable(n)
set variable(n,9)

set tag(258,0)
jig npc(n)
tb(6668)

if(check tag(258)) then(
	if(pay money(2)) then(
		jig npc(n)
		tb(6671)
		wait(5)
		palout(2)

		innfancy

		set hp
		wait(1)
		teleport to map(18+poff,6,173)
		suspend npcs
		innrest
		set npc position(n,0,0)
		alter npc(n,NPCstat:movetype,npcmovetype:standstill)
		pan camera(south,0,0)
		set party out
		swap by position(find hero(0),0)
		set hero position(0,4,171)
		if(check tag(85)) then(set npc position(1,8,171))
		if(check tag(86)) then(set npc position(2,3,172))
		if(check tag(87)) then(set npc position(3,1,172))
		set hero speed(0,2)
		alter npc(1,NPCstat:movespeed,2)
		alter npc(2,NPCstat:movespeed,2)
		alter npc(3,NPCstat:movespeed,2)
		wait(15)
		palin(2)
		wait(5)

		walk hero(0,right,1)
		walk npc(1,left,1)
		walk npc(2,left,1)
		wait for hero(0)
		walk hero(0,down,2)
		walk npc(1,down,2)
		walk npc(2,down,2)
		walk npc(3,right,1)
		wait for npc(3)
		walk npc(3,down,1)
		wait for hero(0)
		walk hero(0,right,1)
		walk npc(1,left,1)
		walk npc(2,right,1)
		walk npc(3,down,1)
		wait for hero(0)
		set npc position(1,0,0)
		walk npc(2,right,3)
		walk npc(3,right,3)
		set hero direction(0,down)
		wait for npc(2)
		walk npc(2,up,1)
		walk npc(3,right,1)
		wait for npc(2)
		walk npc(3,up,1)
		set npc position(2,0,0)
		wait for npc(3)
		set npc position(3,0,0)
		wait(5)
		set party in
		set hero speed(0,hspeed)
		camera follows hero(0)

		save game
	)
	else(
		jig npc(n)
		tb(6672)
	)
)
else(
jig npc(n)
tb(6673)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, adlezicon, begin
suspend player
suspend npcs
suspend obstruction

#check if waiting
if( adleziconsave <> 0 ) then(
	#get icon
	if(iconwaitcheck(adleziconsave,adleziconhour,adleziconday)) then(
		jig npc(10)
		tb(6717)
		tb(6706 + (adleziconsave -- 116 -- 8) )
		get item(adleziconsave)
		set variable(adleziconsave,0)
		set variable(adleziconhour,0)
		set variable(adleziconday,0)
	)
	#still waiting
	else(
		jig npc(10)
		tb(6716)
	)
)

#main
set tag(258,0)
jig npc(10)
tb(6714)
if(check tag(258)) then( iconcraft(50,116,6674,6,4,2) )
else(
jig npc(10)
tb(6715)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, adlezitem, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(11)
tb(6718)

#check if want to buy
if(check tag(258)) then(

alter npc(12,NPCstat:script,0)
wait(3)
set tag(258,0)
tb(6596)
if(check tag(258)) then(
	use shop(2)
)
else( itemadlez )
wait(1)
alter npc(12,NPCstat:script,199)

)#end check to buy

#don't want to buy
else(
jig npc(11)
tb(6719)
)

resume obstruction
resume npcs
resume player
end
###

###########################
script, adleztrainer, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(11)
tb(6730)

if(check tag(258)) then(
	#npc, firstscreen,firsttextbox,$cost,phasecost,
	#strup,accup,defup,ddgup,sklup,evdup,
	#strcap,acccap,defcap,ddgcap,sklcap,evdcap
	stattrain(11,86,6720,4,2,6,9,3,9,6,6,45,40,20,35,50,20)
)
else(
	wait(3)
	jig npc(11)
	tb(6731)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, adleztrader, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(12)
tb(6638)
if(check tag(258)) then( trader(7372,5) )
else(
wait(2)
jig npc(12)
tb(6639)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, adlezavis, whichone, begin
suspend player
suspend npcs
suspend obstruction

#avis seller
if(whichone==1) then(
	if(check tag(263)) then(
		tb(5251)
	)
	if(check tag(312),and,check tag(263)==false) then(
		jig npc(13)
		tb(5248)
		tb(5249)
		wait(3)
		tb(5250)
		wait(3)
		if(check tag(261)==false) then(
			jig gahn
			tb(6616)
			set tag(261,1)
			get item(72,1)
		)
		set tag(263,1)
		set tag(316,0)
		set tag(317,0)
		wait(3)
		jadeup(4,2)
		wait(3)
	)
	if(check tag(312)==false,and,check tag(263)==false) then(
		jig npc(13)
		tb(5197)
		set tag(311,1)
	)
)

#jay
if(whichone==2) then(
	if(check tag(314)) then(
		#talked to avis keeper
		if(check tag(311)) then(
			#jay returned from quest
			if(check tag(312)) then(
				set tag(258,0)
				if(check tag(315)) then(
					jig npc(14)
					tb(5247)
				)
				else(
					jig hero(0)
					tb(5231)
					jig npc(14)
					tb(5235)
					tb(5236)
					tb(5237)
					jig npc(14)
					tb(5238)
				)

				if(pay money(20)) then(get money(20))
				else(set tag(258,0))
				if(check tag(258)) then(
					lose money(20)
					tb(5239)
					wait(3)
					jig npc(14)
					tb(5240)
					jig npc(14)
					tb(5241)
					wait(3)
					palout(2)
					set tag(313,1)
					wait(1)
					palin(2)
				)
				else(
					jig hero(0)
					tb(5242)
					jig npc(14)
					tb(5246)
					set tag(315,1)
				)
			)
			#jay has yet to quest
			else(
				jig hero(0)
				tb(5207)
				jig npc(14)
				tb(5211)
				wait(5)
				jig npc(14)
				tb(5212)
				jig hero(0)
				tb(5213)
				jig npc(14)
				tb(5217)
				wait(3)
				tb(5218)
				jig hero(0)
				tb(5219)
				jig npc(14)
				tb(5223)
				jig hero(0)
				if(check tag(19)) then(tb(5224))
				if(check tag(20)) then(tb(5225))
				if(check tag(21)) then(tb(5226))
				if(check tag(22)) then(tb(5227))
				set party out
				if(check tag(20)) then(
					swap by position(find hero(0),0)
					jig hero(0)
					tb(5224)
				)
				if(check tag(22)) then(
					swap by position(find hero(2),0)
					jig hero(0)
					tb(5226)
				)
				jig npc(14)
				tb(5228)
				jig hero(0)
				tb(5229)
				wait(3)
				palout(2)
				set variable(jayday,day)
				set npc position(14,0,0)
				set tag(312,1)
				set party in
				wait(1)
				palin(2)
			)
		)
		#haven't met avis keeper
		else(
			jig npc(14)
			tb(5204)
		)
	)
	#initial text box
	else(
		jig npc(14)
		tb(5203)
		set tag(314,1)
	)

)

resume obstruction
resume npcs
resume player
end
###

########################
script, adlezshop, begin
suspend player
suspend npcs
suspend obstruction

if(herox(0)==3) then(adlezitem)
if(herox(0)==5) then(adlezicon)

resume obstruction
resume npcs
resume player
end
###

##########################
script, naivedreams, begin
suspend player
suspend npcs
suspend obstruction

#in adlez
if(currentmap==18,or,currentmap==19,or,currentmap==20,or,currentmap==21) then(
if(check tag(320),and,check tag(321)) then(
	jig npc(13)
	tb(5259)
	jig hero(0)
	tb(5260)
	wait(15)
	jig npc(13)
	tb(5269)
	jig hero(0)
	tb(5270)
	jig npc(13)
	tb(5274)
	tb(5275)
	wait(3)
	jadeup(2,1)
	wait(3)
	alter npc(13,NPCstat:script,0)
	alter npc(13,NPCstat:displaytext,5276)
)
if(check tag(320),and,check tag(321)==false) then(
	jig npc(13)
	tb(5258)
	set tag(321,1)
)
if(check tag(320)==false,and,check tag(321)==false) then(
	jig npc(13)
	tb(5257)
	set tag(320,1)
)
)

#in rorc
if(currentmap==77,or,currentmap==78,or,currentmap==79,or,currentmap==80) then(
	#after init
	if(check tag(647)) then(
		jig npc(30)
		tb(7768)
	)
	#init
	else(
		stop song
		jig npc(30)
		tb(7763)
		play song(69)
		tb(7764)
		jig npc(30)
		tb(7765)
		wait(10)
		jig npc(30)
		tb(7766)
		wait(10)
		jig npc(30)
		tb(7767)
		variable(randomroo)
		set variable(randomroo,random(0,3))
		wait(2)
		set npc frame(30,1)
		wait(2)
		set hero frame(0,1)
		wait(2)
		set npc frame(30,0)
		wait(2)
		set hero frame(0,0)
		tb(4568+randomroo)
		get item(61+randomroo,2)
		set tag(647,1)
	)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, elusiveprey, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(325)==false) then(
	#face player
	if(herox(0)<<npcx(14)) then(set npc direction(14,left))
	if(herox(0)==npcx(14)) then(set npc direction(14,down))
	if(herox(0)>>npcx(14)) then(set npc direction(14,right))

	#after initial text
	if(check tag(323)) then(
		jig npc(14)
		tb(5282)
	)
	#initial text
	else(
		jig npc(14)
		tb(5277)
		tb(5278)
		tb(5279)
		jig npc(14)
		tb(5280)
		tb(5281)
		tb(6732)
		set tag(323,1)
	)
)
#quest complete
if(check tag(325)) then(
	tb(5296)
)
#have kresse item
if(check tag(325)==false,and,check tag(324)) then(
	#face player
	if(herox(0)<<npcx(14)) then(set npc direction(14,left))
	if(herox(0)==npcx(14)) then(set npc direction(14,down))
	if(herox(0)>>npcx(14)) then(set npc direction(14,right))

	jig hero(0)
	tb(5283)
	jig npc(14)
	stop song
	tb(5287)
	jig npc(14)
	tb(5288)
	jig npc(14)
	tb(5289)
	jig hero(0)
	tb(5290)
	wait(3)
	tb(5294)
	set tag(325,1)
	set npc direction(14,up)
	wait(3)
	jadeup(4,1)
	wait(3)
	jig npc(14)
	play song(82)
	tb(5295)
	delete item(14,1)
	alter npc(14,NPCstat:script,0)
	alter npc(14,NPCstat:displaytext,5295)
	alter npc(14,NPCstat:movetype,NPCmovetype:standstill)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, minimaleffort, begin
suspend player
suspend npcs
suspend obstruction

jig npc(19)
tb(5297)

if(check tag(19)) then(
jig hero(0)
tb(5298)
jig npc(19)
tb(5299)
)

if(check tag(21)) then(
jig hero(0)
tb(5300)
)

if(check tag(22)) then(
jig hero(0)
tb(5301)
jig npc(19)
tb(5302)
)

if(check tag(20)) then(
jig hero(0)
tb(5303)
tb(5304)
jig npc(19)
tb(5305)
jig hero(0)
tb(5306)
jig npc(19)
tb(5307)
tb(5308)
jig hero(0)
tb(5309)
jig npc(19)
tb(5310)
jig hero(0)
tb(5311)
jig npc(19)
tb(5312)
jig hero(0)
tb(5313)
jig hero(0)
tb(5314)
jig npc(19)
tb(5315)
jig hero(0)
tb(5316)
jig npc(19)
tb(5317)
alter npc(19,NPCstat:movespeed,10)
if(npcy(19)==78) then(
walk npc(19,down,1)
wait for npc(19)
)
walk npc(19,right,9)
wait(3)
set hero direction(0,right)
wait for npc(19)
set tag(326,1)
wait(3)
jadeup(3,1)
wait(3)
jig hero(0)
tb(5318)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, storytime, whichone, begin
suspend player
suspend npcs
suspend obstruction

#mi'la leading party
if(check tag(20)) then(
	jig npc(whichone)
	tb(5324)
	jig hero(0)
	tb(5325)
)

#johan leading party
if(check tag(21)) then(
	jig npc(whichone)
	tb(5326)
	jig hero(0)
	tb(5327)
)

#pyrus leading party
if(check tag(22)) then(
jig npc(whichone)
tb(5328)
wait(5)
tb(5329)
)

#dogero/main bit
if(check tag(19)) then(
	palout(1)
	set hero position(0,48,52)
	set hero direction(0,down)
	set npc direction(21,up)
	set npc direction(22,up)
	set npc direction(23,right)
	set npc direction(24,left)
	palin(1)
	wait(3)

	#ask if tell a story
	jig npc(24)
	tb(5330)
	jig npc(21)
	tb(5331)
	jig npc(23)
	tb(5332)
	jig npc(22)
	tb(5333)

	#tell story
	if(check tag(327)) then(
		variable(backr)
		variable(backg)
		variable(backb)
		variable(fontr)
		variable(fontg)
		variable(fontb)
		variable(highr)
		variable(highg)
		variable(highb)
		set variable(backr,read color(178,0))
		set variable(backg,read color(178,1))
		set variable(backb,read color(178,2))
		set variable(fontr,read color(175,0))
		set variable(fontg,read color(175,1))
		set variable(fontb,read color(175,2))
		set variable(highr,read color(14,0))
		set variable(highg,read color(14,1))
		set variable(highb,read color(14,2))
		jig hero(0)
		stop song
		tb(5336)
		jig npc(22)
		tb(5337)
		wait(5)
		jig hero(0)
		tb(5338)
		wait(3)
		palout(2)
		variable(hpic)
		set variable(hpic,get hero picture(find hero(0)))
		set hero picture(0,0)
		teleport to map(68,21,36)
		wait(10)
		reset palette
		greyscale palette
		tweak palette (-40,-40,-40)
		update palette
		wait (2)
		reset palette
		greyscale palette
		tweak palette (-20,-20,-20)
		update palette
		wait (2)
		reset palette
		greyscale palette
		tweak palette (-10,-10,-10)
		update palette
		wait (2)
		reset palette
		greyscale palette
		tweak palette (-5,-5,-5)
		update palette
		wait (2)
		reset palette
		greyscale palette
		update palette

		write color(178,0,backr)
		write color(178,1,backg)
		write color(178,2,backb)
		write color(175,0,fontr)
		write color(175,1,fontg)
		write color(175,2,fontb)
		write color(14,0,highr)
		write color(14,1,highg)
		write color(14,2,highb)
		update palette

		wait(15)
		tb(5339)
		tb(5340)
		tb(5341)
		tb(5342)
		tb(5343)
		tb(5344)
		tb(5345)
		tb(5346)
		wait(10)
		tb(5347)
		tb(5348)
		tb(5349)
		tb(5350)
		tb(5351)
		tb(5352)
		wait(3)

		#answer no choice 1
		if(check tag(328)==false) then(
			tb(5353)
			wait(3)
			palout(2)
			set hero picture(0,hpic)
			teleport to map(15,48,52)
			wait(1)
			palin(2)
			wait(5)

			jig hero(0)
			tb(5354)
			alter npc(21,NPCstat:script,0)
			alter npc(22,NPCstat:script,0)
			alter npc(23,NPCstat:script,0)
			alter npc(24,NPCstat:script,0)
			alter npc(21,NPCstat:displaytext,5355)
			alter npc(22,NPCstat:displaytext,5356)
			alter npc(23,NPCstat:displaytext,5357)
			alter npc(24,NPCstat:displaytext,5358)
			set tag(331,1)
		)
		#keep going
		else(
			tb(5359)
			tb(5360)
			wait(3)
			palout(2)
			teleport to map(83,70,80)
			wait(10)
			reset palette
			greyscale palette
			tweak palette (-40,-40,-40)
			update palette
			wait (2)
			reset palette
			greyscale palette
			tweak palette (-20,-20,-20)
			update palette
			wait (2)
			reset palette
			greyscale palette
			tweak palette (-10,-10,-10)
			update palette
			wait (2)
			reset palette
			greyscale palette
			tweak palette (-5,-5,-5)
			update palette
			wait (2)
			reset palette
			greyscale palette
			update palette

			write color(178,0,backr)
			write color(178,1,backg)
			write color(178,2,backb)
			write color(175,0,fontr)
			write color(175,1,fontg)
			write color(175,2,fontb)
			write color(14,0,highr)
			write color(14,1,highg)
			write color(14,2,highb)
			update palette

			wait(10)
			tb(5361)
			tb(5362)
			tb(5363)
			tb(5364)
			tb(5365)
			wait(3)

			#answer no choice 2
			if(check tag(329)==false) then(

				tb(5366)
				tb(5367)
				tb(5368)
				wait(3)
				palout(2)
				set hero picture(0,hpic)
				teleport to map(15,48,52)
				wait(1)
				palin(2)
				wait(5)

				jig hero(0)
				tb(5354)
				alter npc(21,NPCstat:script,0)
				alter npc(22,NPCstat:script,0)
				alter npc(23,NPCstat:script,0)
				alter npc(24,NPCstat:script,0)
				alter npc(21,NPCstat:displaytext,5355)
				alter npc(22,NPCstat:displaytext,5369)
				alter npc(23,NPCstat:displaytext,5357)
				alter npc(24,NPCstat:displaytext,5358)
				set tag(331,1)
			)
			#keep going
			else(
				tb(5370)
				tb(5371)
				tb(5372)
				tb(5373)
				wait(3)
				palout(2)
				teleport to map(68,21,36)
				wait(10)
				reset palette
				greyscale palette
				tweak palette (-40,-40,-40)
				update palette
				wait (2)
				reset palette
				greyscale palette
				tweak palette (-20,-20,-20)
				update palette
				wait (2)
				reset palette
				greyscale palette
				tweak palette (-10,-10,-10)
				update palette
				wait (2)
				reset palette
				greyscale palette
				tweak palette (-5,-5,-5)
				update palette
				wait (2)
				reset palette
				greyscale palette
				update palette
				write color(178,0,backr)
				write color(178,1,backg)
				write color(178,2,backb)
				write color(175,0,fontr)
				write color(175,1,fontg)
				write color(175,2,fontb)
				write color(14,0,highr)
				write color(14,1,highg)
				write color(14,2,highb)
				update palette
				wait(10)
				tb(5374)
				tb(6738)
				tb(5375)
				wait(5)
				tb(5376)
				tb(5377)
				tb(5378)
				tb(5379)
				tb(5380)
				wait(3)

				#answer no choice 3
				if(check tag(330)==false) then(

					tb(5381)
					wait(3)
					palout(2)
					set hero picture(0,hpic)
					teleport to map(15,48,52)
					wait(1)
					palin(2)
					wait(5)

					jig hero(0)
					tb(5382)
					alter npc(21,NPCstat:script,0)
					alter npc(22,NPCstat:script,0)
					alter npc(23,NPCstat:script,0)
					alter npc(24,NPCstat:script,0)
					alter npc(21,NPCstat:displaytext,5355)
					alter npc(22,NPCstat:displaytext,5383)
					alter npc(23,NPCstat:displaytext,5357)
					alter npc(24,NPCstat:displaytext,5358)
					set tag(331,1)
				)
				#keep going
				else(
					tb(5384)
					tb(5385)
					tb(5386)
					tb(6739)
					wait(3)
					palout(2)
					set hero picture(0,hpic)
					set hero direction(0,down)
					teleport to map(15,48,52)
					stop song
					set npc position(21,47,53)
					set npc position(22,48,54)
					set npc position(23,48,53)
					set npc position(24,49,53)
					set npc direction(23,up)
					set npc direction(24,up)
					wait(10)
					palin(2)
					play song(69)
					wait(15)
					jig hero(0)
					tb(5387)
					tb(5388)
					jig hero(0)
					tb(5389)
					tb(5390)
					wait(10)
					jig hero(0)
					tb(5391)
					wait(10)
					jig npc(21)
					tb(5392)
					jig npc(22)
					tb(5393)
					jig npc(23)
					tb(5394)
					jig npc(24)
					tb(5395)
					jig hero(0)
					tb(5396)
					wait(3)
					stop song
					jadeup(5,2)
					play song(29)
					wait(3)
					set tag(331,1)
					alter npc(21,NPCstat:script,0)
					alter npc(22,NPCstat:script,0)
					alter npc(23,NPCstat:script,0)
					alter npc(24,NPCstat:script,0)
					alter npc(21,NPCstat:displaytext,5397)
					alter npc(22,NPCstat:displaytext,5398)
					alter npc(23,NPCstat:displaytext,5399)
					alter npc(24,NPCstat:displaytext,5400)
				)
			)
		)
	)
	#chose not to tell story
	else(
		jig hero(0)
		tb(5334)
		jig npc(whichone)
		tb(5335)
	)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, dreamwork, begin
suspend player
suspend npcs
suspend obstruction

#she stays
if(check tag(332),and,check tag(336)==false) then(
	jig npc(25)
	tb(5415)
)

#initial talk
if(check tag(332)==false,and,check tag(336)==false) then(
	jig npc(25)
	tb(5403)
	jig hero(0)
	tb(5404)
	wait(3)
	set npc direction(25,down)
	wait(3)
	alter npc(25,NPCstat:picture,301)
	if(hero direction(0)==right) then(set npc direction(25,left))
	jig npc(25)
	tb(5408)
	jig npc(25)
	tb(5409)

	#no
	if(check tag(333)) then(
		jig hero(0)
		tb(5410)
		jig npc(25)
		show text box(5414)
		wait(6)
		alter npc(25,NPCstat:picture,302)
		wait(3)
		set npc direction(25,right)
		wait for text box
		set tag(332,1)
	)
	#imagination?
	else(
		jig hero(0)
		tb(5416)
		jig npc(25)
		tb(5420)
		wait(3)
		jig hero(0)
		tb(5421)
		jig npc(25)
		tb(5425)
		tb(5426)
		jig hero(0)
		tb(5427)
		wait(5)
		set npc frame(25,1)
		wait(4)
		set npc frame(25,0)
		tb(5431)
		wait(10)
		jig npc(25)
		tb(5432)
		jig npc(25)
		tb(5433)
		wait(3)
		jadeup(4,1)
		wait(3)
		alter npc(25,NPCstat:displaytext,5434)
		alter npc(25,NPCstat:script,0)
		set tag(347,1)
	)
)

#meet dreamer in cyport
if(currentmap==45,or,currentmap==46,or,currentmap==48) then(
	#after initial talk in cyport
	if(check tag(335)) then(
		jig npc(18)
		tb(5439)
	)
	#initial talk in cyport
	else(
		stop song
		jig npc(18)
		tb(5435)
		play song(69)
		tb(5436)
		tb(6740)
		jig npc(18)
		tb(5437)
		tb(5438)
		get item(195,1)
		set tag(335,1)
		wait(3)
		jadeup(2,1)
		wait(3)
	)
)

resume obstruction
resume npcs
resume player
end
###

###############################
script, wanderingwiseman, begin
suspend player
suspend npcs
suspend obstruction

jig npc(26)
tb(5440)
jig npc(26)
tb(5441)

if(check tag(337)) then(
	jig hero(0)
	tb(5442)
	jig npc(26)
	tb(5446)
	tb(5447)
	jig npc(26)
	tb(5448)

	if(check tag(338)==false) then(
		jig npc(26)
		tb(5449)
		tb(5450)
	)

	if(check tag(338)==false) then(
		jig npc(26)
		tb(5451)
		tb(5452)
	)

	if(check tag(338)==false) then(
	jig npc(26)
	tb(5453)
	tb(5454)
	wait(10)
	jig npc(26)
	tb(5455)

	if(herox(0)==43,and,heroy(0)==43) then(
		walk npc(26,left,1)
		wait for npc(26)
	)
	if(herox(0)<>43,and,heroy(0)==43) then(
		walk npc(26,right,1)
		wait for npc(26)
	)

	walk npc(26,down,2)
	wait for npc(26)
	walk npc(26,right,9)
	wait(5)
	set hero direction(0,right)
	wait for npc(26)
	set tag(339,1)
	)

	if(check tag(338)) then(
		jig hero(0)
		tb(5456)
		jig npc(26)
		tb(5460)
		jig hero(0)
		tb(5461)
		jig npc(26)
		tb(5465)
		jig hero(0)
		tb(5466)
		jig npc(26)
		tb(5470)
		jig hero(0)
		tb(5471)
		jig npc(26)
		tb(5475)
		jig hero(0)
		tb(5476)
		jig npc(26)
		tb(5480)
		jig hero(0)
		tb(5481)
		jig npc(26)
		tb(5485)
		jig hero(0)
		tb(5486)
		jig npc(26)
		tb(5490)
		alter npc(26,NPCstat:movespeed,10)
		if(herox(0)==43,and,heroy(0)==43) then(
			walk npc(26,left,1)
			wait for npc(26)
		)
		if(herox(0)<>43,and,heroy(0)==43) then(
			walk npc(26,right,1)
			wait for npc(26)
		)
		walk npc(26,down,2)
		wait for npc(26)
		walk npc(26,right,9)
		wait(5)
		set hero direction(0,right)
		wait for npc(26)
		set tag(339,1)
		wait(3)
		jadeup(4,1)
		wait(3)
	)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, annoyingknave, begin
suspend player
suspend npcs
suspend obstruction
set hero frame(0,0)

#after initial
if(check tag(340),and,check tag(8)==false) then(
	#get rid of him
	if(check tag(341),and,check tag(342)) then(
		jig npc(27)
		tb(5498)
		jig hero(0)
		tb(5499)
		jig npc(27)
		tb(5502)
		jig hero(0)
		tb(5503)
		battleflash
		ff(115+poff)
		wait(3)
		jig npc(27)
		tb(5506)
		alter npc(27,NPCstat:movespeed,10)
		if(npcy(27)==heroy(0),and,npcx(27)<<herox(0)) then(
			walk npc(27,down,1)
			wait for npc(27)
		)
		walk npc(27,right,10)
		wait(3)
		set hero direction(0,right)
		wait for npc(27)
		wait(5)
		jadeup(3,1)
		wait(3)
		jig hero(0)
		tb(5507)
		set tag(343,1)
	)

	#text 2
	if(check tag(341),and,check tag(342)==false) then(
		jig npc(27)
		if(hero direction(0)==up) then(
			walk npc(27,up,1)
			set npc direction(27,down)
		)
		if(hero direction(0)==down) then(
			walk npc(27,down,1)
			set npc direction(27,up)
		)
		if(hero direction(0)==left) then(
			walk npc(27,left,1)
			set npc direction(27,right)
		)
		if(hero direction(0)==right) then(
			walk npc(27,right,1)
			set npc direction(27,left)
		)
		wait for npc(27)
		tb(5497)
		set tag(342,1)
	)

	#text 1
	if(check tag(341)==false,and,check tag(342)==false) then(
		jig npc(27)
		if(hero direction(0)==up) then(
			walk npc(27,up,1)
			set npc direction(27,down)
		)
		if(hero direction(0)==down) then(
			walk npc(27,down,1)
			set npc direction(27,up)
		)
		if(hero direction(0)==left) then(
			walk npc(27,left,1)
			set npc direction(27,right)
		)
		if(hero direction(0)==right) then(
			walk npc(27,right,1)
			set npc direction(27,left)
		)
		wait for npc(27)
		tb(5496)
		set tag(341,1)
	)
)

#after initial, coming from the east
if(check tag(340),and,check tag(8)) then(
	set hero frame(0,0)
	walk npc to y(27,heroy(0))
	wait for npc(27)
	set npc direction(27,right)
	jig npc(27)
	tb(5491)
)

#initial text
if(check tag(340)==false) then(
	set hero frame(0,0)
	walk npc to y(27,heroy(0))
	wait for npc(27)
	set npc direction(27,right)
	jig npc(27)
	tb(5491)
	jig hero(0)
	tb(5492)
	jig npc(27)
	tb(5495)
	set tag(340,1)
)

resume obstruction
resume npcs
resume player
end
###

#####################
script, oreget, begin
suspend player
suspend npcs
suspend obstruction

#quest complete
if(check tag(351)) then(
	jig npc(15)
	tb(5537)
)

#Talked to person in new keltan refiner
if(check tag(346),and,check tag(348),and,check tag(351)==false) then(

	#kill them all
	if(check tag(349),and,check tag(350)) then(
		jig npc(15)
		tb(5524)
		jig hero(0)
		stop song
		tb(5530)
		jig npc(15)
		tb(5534)
		jig npc(15)
		tb(5535)
		wait(3)
		set npc frame(15,1)
		wait(3)
		set hero frame(0,1)
		wait(3)
		set npc frame(15,0)
		wait(3)
		set hero frame(0,0)
		wait(3)
		tb(5536)
		get item(18,1)
		wait(3)
		jadeup(3,1)
		wait(3)
		jig npc(15)
		play song(69)
		tb(5537)
		set tag(351,1)
	)
	#have not killed them all
	if(check tag(349),and,check tag(350)==false) then(
		jig npc(15)
		tb(5524)
		jig hero(0)
		tb(5525)
		jig npc(15)
		tb(5529)
	)

	#initial (opens ladder)
	if(check tag(349)==false) then(
		jig npc(15)
		tb(5513)
		jig hero(0)
		tb(5514)
		jig npc(15)
		tb(5518)
		jig hero(0)
		tb(5519)
		jig npc(15)
		tb(5523)
		wait(3)
		palout(2)
		set tag(349,1)
		write map block(4,36,read map block(4,136))
		write map block(4,37,read map block(4,137))
		wait(6)
		palin(2)
		wait(4)
		jig npc(15)
		tb(7980)
		jig hero(0)
		tb(7981)
		wait(2)
		save game
	)
)

#have not talked to new keltan refiner
if(check tag(346),and,check tag(348)==false) then(
	jig npc(15)
	tb(5511)
	tb(5512)
)

#before act 3
if(check tag(346)==false) then(
	jig npc(15)
	tb(5510)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, balancedangle, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#initial
if(check tag(352)==false) then(
jig npc(3)
tb(6749)
set tag(352,1)
)

if(check tag(352)) then(
	#at gitleh
	if(heroy(0)>>100) then(
		jig npc(3)
		tb(6751)
		if(check tag(258)) then(
			palout(2)
			set hero position(0,142,34)
			set hero direction(0,up)
			set npc position(3,141,34)
			set npc direction(3,up)
			alter npc(3,NPCstat:palette,107)
			set pal(night)
			wait(10)
			reset palette
			tweak palette (-40,-40,-40)
			update palette
			wait (2)
			reset palette
			tweak palette (-20,-20,-20)
			update palette
			wait (2)
			reset palette
			tweak palette (-10,-10,-10)
			update palette
		)
	)
	#at mayor
	else(
		jig npc(3)
		tb(6750)
		if(check tag(258)) then(
			palout(2)
			set hero position(0,43,130)
			set hero direction(0,down)
			set npc position(3,42,130)
			set npc direction(3,down)
			alter npc(3,NPCstat:palette,105)
			set pal(noon)
			wait(10)
			palin(2)
		)
	)
)


resume obstruction
resume npcs
resume player
end
###

###########################
script, bunnywhistle, begin
suspend player
suspend npcs
suspend obstruction

#quest over
if(check tag(355)) then(
	jig npc(28)
	tb(5551)
)
#gain bunny whistle
if(check tag(355)==false,and,check tag(354)) then(
	jig npc(28)
	tb(5541)
	jig hero(0)
	tb(5542)
	jig npc(28)
	tb(5546)
	jig npc(28)
	tb(5547)
	wait(5)
	palout(5)
	stop song
	set maps
	variable(nx)
	variable(ny)
	variable(ndir)
	set variable(nx,npcx(28))
	set variable(ny,npcy(28))
	set variable(ndir,npc direction(28))
	variable(hx)
	variable(hy)
	variable(hmap)
	set variable(hx,herox(0))
	set variable(hy,heroy(0))
	set variable(hmap,noonmap)
	show backdrop(0)
	teleport to map(0,0,0)
	wait(1)
	palin(1)
	#set maps
	advance time of day (1)
	set hp
	wait(1)
	palout(1)
	teleport to map(hmap+poff,hx,hy)
	suspend player
	suspend npcs
	if(check tag(6)) then(
		alter npc(10,NPCstat:picture)
		alter npc(10,NPCstat:palette)
		alter npc(10,NPCstat:script,209)
		set npc position(10,nx,ny)
		set npc direction(10,ndir)
	)
	else(
		set npc direction(28,ndir)
		set npc position(28,nx,ny)
	)
	show map
	wait(5)
	palin(5)
	jig npc(28)
	play song(84)
	tb(5548)
	wait(3)
	tb(5549)
	get item(17,1)
	jig npc(28)
	tb(5550)
	set tag(355,1)
)

#found mister hoppity
if(check tag(355)==false,and,check tag(354)==false,and,check tag(353)) then(

	#bunny
	if(currentmap==16) then(
		suspend npc walls
		walk npc(28,left,3)
		wait(3)
		set hero direction(0,left)
		wait for npc(28)
		resume npc walls
		set tag(354,1)
	)
	#girl
	else(
		jig npc(28)
		tb(5540)
	)
)

#initial
if(check tag(353)==false) then(
	jig npc(28)
	tb(5538)
	jig npc(28)
	tb(5539)
	set tag(353,1)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, yakkityyak, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

jig npc(16)
tb(5552)
tb(5553)
jig npc(16)
tb(5554)
wait(3)

#listen to him
if(check tag(258)) then(
	jig hero(0)
	tb(5555)
	jig npc(16)
	tb(5559)

	wait(3)
	palout(2)
	wait(7)
	variable(nx)
	variable(ny)
	variable(ndir)
	set variable(nx,npcx(16))
	set variable(ny,npcy(16))
	set variable(ndir,npc direction(16))
	variable(hx)
	variable(hy)
	variable(hmap)
	set maps
	set variable(hx,herox(0))
	set variable(hy,heroy(0))
	set variable(hmap,noonmap)
	teleport to map(0,0,0)
	wait(1)
	palin(1)
	advance time of day (2)
	set hp
	wait(1)
	palout(1)
	teleport to map(hmap+poff,hx,hy)
	set npc position(16,nx,ny)
	set npc direction(16,ndir)
	wait(7)
	palin(2)
	wait(3)
	jig npc(16)
	tb(5560)
	jig hero(0)
	tb(5561)
	jig npc(16)
	tb(5565)
)

#don't listen to him
else(
	jig npc(16)
	tb(6752)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, fortuneteller, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

jig npc(17)
tb(5566)
jig npc(17)
tb(5567)

#pay
if(check tag(258)) then(
	if(pay money(1)) then(
		tb(5568)
		jig npc(17)
		tb(5569)
		wait(3)
		stop song
		palout(2)
		wait(5)
		show backdrop(0)
		wait(1)
		palin(1)

		variable(rand)
		set variable(rand,random(1,9))

if(rand==1) then(
tb(5570)
wait(3)
tb(5622)
)
if(rand==2) then(
tb(5571)
wait(3)
tb(6753)
)
if(rand==3) then(
tb(5572)
wait(3)
tb(5573)
wait(3)
tb(6754)
)
if(rand==4) then(
tb(5574)
wait(3)
tb(5575)
)
if(rand==5) then(
tb(5576)
wait(3)
tb(6755)
)
if(rand==6) then(
tb(5577)
wait(3)
tb(6756)
)
if(rand==7) then(
tb(5578)
wait(3)
tb(5579)
)
if(rand==8) then(
tb(5580)
wait(3)
tb(6757)
)
if(rand==9) then(
tb(5581)
wait(3)
tb(6758)
)

		palout(1)
		show map
		wait(5)
		palin(2)
		if(check tag(3)) then(play song(29))
		if(check tag(4)) then(play song(29))
		if(check tag(5)) then(play song(29))
		if(check tag(6)) then(play song(73))
		wait(5)
		jig hero(0)
		tb(5582)
		jig npc(17)
		tb(5586)
		alter npc(17,NPCstat:script,0)
		alter npc(17,NPCstat:displaytext,5586)
	)
	#not enough money
	else(
		jig npc(17)
		tb(6760)
	)
)
#say no
else(
	jig npc(17)
	tb(6759)
)


resume obstruction
resume npcs
resume player
end
###

########################
script, cabinload, begin
#####race flashback
if (check tag(102)==false) then(
alter npc(5,NPCstat:palette,166)
alter npc(5,NPCstat:displaytext,6765)
set npc position(5,3,19)
)

#####manx flashback
if (check tag(126)==false,and,check tag(102)) then(
alter npc(5,NPCstat:palette,167)
alter npc(5,NPCstat:displaytext,6779)
alter npc(5,NPCstat:when activated,NPCwhenactivated:face player)
set npc direction(5,up)
set npc position(5,4,18)
)

#####fourth flashback
if (check tag(137)==false,and,check tag(126),and,check tag(102)) then(
alter npc(5,NPCstat:displaytext,6787)
set npc position(5,4,19)
)

#####fifth flashback
if (check tag(186)==false,and,check tag(137),and,check tag(126),and,check tag(102)) then(

)

#####fifth flashback --part two--
if (check tag(187)==false,and,check tag(186),and,check tag(137),and,check tag(126),and,check tag(102)) then(
alter npc(5,NPCstat:palette,167)
alter npc(5,NPCstat:displaytext,6794)
set npc position(5,2,18)
)

#####---FINAL FLASH--- flashback
if (check tag(187),and,check tag(186),and,check tag(137),and,check tag(126),and,check tag(102)) then(
alter npc(5,NPCstat:palette,168)
alter npc(5,NPCstat:displaytext,6799)
set npc position(5,3,20)
set npc direction(5,up)
)
end
###

########################
script, keltaninn, begin
suspend player
suspend npcs
suspend obstruction

#check for johan solo bit
if(check tag(388)) then(
jig npc(9)
tb(6921)
)
else(

set tag(258,0)
jig npc(9)
tb(6803)

#choose to stay
if(check tag(258)) then(
	if(pay money(3)) then(
		palout(2)

		innfancy

		set hp
		wait(1)
		teleport to map(32+poff,7,22)
		suspend npcs
		innrest
		set party out
		swap by position(0,findhero(0))
		heroclothes
		pan camera(south,0,0)
		wait(1)
		set npc position(9,0,0)
		set hero position(0,4,20)
		if(check tag(85)) then(set npc position(1,6,20))
		if(check tag(86)) then(set npc position(2,8,20))
		if(check tag(87)) then(set npc position(3,10,20))
		alter npc(1,NPCstat:movespeed,2)
		alter npc(2,NPCstat:movespeed,2)
		alter npc(3,NPCstat:movespeed,2)
		set hero speed(0,2)
		wait(10)
		palin(2)
		walk hero(0,left,1)
		walk npc(1,left,1)
		walk npc(2,right,1)
		walk npc(3,right,1)
		wait for hero(0)
		wait for npc(3)
		walk hero(0,down,2)
		walk npc(1,down,2)
		walk npc(2,down,2)
		walk npc(3,down,2)
		wait for hero(0)
		wait for npc(3)
		walk hero to x(0,7)
		walk npc to x(1,7)
		walk npc to x(2,7)
		walk npc to x(3,7)
		wait for hero(0)
		set hero direction(0,down)
		set npc position(1,0,0)
		set npc position(2,0,0)
		set npc position(3,0,0)
		set party in
		set hero speed(0,hspeed)
		camera follows hero(0)
		save game
	)
	#do not pay
	else(
		jig npc(9)
		tb(6879)
	)
)
#chose not to pay
else(
	jig npc(9)
	tb(6806)
)

)
resume obstruction
resume npcs
resume player
end
###

#########################
script, keltanicon, begin
suspend player
suspend npcs
suspend obstruction

#check if waiting
if( keltaniconsave <> 0 ) then(
	#get icon
	if(iconwaitcheck(keltaniconsave,keltaniconhour,keltaniconday)) then(
		jig npc(10)
		tb(6849)
		tb(6839 + (keltaniconsave -- 132 -- 8) )
		get item(keltaniconsave)
		set variable(keltaniconsave,0)
		set variable(keltaniconhour,0)
		set variable(keltaniconday,0)
	)
	#still waiting
	else(
		jig npc(10)
		tb(6850)
	)
)

#main
set tag(258,0)
jig npc(10)
tb(6847)
if(check tag(258)) then( iconcraft(53,132,6807,9,6,3) )
else(
jig npc(10)
tb(6848)
)

set npc direction(10,right)

resume obstruction
resume npcs
resume player
end
###

#########################
script, keltanitem, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(12)
tb(6851)

#check if want to buy
if(check tag(258)) then(

alter npc(12,NPCstat:script,0)
wait(3)
set tag(258,0)
tb(6596)
if(check tag(258)) then(
	use shop(3)
)
else( itemkeltan )
wait(1)
alter npc(12,NPCstat:script,215)

)#end check to buy

#don't want to buy
else(
jig npc(12)
tb(6852)
)

set npc direction(12,up)

resume obstruction
resume npcs
resume player
end
###

############################
script, keltantrainer, begin
suspend player
suspend npcs
suspend obstruction

#check for johan solo part:
if(check tag(388)) then(
	jig npc(20)
	tb(6854)
)
else(
set tag(258,0)
jig npc(20)
tb(6853)

if(check tag(258)) then(
	#npc, firstscreen,firsttextbox,$cost,phasecost,
	#strup,accup,defup,ddgup,sklup,evdup,
	#strcap,acccap,defcap,ddgcap,sklcap,evdcap
	stattrain(20,89,6855,5,3,8,12,4,12,8,8,69,64,36,59,74,36)
)
else(
	wait(3)
	jig npc(20)
	tb(6854)
)
)
resume obstruction
resume npcs
resume player
end
###

###########################
script, keltantrader, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(10)
tb(6638)
if(check tag(258)) then( trader(7388,10) )
else(
wait(2)
jig npc(10)
tb(6865)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, keltanavis, begin
suspend player
suspend npcs
suspend obstruction

#already have avis
if(check tag(264)) then(tb(6870))

#get avis
else(
	set tag(258,0)
	jig npc(7)
	tb(6866)
	wait(2)
	if(check tag(258)) then(
		if(pay money(30)) then(
			set tag(264,1)
			tb(6868)
			wait(2)
			if(check tag(261)==false) then(
				jig gahn
				tb(6616)
				set tag(261,1)
				get item(72,1)
			)
		)
		#not enough money
		else(tb(6869))
	)
	#chose not to buy
	else(tb(6867))
)

resume obstruction
resume npcs
resume player
end
###

############################
script, missingperson, begin
suspend player
suspend npcs
suspend obstruction

#check-check behind the scene
#if on 1st bit, check to see if phase has past, otherwise remain in 1st bit
if(check tag(359)==false,and,check tag(358)) then(
	#morning
	if(missinghour >> 300,and,missinghour << 900) then(
		if(check tag(4),or,check tag(5),or,check tag(6),or,day >> missingday) then()
		else(set tag(358,0))
	)
	#noon
	if(missinghour >> 900,and,missinghour << 1500) then(
		if(check tag(3),or,check tag(5),or,check tag(6),or,day >> missingday) then()
		else(set tag(358,0))
	)
	#afternoon
	if(missinghour >> 1500,and,missinghour << 2100) then(
		if(check tag(3),or,check tag(4),or,check tag(6),or,day >> missingday) then()
		else(set tag(358,0))
	)
	#night
	if(missinghour >> 2100,or,missinghour << 300) then(
		if(check tag(3),or,check tag(4),or,check tag(5),or,day >> missingday) then()
		else(set tag(358,0))
	)
)
#if on 2nd bit, check to see if phase has past, otherwise remain in 2nd bit
if(check tag(360)==false,and,check tag(359)) then(
	#morning
	if(missinghour >> 300,and,missinghour << 900) then(
		if(check tag(4),or,check tag(5),or,check tag(6),or,day >> missingday) then()
		else(set tag(359,0))
	)
	#noon
	if(missinghour >> 900,and,missinghour << 1500) then(
		if(check tag(3),or,check tag(5),or,check tag(6),or,day >> missingday) then()
		else(set tag(359,0))
	)
	#afternoon
	if(missinghour >> 1500,and,missinghour << 2100) then(
		if(check tag(3),or,check tag(4),or,check tag(6),or,day >> missingday) then()
		else(set tag(359,0))
	)
	#night
	if(missinghour >> 2100,or,missinghour << 300) then(
		if(check tag(3),or,check tag(4),or,check tag(5),or,day >> missingday) then()
		else(set tag(359,0))
	)
)

#quest complete
if(check tag(360)) then(
jig npc(13)
tb(5608)
)

#final bit
if(check tag(360)==false,and,check tag(359)) then(
jig npc(13)
tb(5599)
jig hero(0)
tb(5600)
jig npc(13)
tb(5604)
jig npc(13)
tb(5605)
tb(5606)
wait(3)
jadeup(4,1)
wait(3)
jig npc(13)
tb(5607)
set tag(360,1)
)

#2nd bit
if(check tag(359)==false,and,check tag(358)) then(
jig npc(13)
tb(5594)
jig hero(0)
tb(5595)
set tag(359,1)
set variable(missinghour,hour)
set variable(missingday,day)
)

#1st bit
if(check tag(358)==false,and,check tag(357)) then(
jig npc(13)
tb(5589)
jig hero(0)
tb(5590)
set tag(358,1)
set variable(missinghour,hour)
set variable(missingday,day)
)

#initial
if(check tag(357)==false) then(
jig npc(13)
tb(5587)
tb(5588)
set tag(357,1)
)

resume obstruction
resume npcs
resume player
end
###

#############################
script, aspiringsinger, begin
suspend player
suspend npcs
suspend obstruction

#check for johan only part
if(check tag(388)) then(
jig npc(9)
tb(5627)
)
else(

#quest complete
if(check tag(361)) then(
	jig npc(9)
	tb(5639)
)

#startup bit
else(
	set tag(258,0)
	jig npc(9)
	tb(5609)

	#let us hear her sing
	if(check tag(258)) then(
		set tag(258,0)
		jig hero(0)
		stop song
		tb(5615)
		jig npc(9)
		tb(5619)
		wait(3)
		play song(21)
		alter npc(9,NPCstat:picture,309)
		set npc direction(9,down)
		variable(i)
		for(i,1,25,1) do(
			set npc frame(9,0)
			wait(5)
			set npc frame(9,1)
			wait(2)
			set npc frame(9,0)
			wait(3)
			set npc frame(9,1)
			wait(1)
		)
		set npc frame(9,0)
		alter npc(9,NPCstat:picture,308)
		stop song
		wait(3)
		if(hero direction(0)==down) then(set npc direction(9,up))
		if(hero direction(0)==up) then(set npc direction(9,down))
		if(hero direction(0)==right) then(set npc direction(9,left))
		if(hero direction(0)==left) then(set npc direction(9,right))
		jig npc(9)
		tb(5620)

		#her singing was ......lie lie lie
		if(check tag(258)) then(
			jig hero(0)
			tb(5621)
			if(check tag(3)) then(play song(71))
			if(check tag(4)) then(play song(71))
			if(check tag(5)) then(play song(71))
			if(check tag(6)) then(play song(73))
			jig npc(9)
			tb(5626)
		)
		#her singing was OHR-GAME-QUALITY-BAD!
		else(
			jig hero(0)
			play song(8)
			tb(5628)
			jig npc(9)
			tb(5632)
			wait(15)
			jig npc(9)
			play song(69)
			tb(5633)
			jig hero(0)
			tb(5634)
			jig npc(9)
			tb(5638)
			set tag(361,1)
			wait(3)
			jadeup(4,1)
			wait(3)
		)
	)
	#let us not hear her sing
	else(
		jig hero(0)
		tb(5610)
		jig npc(9)
		tb(5614)
	)
)
)
resume obstruction
resume npcs
resume player
end
###

############################
script, iconcollector, begin
suspend player
suspend npcs
suspend obstruction

#johan only part
if(check tag(388)) then(
jig npc(14)
tb(5641)
)
else(

set tag(258,0)
set tag(372,0)

#quest complete
if(check tag(370)) then(
	jig npc(14)
	tb(5659)
)

#after initial
if(check tag(371),and,check tag(370)==false) then(
	jig npc(14)
	tb(5644)
	iconcollector2
)

#initial
if(check tag(371)==false) then(
	set tag(371,1)
	jig npc(14)
	tb(5640)
	tb(5641)
	jig npc(14)
	tb(5642)
	iconcollector2
)

)
resume obstruction
resume npcs
resume player
end
###
#############################
script, iconcollector2, begin
	#yes
	if(check tag(258)) then(
		jig npc(14)
		tb(5645)
		wait(3)
		jig npc(14)
		if(check tag(362),and,check tag(366)==false,and,check tag(372)==false) then(
			set tag(372,1)
			set tag(258,0)
			tb(5647)
			if(check tag(258)) then(
				set tag(366,1)
				jig npc(14)
				tb(5651)
				wait(3)
				tb(5652)
				delete item(228,1)
				get money(30)
			)
			else(
				jig npc(14)
				tb(5656)
			)
		)
		if(check tag(372)==false) then(
			wait(3)
			jig npc(14)
		)
		if(check tag(363),and,check tag(367)==false,and,check tag(372)==false) then(
			set tag(372,1)
			set tag(258,0)
			tb(5648)
			if(check tag(258)) then(
				set tag(367,1)
				jig npc(14)
				tb(5651)
				wait(3)
				tb(5653)
				delete item(229,1)
				get money(30)
			)
			else(
				jig npc(14)
				tb(5656)
			)
		)
		if(check tag(372)==false) then(
			wait(3)
			jig npc(14)
		)
		if(check tag(364),and,check tag(368)==false,and,check tag(372)==false) then(
			set tag(372,1)
			set tag(258,0)
			tb(5649)
			if(check tag(258)) then(
				set tag(368,1)
				jig npc(14)
				tb(5651)
				wait(3)
				tb(5654)
				delete item(230,1)
				get money(30)
			)
			else(
				jig npc(14)
				tb(5656)
			)
		)
		if(check tag(372)==false) then(
			wait(3)
			jig npc(14)
		)
		if(check tag(365),and,check tag(369)==false,and,check tag(372)==false) then(
			set tag(372,1)
			set tag(258,0)
			tb(5650)
			if(check tag(258)) then(
				set tag(369,1)
				jig npc(14)
				tb(5651)
				wait(3)
				tb(5655)
				delete item(231,1)
				get money(50)
			)
			else(
				jig npc(14)
				tb(5656)
			)
		)
		if(check tag(372)==false) then(
			jig npc(14)
			tb(5646)
		)
		if(check tag(366),and,check tag(367),and,check tag(368),and,check tag(369)) then(
			jig npc(14)
			tb(5657)
			wait(3)
			jadeup(5,1)
			wait(3)
			jig npc(14)
			tb(5658)
			set tag(370,1)
		)
	)
	#no
	else(
		jig npc(14)
		tb(5643)
	)
end
###

###########################
script, jadeneurosis, begin
suspend player
suspend npcs
suspend obstruction

#pre final bit
if(check tag(373),and,check tag(374),and,check tag(375)==false,and,(herox(0)==5,and,heroy(0)==96)) then(
tb(5661)
wait(2)
set hero direction(0,right)
wait(2)
walk hero(0,up,3)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,left)
jig hero(0)
wait(15)
set npc direction(15,right)
wait(2)
tb(5662)
walk npc(15,right,1)
wait for npc(15)
set npc frame(15,0)
wait(5)
tb(5666)
wait(10)
jig npc(15)
tb(5667)
wait(3)
set npc direction(15,down)
wait(10)
tb(5668)
wait(10)
tb(5669)
wait(10)
jig npc(15)
tb(5670)
wait(5)
tb(5671)
jig npc(15)
tb(5672)
wait(15)
set npc direction(15,right)
jig npc(15)
tb(5673)

palout(2)
set tag(375,1)
set hero position(0,8,75)
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
set npc position(16,0,0)
alter npc(16,NPCstat:movetype,npcmovetype:standstill)
alter npc(16,NPCstat:movespeed,2)
wait(1)
palin(2)
play song(69)
wait(10)
set npc position(16,8,72)
walk npc(16,down,3)
set npc direction(16,up)
wait for npc(16)
walk npc(16,left,1)
wait for npc(16)
set npc frame(16,0)
set npc direction(16,down)
wait(2)
set npc direction(16,right)
set hero position(0,8,72)
walk hero(0,down,3)
set hero direction(0,up)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,left)
wait(2)
set hero direction(0,down)
wait(3)
jadeup(6,2)
wait(3)
camera follows hero(0)
)


#pre saving him text
if(check tag(375)==false) then(
stop song
tb(5660)
	#talk to him after saving him
	if(check tag(373),and,check tag(374)==false) then(
		set tag(374,1)
	)
)

resume obstruction
resume npcs
resume player
end
###

#############################
script, haystackneedle, begin
suspend player
suspend npcs
suspend obstruction

#quest complete
if(check tag(378)) then(
jig npc(11)
tb(5693)
)

#after init
if(check tag(376),and,check tag(378)==false) then(
jig npc(11)
tb(5682)
set npc direction(11,left)
#some item or thing is using tag 377, it automatically turns off when
#one gets the item, so removing the check for it
#should work just fine without
if(check tag(631)) then(
jig hero(0)
tb(5683)
set npc direction(11,down)
jig npc(11)
tb(5687)
wait(2)
if(check equipment(find hero(0),2)==220) then(unequip(find hero(0),2))
if(check equipment(find hero(1),2)==220) then(unequip(find hero(1),2))
if(check equipment(find hero(2),2)==220) then(unequip(find hero(2),2))
if(check equipment(find hero(3),2)==220) then(unequip(find hero(3),2))
delete item(220,1)
tb(5694)
wait(2)
tb(5688)
jig npc(11)
tb(5689)
set npc direction(11,left)
tb(5690)
wait(10)
set npc direction(11,down)
jig npc(11)
tb(5691)
wait(3)
get item(221,1)
tb(5692)
wait(3)
jadeup(4,1)
wait(3)
set tag(378,1)
)
)

#init
if(check tag(376)==false) then(
jig npc(11)
tb(5675)
jig hero(0)
tb(5676)
jig npc(11)
tb(5680)
tb(5681)
set npc direction(11,left)
set tag(376,1)
if(check tag(377)) then(
jig hero(0)
tb(5683)
set npc direction(11,down)
jig npc(11)
tb(5687)
tb(5688)
jig npc(11)
tb(5689)
set npc direction(11,left)
tb(5690)
wait(10)
set npc direction(11,down)
jig npc(11)
tb(5691)
wait(3)
tb(5692)
get item(221,1)
if(check equipment(find hero(0),2)==220) then(unequip(find hero(0),2))
if(check equipment(find hero(1),2)==220) then(unequip(find hero(1),2))
if(check equipment(find hero(2),2)==220) then(unequip(find hero(2),2))
if(check equipment(find hero(3),2)==220) then(unequip(find hero(3),2))
delete item(220,1)
wait(3)
jadeup(4,1)
wait(3)
)
)

set npc direction(11,left)

resume obstruction
resume npcs
resume player
end
###

########################
script, refineore, begin
suspend player
suspend npcs
suspend obstruction

set tag(348,1)

#finished quessssst
if(check tag(379)) then(
jig npc(12)
tb(5704)
)

#get refined ore
if(check tag(382),and,check tag(379)==false) then(
stop song
jig npc(12)
tb(5701)
wait(3)
play song(69)
tb(5702)
get item(19,1)
wait(3)
jadeup(2,1)
wait(3)
set tag(379,1)
jig npc(12)
tb(5703)
)

#finished act 3, no ore
if(check tag(382)==false,and,check tag(380)==false,and,check tag(346)) then(
jig npc(12)
tb(6875)
)

#finished act 3, ore!
if(check tag(382)==false,and,check tag(380),and,check tag(346)) then(
jig npc(12)
tb(5696)
tb(5697)
tb(6876)
set tag(258,0)
jig npc(12)
tb(5698)
if(check tag(258)) then(
if(paymoney(50)) then(
stop song
jig npc(12)
tb(5700)
delete item(18,1)
wait(3)
palout(1)
set tag(382,1)
set tag(383,1)
set variable(orehour,hour)
set variable(oreday,day)
#destroy npc(12)
wait(1)
palin(1)
if(check tag(3)) then(play song(71))
if(check tag(4)) then(play song(71))
if(check tag(5)) then(play song(71))
if(check tag(6)) then(play song(73))
)
else(
jig npc(12)
tb(6877)
)
)
else(
jig npc(12)
tb(5699)
)
)

#have yet to finish act 3
if(check tag(346)==false) then(
jig npc(12)
tb(5695)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, keltanload, begin

#checking for ze ore refiner
if(check tag(383)) then(
	#morning
	if(orehour >= 300,and,orehour << 900) then(
		if(day >> oreday) then(set tag(383,0))
	)
	#noon
	if(orehour >= 900,and,orehour << 1500) then(
		if(day >> oreday) then(set tag(383,0))
	)
	#afternoon
	if(orehour >= 1500,and,orehour << 2100) then(
		if(day >> oreday) then(set tag(383,0))
	)
	#night
	if(orehour >= 2100,or,orehour << 300) then(
		if(day >> (oreday+1) ) then(set tag(383,0))
	)
#above is not working, using this
if(day >> oreday) then(set tag(383,0))
)

#checking for after raider battle
#magically return things back to normal
if(check tag(130)) then(
	set tag(385,0)
)

#if raider battle, play the raider attack song
if(check tag(385)) then(play song(5))

end
###

########################
script, dun3locks, begin
suspend player
suspend npcs
suspend obstruction

variable(i)
variable(d1)
variable(d2)
variable(d3)
variable(d4)
variable(xxx)

#door uno
if(herox(0)==27,and,heroy(0)==89) then(
set hero direction(0,up)
	if (check tag(398)==false) then(
		jig hero(0)
		tb(6903)
	)

	if (check tag(398)) then(
		tb(6911)
		suspend npc walls

		set variable (xxx,hero pixel X (0))
		set variable (d1,NPC at spot (herox(0),heroy(0)))
		set variable (d2,NPC at spot (herox(0),heroy(0)--1))
		set variable (d3,NPC at spot (herox(0),heroy(0)--2))
		set variable (d4,NPC at spot (herox(0),heroy(0)--3))
		write pass block(herox(0)--1,heroy(0)--1,128)

		for (i,1,20,1) do(
			put npc (d1,xxx--i,hero pixel y(0))
			put npc (d2,xxx--i,hero pixel y(0)--20)
			put npc (d3,xxx--i,hero pixel y(0)--40)
			put npc (d4,xxx--i,hero pixel y(0)--60)
			wait (1)
		)

		set npc position (d1,0,2)
		set npc position (d2,0,2)
		set npc position (d3,0,2)
		set npc position (d4,0,2)
		write pass block(herox(0)--1,heroy(0)--1,1+2+4+8)
		resume npc walls
		set tag(395,1)
		write pass block(herox(0),heroy(0),0)
	)
)

#door duo
if(herox(0)==27,and,heroy(0)==64) then(
set hero direction(0,up)
	if (check tag(399)==false) then(
		jig hero(0)
		tb(6903)
	)

	if (check tag(399)) then(
		tb(6912)
		suspend npc walls

		set variable (xxx,hero pixel X (0))
		set variable (d1,NPC at spot (herox(0),heroy(0)))
		set variable (d2,NPC at spot (herox(0),heroy(0)--1))
		set variable (d3,NPC at spot (herox(0),heroy(0)--2))
		set variable (d4,NPC at spot (herox(0),heroy(0)--3))
		write pass block(herox(0)--1,heroy(0)--1,128)

		for (i,1,20,1) do(
			put npc (d1,xxx--i,hero pixel y(0))
			put npc (d2,xxx--i,hero pixel y(0)--20)
			put npc (d3,xxx--i,hero pixel y(0)--40)
			put npc (d4,xxx--i,hero pixel y(0)--60)
			wait (1)
		)

		set npc position (d1,0,2)
		set npc position (d2,0,2)
		set npc position (d3,0,2)
		set npc position (d4,0,2)
		write pass block(herox(0)--1,heroy(0)--1,1+2+4+8)
		resume npc walls
		set tag(396,1)
		write pass block(herox(0),heroy(0),0)
		create npc(35,27,61)
	)
)

#door tres
if(herox(0)==27,and,heroy(0)==41) then(
set hero direction(0,up)
	if (check tag(400)==false) then(
		jig hero(0)
		tb(6907)
	)

	if (check tag(400)) then(
		tb(6913)
		suspend npc walls

		set variable (xxx,hero pixel X (0))
		set variable (d1,NPC at spot (herox(0),heroy(0)))
		set variable (d2,NPC at spot (herox(0),heroy(0)--1))
		set variable (d3,NPC at spot (herox(0),heroy(0)--2))
		set variable (d4,NPC at spot (herox(0),heroy(0)--3))
		write pass block(herox(0)--1,heroy(0)--1,128)

		for (i,1,20,1) do(
			put npc (d1,xxx--i,hero pixel y(0))
			put npc (d2,xxx--i,hero pixel y(0)--20)
			put npc (d3,xxx--i,hero pixel y(0)--40)
			put npc (d4,xxx--i,hero pixel y(0)--60)
			wait (1)
		)

		set npc position (d1,0,2)
		set npc position (d2,0,2)
		set npc position (d3,0,2)
		set npc position (d4,0,2)
		write pass block(herox(0)--1,heroy(0)--1,1+2+4+8)
		resume npc walls
		set tag(397,1)
		write pass block(herox(0),heroy(0),0)
	)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, dun3chests, begin
suspend player
suspend npcs
suspend obstruction

#arch sword
if((herox(0)==9,and,heroy(0)==127),or,(herox(0)==8,and,heroy(0)==128),or,(herox(0)==9,and,heroy(0)==129),or,(herox(0)==10,and,heroy(0)==128)) then(
	set npc position(npc at spot(9,128),0,0)
	stop song
	tb(6891)
	archsword
	play song(63)
	set tag(398,1)
)

#fyr sword
if((herox(0)==79,and,heroy(0)==100),or,(herox(0)==78,and,heroy(0)==101),or,(herox(0)==79,and,heroy(0)==102),or,(herox(0)==80,and,heroy(0)==101)) then(
	set npc position(npc at spot(79,101),0,0)
	stop song
	tb(6892)
	fyrblade
	play song(63)
	set tag(399,1)
)

#vice gauntlet
if((herox(0)==101,and,heroy(0)==53),or,(herox(0)==102,and,heroy(0)==54),or,(herox(0)==100,and,heroy(0)==54),or,(herox(0)==101,and,heroy(0)==55,and,hero direction(0)==up)) then(
	set npc position(npc at spot(101,54),0,0)
	tb(6893)
	stop song
	vicehand
	play song(63)
	set tag(400,1)
)

#chest 4 / EMPTY
if((herox(0)==97,and,heroy(0)==54),or,(herox(0)==98,and,heroy(0)==53),or,(herox(0)==99,and,heroy(0)==54),or,(herox(0)==98,and,heroy(0)==55,and,hero direction(0)==up)) then(
	set npc position(npc at spot(98,54),0,0)
	stop song
	tb(7339)
	play song(63)
	set tag(401,1)
)
#chest 5 / JINX
if((herox(0)==97,and,heroy(0)==56),or,(herox(0)==98,and,heroy(0)==57),or,(herox(0)==99,and,heroy(0)==56),or,(herox(0)==98,and,heroy(0)==55,and,hero direction(0)==down)) then(
	set npc position(npc at spot(98,56),0,0)
	stop song
	battleflash
	ff(257)
	fedoratombload
	play song(63)
	set tag(402,1)
)

#chest 6 / 4 HP+++
if((herox(0)==100,and,heroy(0)==56),or,(herox(0)==101,and,heroy(0)==57),or,(herox(0)==102,and,heroy(0)==56),or,(herox(0)==101,and,heroy(0)==55,and,hero direction(0)==down)) then(
	set npc position(npc at spot(101,56),0,0)
	get item(52,5)
	stop song
	tb(7340)
	play song(63)
	set tag(403,1)
)

#thing-a-ma-bog
if((herox(0)==81,and,heroy(0)==66),or,(herox(0)==82,and,heroy(0)==65),or,(herox(0)==83,and,heroy(0)==66),or,(herox(0)==82,and,heroy(0)==67)) then(
variable(i)
variable(cx)
variable(cy)
set variable(cx,camera pixel x)
set variable(cy,camera pixel y)
for(i,1,5,1) do(
put camera(cx+random(-1,1),cy+random(-1,1))
wait(1)
)
	#red up, black down
	if(check tag(404)) then(
		#red up
		set npc direction(npc at spot(81,56),up)
		set npc direction(npc at spot(81,57),right)
		set npc direction(npc at spot(87,65),up)
		set npc direction(npc at spot(87,66),right)
		set npc direction(npc at spot(93,89),up)
		set npc direction(npc at spot(93,90),right)
		set npc direction(npc at spot(93,101),up)
		set npc direction(npc at spot(93,102),right)
		write pass block(81,56,1+2+4+8)
		write pass block(81,57,1+2+4+8)
		write pass block(87,66,1+2+4+8)
		write pass block(93,90,1+2+4+8)
		write pass block(93,102,1+2+4+8)
		#black down
		set npc direction(npc at spot(75,53),left)
		set npc direction(npc at spot(75,54),up)
		set npc direction(npc at spot(87,53),left)
		set npc direction(npc at spot(87,54),up)
		set npc direction(npc at spot(61,80),left)
		set npc direction(npc at spot(61,81),up)
		set npc direction(npc at spot(99,80),left)
		set npc direction(npc at spot(99,81),up)
		write pass block(75,54,0)
		write pass block(87,54,0)
		write pass block(61,81,0)
		write pass block(99,80,0)
		write pass block(99,81,0)
		set npc frame(npc at spot(82,66),1)
		set tag(404,0)
	)
	#red down, black up
	else(
		#red down
		set npc direction(npc at spot(81,56),left)
		set npc direction(npc at spot(81,57),up)
		set npc direction(npc at spot(87,65),left)
		set npc direction(npc at spot(87,66),up)
		set npc direction(npc at spot(93,89),left)
		set npc direction(npc at spot(93,90),up)
		set npc direction(npc at spot(93,101),left)
		set npc direction(npc at spot(93,102),up)
		write pass block(81,56,0)
		write pass block(81,57,0)
		write pass block(87,66,0)
		write pass block(93,90,0)
		write pass block(93,102,0)
		#black up
		set npc direction(npc at spot(75,53),up)
		set npc direction(npc at spot(75,54),right)
		set npc direction(npc at spot(87,53),up)
		set npc direction(npc at spot(87,54),right)
		set npc direction(npc at spot(61,80),up)
		set npc direction(npc at spot(61,81),right)
		set npc direction(npc at spot(99,80),up)
		set npc direction(npc at spot(99,81),right)
		write pass block(75,54,1+2+4+8)
		write pass block(87,54,1+2+4+8)
		write pass block(61,81,1+2+4+8)
		write pass block(99,80,1+2+4+8)
		write pass block(99,81,1+2+4+8)
		set npc frame(npc at spot(82,66),0)
		set tag(404,1)
	)
for(i,1,5,1) do(
put camera(cx+random(-1,1),cy+random(-1,1))
wait(1)
)
put camera(cx,cy)
)

set hero speed(0,hspeed)

resume obstruction
resume npcs
resume player
end
###

########################
script, archsword, begin
if(herox(0)==9,and,heroy(0)==129) then(
	walk hero(0,left,1)
	wait for hero(0)
)
walk hero to y(0,126)
wait for hero(0)
walk hero to x(0,9)
wait for hero(0)
set party out
wait(1)
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
set hero speed(0,4)
walk hero(0,left,1)
walk npc(2,up,1)
walk npc(1,right,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(3)
set npc frame(1,0)
set npc frame(2,0)
set npc frame(3,0)
wait(1)
set hero direction(0,down)
set npc direction(2,left)
set npc direction(1,up)
set npc direction(3,right)
wait(2)
set hero direction(0,right)
set npc direction(2,down)
set npc direction(1,left)
set npc direction(3,up)
wait(5)
jig hero(0)
tb(6894)
jig npc(1)
show text box(6895)
wait(2)
set hero picture(0,332)
wait for text box
wait(20)
tb(6896)
set hero picture(0,229)
walk hero(0,right,1)
walk npc(2,down,1)
walk npc(1,left,1)
walk npc(3,up,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(2)
set npc position(2,2,3)
wait for npc(1)
set npc position(1,1,3)
wait for npc(3)
set npc position(3,3,3)
set hero direction(0,up)
set party in
set default weapon(find hero(0),32)
set hero picture(find hero(0),7,inside battle)
get item(31,1)
end
###

#######################
script, fyrblade, begin
if(herox(0)==79,and,heroy(0)==100) then(
	walk hero(0,left,1)
	wait for hero(0)
)
walk hero to y(0,102)
wait for hero(0)
walk hero to x(0,80)
wait for hero(0)
set party out
wait(1)
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
set hero speed(0,4)
walk hero(0,left,1)
walk npc(2,up,1)
walk npc(1,right,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(3)
set npc frame(1,0)
set npc frame(2,0)
set npc frame(3,0)
wait(1)
set hero direction(0,down)
set npc direction(2,left)
set npc direction(1,up)
set npc direction(3,right)
wait(2)
set hero direction(0,right)
set npc direction(2,down)
set npc direction(1,left)
set npc direction(3,up)
wait(5)
jig npc(1)
tb(6897)
jig hero(0)
tb(6898)
jig npc(1)
tb(6899)
walk hero(0,right,1)
walk npc(2,down,1)
walk npc(1,left,1)
walk npc(3,up,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(2)
set npc position(2,2,3)
wait for npc(1)
set npc position(1,1,3)
wait for npc(3)
set npc position(3,3,3)
#set hero direction(0,up)
set party in
set default weapon(find hero(1),37)
set hero picture(find hero(1),17,inside battle)
get item(36,1)
end
###

#######################
script, vicehand, begin
if(herox(0)==79,and,heroy(0)==100) then(
	walk hero(0,left,1)
	wait for hero(0)
)
walk hero to y(0,55)
wait for hero(0)
walk hero to x(0,100)
wait for hero(0)
set party out
wait(1)
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
set hero speed(0,4)
walk hero(0,left,1)
walk npc(2,up,1)
walk npc(1,right,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(3)
set npc frame(1,0)
set npc frame(2,0)
set npc frame(3,0)
wait(1)
set hero direction(0,down)
set npc direction(2,left)
set npc direction(1,up)
set npc direction(3,right)
wait(2)
set hero direction(0,right)
set npc direction(2,down)
set npc direction(1,left)
set npc direction(3,up)
wait(5)
jig npc(1)
tb(6900)
jig npc(2)
tb(6901)
jig npc(3)
tb(6902)
walk hero(0,right,1)
walk npc(2,down,1)
walk npc(1,left,1)
walk npc(3,up,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(2)
set npc position(2,2,3)
wait for npc(1)
set npc position(1,1,3)
wait for npc(3)
set npc position(3,3,3)
set hero direction(0,up)
set party in
set default weapon(find hero(3),43)
set hero picture(find hero(3),23,inside battle)
end
###

###########################
script, manxrunsaway, begin
suspend npc walls

variable(i)
variable(d1)
variable(d2)
variable(d3)
variable(d4)
variable(xxx)
set variable (xxx,26*20)
set variable (d1,NPC at spot (27,64))
set variable (d2,NPC at spot (27,63))
set variable (d3,NPC at spot (27,62))
set variable (d4,NPC at spot (27,61))
#set npc position(d1,26,64)
#set npc position(d1,26,63)
#set npc position(d1,26,62)
#set npc position(d1,26,61)
wait(1)
put npc (d1,xxx,64*20)
put npc (d2,xxx,(64*20)--20)
put npc (d3,xxx,(64*20)--40)
put npc (d4,xxx,(64*20)--60)
write pass block(26,63,128)
set npc position(4,27,66)

if(herox(0)==17,and,heroy(0)==66) then(
set npc direction(4,left)
mrright(8,0,0)
)
if(herox(0)==27,and,heroy(0)==73) then(
set npc direction(4,down)
mrup(8,0,0)
)
if(herox(0)==37,and,heroy(0)==66) then(
set npc direction(4,right)
mrleft(8,0,0)
)
set hero frame(0,0)

wait(5)
walk npc(4,up,6)
wait for npc(4)
set npc frame(4,0)
set npc position(4,1,1)

for (i,1,20,1) do(
	put npc (d1,xxx+i,64*20)
	put npc (d2,xxx+i,(64*20)--20)
	put npc (d3,xxx+i,(64*20)--40)
	put npc (d4,xxx+i,(64*20)--60)
	wait (1)
)

write pass block(26,63,1+2+4+8)
resume npc walls

set tag(405,1)
end
###

###############################
script, pleasurebusiness, num, begin
suspend player
suspend npcs
suspend obstruction
#painter
if(num==11) then(
#quest complete
if(check tag(431)) then(
jig npc(11)
tb(5761)
)

#sold it
if(check tag(430),and,check tag(431)==false) then(
jig npc(11)
tb(5735)
jig hero(0)
stop song
tb(5749)
jig npc(11)
tb(5753)
jig hero(0)
tb(5754)
jig npc(11)
tb(5758)
wait(5)
tb(5759)
jig npc(11)
play song(69)
tb(5760)
wait(3)
jadeup(4,1)
wait(3)
set tag(431,1)
)

#before having sold it
if(check tag(428),and,check tag(430)==false) then(
jig npc(11)
tb(5735)
)

#buy painting
if(check tag(427),and,check tag(428)==false) then(
set tag(258,0)
jig npc(11)
tb(5722)
if(check tag(258)) then(
	set tag(258,0)
	jig hero(0)
	tb(5723)
	jig npc(11)
	tb(5727)
	wait(8)
	jig npc(11)
	tb(5728)
	if(check tag(258)) then(
		if(paymoney(5)) then(
			jig hero(0)
			tb(5729)
			wait(2)
			tb(5733)
			get item(75,1)
			jig npc(11)
			tb(5734)
			set tag(428,1)
		)
		else(
			jig npc(11)
			show text box(5736)
			wait(2)
			set npc direction(11,left)
			wait for text box
		)
	)
	else(
		jig npc(11)
		show text box(5736)
		wait(2)
		set npc direction(11,left)
		wait for text box
	)
)
else(set npc direction(11,left))
)

#init painter
if(check tag(427)==false) then(
jig npc(11)
tb(5708)
tb(5709)
jig npc(11)
tb(6919)
jig hero(0)
tb(5710)
jig npc(11)
tb(5714)
tb(5715)
jig hero(0)
tb(5716)
jig npc(11)
show text box(5720)
wait(2)
set npc direction(11,left)
wait for text box
set tag(427,1)
)
)

if(num==12) then(
#buyer
#sold
if(check tag(430)) then(
jig npc(12)
tb(5748)
)

#sell to buyer
if(check tag(428),and,check tag(430)==false) then(
jig npc(12)
tb(5705)
jig hero(0)
tb(5737)
jig npc(12)
tb(5741)
wait(3)
stop song
palout(3)
show backdrop(0)
wait(1)
palin(1)
wait(15)
tb(5742)
wait(2)
tb(5743)
wait(4)
tb(5744)
wait(2)
tb(7985)
delete item(75,1)
get money(50)
palout(1)
show map
write map block(3,36,read map block(48,15))
write map block(3,37,read map block(48,16))
set npc direction(12,up)
wait(1)
palin(3)
set tag(430,1)
if(check tag(3)) then(play song(76))
if(check tag(4)) then(play song(76))
if(check tag(5)) then(play song(76))
if(check tag(6)) then(play song(4))
)

#buyer before painter
if(check tag(428)==false) then(
jig npc(12)
tb(5705)
)

)
resume obstruction
resume npcs
resume player
end
###

########################
script, masterdao, begin
suspend player
suspend npcs
suspend obstruction
set tag(258,0)

#Dogero
if(check tag(19)) then(daodog)

#Mi'la
if(check tag(20)) then(daomi)

#Johan
if(check tag(21)) then(daojo)

#Pyrus
if(check tag(22)) then(daopy)

resume obstruction
resume npcs
resume player
end
###

#####################
script, daodog, begin
	#finished
	if(check tag(434)) then(tb(5873))
	#haven't defeated dao yet
	else(
		stop song
		if(check tag(440)) then(tb(5763))
		else(
			tb(5762)
			set tag(440,1)
		)
		wait(4)
		tb(5764)
		set npc frame(4,1)
		tb(5765)

		#choose to fight
		if(check tag(258)) then(
			jig hero(0)
			tb(5798)

			#have icons?
			if(check equipment(find hero(0),2)>>99,or,check equipment(find hero(0),3)>>99,or,check equipment(find hero(0),4)>>99,or,check equipment(find hero(0),5)>>99) then(daonoicon)

			#no icons, fight!
			else(
				set party out
				swap out hero(1)
				swap out hero(2)
				swap out hero(3)
				jig npc(4)
				set npc frame(4,1)
				tb(5806)
				tb(5807)
				jig npc(4)
				set npc frame(4,1)
				tb(5808)
				tb(5809)
				jig npc(4)
				set npc frame(4,1)
				tb(5810)
				jig hero(0)
				tb(5811)
				set death script(249)
				stop song
				#win fight
				if(fight formation(259+poff)) then(
					daodogfight
					daodogafter
				)
				else(set hero stat(find hero(0),0,get hero stat(find hero(0),0,maximum stat)/2,current stat))
				set variable(battlesfought,battlesfought+1)
				set hero stat (findhero(0),1,get hero stat(findhero(0),1,maximumstat),currentstat)
			)
		)
		#choose not to fight
		else(
			jig hero(0)
			tb(5766)
			set npc frame(4,0)
			tb(5767)
			wait(12)
			set npc frame(4,1)
			tb(5768)
			jig hero(0)
			tb(5769)
			jig npc(4)
			set npc frame(4,1)
			tb(5770)
			tb(5771)
			wait(10)
			tb(5772)
			jig npc(4)
			set npc frame(4,1)
			tb(5773)
			if(check tag(3)) then(play song(77))
			if(check tag(4)) then(play song(77))
			if(check tag(5)) then(play song(77))
			if(check tag(6)) then(play song(4))
		)
	)
end
###

####################
script, daomi, begin
	#finished
	if(check tag(435)) then(tb(5873))
	#haven't defeated dao yet
	else(
		stop song
		if(check tag(440)) then(tb(5763))
		else(
			tb(5762)
			set tag(440,1)
		)
		wait(4)
		tb(5764)
		set npc frame(4,1)
		tb(5765)

		#choose to fight
		if(check tag(258)) then(
			jig hero(0)
			tb(5799)

			#have icons?
			if(check equipment(find hero(1),2)>>99,or,check equipment(find hero(1),3)>>99,or,check equipment(find hero(1),4)>>99,or,check equipment(find hero(1),5)>>99) then(daonoicon)

			#no icons, fight!
			else(
				set party out
				swap out hero(0)
				swap out hero(2)
				swap out hero(3)
				jig npc(4)
				set npc frame(4,1)
				tb(5806)
				tb(5807)
				jig npc(4)
				set npc frame(4,1)
				tb(5808)
				tb(5809)
				jig npc(4)
				set npc frame(4,1)
				tb(5810)
				jig hero(0)
				tb(5812)
				set death script(249)
				stop song
				#win fight
				if(fight formation(263+poff)) then(
					daomifight
					daomiafter
				)
				else(set hero stat(find hero(1),0,get hero stat(find hero(1),0,maximum stat)/2,current stat))
				set variable(battlesfought,battlesfought+1)
				set hero stat (findhero(1),1,get hero stat(findhero(1),1,maximumstat),currentstat)
			)
		)
		#choose not to fight
		else(
			jig hero(0)
			tb(5774)
			jig npc(4)
			set npc frame(4,1)
			tb(5775)
			jig hero(0)
			tb(5776)
			jig npc(4)
			set npc frame(4,1)
			tb(5777)
			jig hero(0)
			tb(5778)
			jig npc(4)
			set npc frame(4,1)
			tb(5779)
			if(check tag(3)) then(play song(77))
			if(check tag(4)) then(play song(77))
			if(check tag(5)) then(play song(77))
			if(check tag(6)) then(play song(4))
		)
	)
end
###

####################
script, daojo, begin
	#finished
	if(check tag(436)) then(tb(5873))
	#haven't defeated dao yet
	else(
		stop song
		if(check tag(440)) then(tb(5763))
		else(
			tb(5762)
			set tag(440,1)
		)
		wait(4)
		tb(5764)
		set npc frame(4,1)
		tb(5765)

		#choose to fight
		if(check tag(258)) then(
			jig hero(0)
			tb(5800)

			#have icons?
			if(check equipment(find hero(2),2)>>99,or,check equipment(find hero(2),3)>>99,or,check equipment(find hero(2),4)>>99,or,check equipment(find hero(2),5)>>99) then(daonoicon)

			#no icons, fight!
			else(
				set party out
				swap out hero(0)
				swap out hero(1)
				swap out hero(3)
				jig npc(4)
				set npc frame(4,1)
				tb(5806)
				tb(5807)
				jig npc(4)
				set npc frame(4,1)
				tb(5808)
				tb(5809)
				jig npc(4)
				set npc frame(4,1)
				tb(5810)
				jig hero(0)
				tb(5813)
				set death script(249)
				stop song
				#win fight
				if(fight formation(267+poff)) then(
					daojofight
					daojoafter
				)
				else(set hero stat(find hero(2),0,get hero stat(find hero(2),0,maximum stat)/2,current stat))
				set variable(battlesfought,battlesfought+1)
				set hero stat (findhero(2),1,get hero stat(findhero(2),1,maximumstat),currentstat)
			)
		)
		#choose not to fight
		else(
			jig hero(0)
			tb(5780)
			jig npc(4)
			set npc frame(4,1)
			tb(5781)
			tb(5782)
			jig hero(0)
			tb(5783)
			jig npc(4)
			set npc frame(4,1)
			tb(5784)
			jig hero(0)
			tb(5785)
			wait(10)
			jig npc(4)
			set npc frame(4,1)
			tb(5786)
			tb(5787)
			jig hero(0)
			tb(5788)
			jig npc(4)
			jig npc(4)
			set npc frame(4,1)
			tb(5789)
			if(check tag(3)) then(play song(77))
			if(check tag(4)) then(play song(77))
			if(check tag(5)) then(play song(77))
			if(check tag(6)) then(play song(4))
		)
	)
end
###

####################
script, daopy, begin
	#finished
	if(check tag(437)) then(tb(5873))
	#haven't defeated dao yet
	else(
		stop song
		if(check tag(440)) then(tb(5763))
		else(
			tb(5762)
			set tag(440,1)
		)
		wait(4)
		tb(5764)
		set npc frame(4,1)
		tb(5765)

		#choose to fight
		if(check tag(258)) then(
			jig hero(0)
			tb(5801)

			#have icons?
			if(check equipment(find hero(3),2)>>99,or,check equipment(find hero(3),3)>>99,or,check equipment(find hero(3),4)>>99,or,check equipment(find hero(3),5)>>99) then(daonoicon)

			#no icons, fight!
			else(
				set party out
				swap out hero(0)
				swap out hero(1)
				swap out hero(2)
				jig npc(4)
				set npc frame(4,1)
				tb(5806)
				tb(5807)
				jig npc(4)
				set npc frame(4,1)
				tb(5808)
				tb(5809)
				jig npc(4)
				set npc frame(4,1)
				tb(5810)
				jig hero(0)
				tb(5814)
				set death script(249)
				stop song
				#win fight
				if(fight formation(271+poff)) then(
					daopyfight
					daopyafter
				)
				else(set hero stat(find hero(3),0,get hero stat(find hero(3),0,maximum stat)/2,current stat))
				set variable(battlesfought,battlesfought+1)
				set hero stat (findhero(3),1,get hero stat(findhero(3),1,maximumstat),currentstat)
			)
		)
		#choose not to fight
		else(
			jig hero(0)
			tb(5790)
			jig npc(4)
			tb(5791)
			tb(5792)
			tb(5793)
			jig hero(0)
			tb(5794)
			jig npc(4)
			set npc frame(4,1)
			tb(5795)
			jig hero(0)
			tb(5796)
			jig npc(4)
			tb(5797)
			if(check tag(3)) then(play song(77))
			if(check tag(4)) then(play song(77))
			if(check tag(5)) then(play song(77))
			if(check tag(6)) then(play song(4))
		)
	)
end
###

########################
script, daonoicon, begin
set npc frame(4,0)
tb(5802)
set npc frame(4,1)
tb(5803)
tb(5804)
wait(2)
set npc frame(4,0)
wait(2)
tb(5805)
if(check tag(3)) then(play song(77))
if(check tag(4)) then(play song(77))
if(check tag(5)) then(play song(77))
if(check tag(6)) then(play song(4))
end
###

##########################
script, daodogfight, begin
wait(5)
set npc frame(4,0)
wait(2)
tb(5816)
stop song
pan camera(south,0,0)
alter npc(4,NPCstat:picture,505)
alter npc(4,NPCstat:movespeed,10)
set hero speed(0,10)
walk npc(4,down,8)
walk hero(0,down,8)
set hero direction(0,up)
wait(3)
tb(5817)
wait for hero(0)
wait(3)
palout(1)
camera follows hero(0)
teleport to map(45+poff,43,73)
stop song
wait(1)
pan camera(south,0,0)
hero clothes
set npc position(15,0,0)
set hero position(0,45,71)
set npc position(7,41,71)
set npc position(1,36,74)
set npc position(2,50,73)
set npc position(3,50,74)
set npc position(6,36,73)
create npc(6,36,72,right)
create npc(6,36,75,right)
create npc(6,50,72,left)
create npc(6,50,75,left)
set npc direction(1,right)
set npc direction(2,left)
set npc direction(3,left)
set npc direction(6,right)
alter npc(7,NPCstat:picture,505)
alter npc(6,NPCstat:picture,317)
alter npc(6,NPCstat:palette,153+poff)
variable(dogpic)
variable(dogpic2)
if(get hero picture(0,outsidebattle)==230) then(
set variable(dogpic,508)
set variable(dogpic2,230)
)
else(
set variable(dogpic,507)
set variable(dogpic2,229)
)
set hero direction(0,left)
set npc direction(7,right)
alter npc(7,NPCstat:movespeed,10)
set hero speed(0,10)
wait(15)
play song(72)
palin(4)

wait(15)
jig npc(7)
tb(5818)
walk npc(7,right,2)
walk hero(0,left,2)
wait for hero(0)
show backdrop(46)
set hero position(0,39,71)
set npc position(7,47,71)
set hero picture(0,dogpic)
alter npc(7,NPCstat:picture,506)
wait(3)
show map
wait(15)
alter npc(7,NPCstat:picture,505)
set hero picture(0,dogpic2)
wait(2)
set npc direction(7,down)
set hero direction(0,down)
wait(1)
set npc direction(7,left)
set hero direction(0,right)
wait(2)
alter npc(7,NPCstat:picture,506)
wait(3)
set hero picture(0,dogpic)
wait(5)
jig npc(7)
tb(5819)
wait(1)
walk npc(7,left,4)
walk hero(0,right,4)
wait for hero(0)
show backdrop(46)
walk npc(7,left,2)
walk hero(0,right,2)
wait for hero(0)
show map
walk npc(7,right,2)
walk hero(0,left,2)
wait for hero(0)
show backdrop(46)
walk npc(7,right,1)
walk hero(0,left,1)
wait for hero(0)
set hero position(0,41,71)
set npc position(7,45,71)
wait(1)
show map
wait(15)
alter npc(7,NPCstat:picture,505)
set hero picture(0,dogpic2)
wait(2)
set npc direction(7,down)
set hero direction(0,down)
wait(1)
set npc direction(7,left)
set hero direction(0,right)
wait(1)
set hero picture(0,dogpic)
wait(5)
alter npc(7,NPCstat:picture,506)
wait(3)
jig npc(7)
tb(5820)
jig hero(0)
play song(7)
tb(5821)
walk hero(0,right,4)
wait for hero(0)
show backdrop(46)
wait(1)
fade screen out(63,63,63)
wait(1)
set hero picture(0,dogpic2)
show backdrop(0)
wait(10)
fade screen in
end
###

##########################
script, daodogafter, begin
wait(10)
dogero level up(3,102)
wait(1)
palout(1)
wait(1)
show map
camera follows hero(0)
teleport to map(41+poff,22,14)
stop song
set hero direction(0,up)
wait(1)
pan camera(south,0,0)
set hero position(0,22,5)
wait(1)
pan camera(up,9,2)
play song(91)
wait(1)
palin(5)

wait for camera
wait(15)
tb(5822)
jig hero(0)
tb(5823)
set npc frame(4,1)
tb(5824)
set npc frame(4,0)
tb(5825)
set death script(3)
set tag(434,1)
camera follows hero(0)
set hero speed(0,hspeed)
set party in
end
###

#########################
script, daomifight, begin
wait(15)
set npc frame(4,0)
wait(2)
tb(5826)
tb(5827)
wait(2)
set npc frame(4,1)
wait(2)
tb(5828)
wait(3)
stop song
palout(1)
set hero position(0,19,44)
set npc position(4,19,43)
wait(1)
palin(5)

wait(15)
jig npc(4)
tb(5829)
wait(2)
set npc frame(4,1)
wait(2)
tb(5830)
wait(2)
show backdrop(0)
wait(15)
tb(5829)
wait(3)
tb(5831)
wait(3)
tb(5832)
alter npc(4,NPCstat:picture,506)
set npc direction(4,up)
play song(84)
wait(1)
show map
wait(5)
jig hero(0)
tb(5833)
wait(3)
alter npc(4,NPCstat:picture,316)
set npc direction(4,down)
set npc frame(4,1)
wait(2)
set npc frame(4,0)
wait(2)
tb(5834)
wait(2)
set npc frame(4,1)
wait(2)
tb(5835)
jig hero(0)
tb(5836)
pan camera(south,0,0)
set hero speed(0,10)
walk hero(0,up,1)
wait for hero(0)
show backdrop(46)
play song(7)
wait(1)
fade screen out(63,63,63)
wait(1)
palout(1)
wait(1)
show backdrop(0)
wait(1)
palin(1)
camera follows hero(0)
set hero position(0,22,14)
wait(1)
pan camera(south,0,0)
set hero position(0,22,5)
wait(1)
set hero frame(0,0)
set npc position(4,22,4)
set npc frame(4,0)
end
###

#########################
script, daomiafter, begin
wait(15)
mila level up(3,105)
stop song
wait(10)
palout(1)
wait(1)
show map
pan camera(up,9,2)
play song(91)
wait(1)
palin(5)

wait for camera
wait(15)
jig npc(4)
tb(5837)
jig hero(0)
tb(5838)
wait(2)
set npc frame(4,1)
wait(2)
tb(5839)
wait(2)
set npc frame(4,0)
wait(2)
tb(5840)
jig hero(0)
tb(5841)
jig npc(4)
jig npc(4)
set npc frame(4,1)
tb(5842)
camera follows hero(0)
set hero speed(0,hspeed)
set party in
set death script(3)
set tag(435,1)
end
###

#########################
script, daojofight, begin

wait(5)
set npc direction(4,up)
tb(5843)
jig hero(0)
tb(5844)
wait(2)
set npc direction(4,down)
wait(2)
set npc direction(4,up)
tb(5845)
wait(10)
tb(5846)
set npc direction(4,down)
tb(5847)
wait(15)
set npc frame(4,1)
wait(20)
stop song
tb(5848)
tb(5849)
jig hero(0)
tb(5850)
jig npc(4)
set npc frame(4,1)
tb(5851)
jig hero(0)
tb(5852)
jig npc(4)
set npc frame(4,1)
tb(5853)
alter npc(4,NPCstat:movespeed,10)
alter npc(4,NPCstat:picture,505)
walk npc(4,down,1)
wait for npc(4)
show backdrop(46)
play song(7)
wait(1)
fade screen out(63,63,63)
wait(1)
show backdrop(0)
wait(1)
palout(1)
wait(1)
palin(1)
camera follows hero(0)
set hero position(0,22,14)
wait(1)
pan camera(south,0,0)
set hero position(0,22,5)
wait(1)
set hero frame(0,0)
set npc position(4,22,4)
alter npc(4,NPCstat:picture,316)
set npc frame(4,0)
end
###

#########################
script, daojoafter, begin
wait(15)
johan level up(3,108)
wait(10)
stop song
palout(1)
wait(1)
show map
pan camera(up,9,2)
play song(91)
wait(1)
palin(5)

wait for camera
wait(15)
jig npc(4)
set npc frame(4,1)
tb(5854)
wait(2)
set npc frame(4,0)
wait(2)
tb(5855)
jig hero(0)
tb(5856)
jig npc(4)
set npc frame(4,1)
tb(5857)
tb(5858)
jig npc(4)
set npc frame(4,1)
tb(5859)
jig hero(0)
tb(5860)
wait(2)
set npc frame(4,0)
tb(5861)

camera follows hero(0)
set hero speed(0,hspeed)
set party in
set death script(3)
set tag(436,1)
end
###

#########################
script, daopyfight, begin

pan camera(south,0,0)
jig npc(4)
set npc frame(4,1)
tb(5862)
wait(2)
set npc frame(4,0)
wait(2)
tb(5863)
wait(2)
stop song
alter npc(4,NPCstat:picture,506)
alter npc(4,NPCstat:movespeed,10)
set hero speed(0,10)
walk npc(4,down,7)
walk hero(0,down,7)
set hero direction(0,up)
wait(3)
tb(5864)
wait for hero(0)
palout(1)
camera follows hero(0)
teleport to map(45+poff,43,82)
stop song
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
alter npc(7,NPCstat:picture,506)
alter npc(7,NPCstat:movespeed,10)
wait(1)
palin(3)
set tag(8,1)
wait(15)

set hero position(0,43,78)
walk hero(0,down,1)
set hero direction(0,up)
wait for hero(0)
set npc position(7,43,78)
walk npc(7,down,3)
walk hero(0,down,3)
set hero direction(0,up)
wait for hero(0)
variable(i)
variable(cx)
variable(cy)
set variable(cx, camera pixel x)
set variable(cy, camera pixel y)
for(i,1,5,1) do(
put camera(cx+random(-5,5),cy+random(-5,5))
wait(1)
)
for(i,1,8,1) do(
put camera(cx+random(-10,10),cy+random(-10,10))
wait(1)
)
put camera(cx,cy)
wait(3)
jig npc(7)
play song(8)
tb(5865)
tb(6923)
jig npc(7)
for(i,1,7,1) do(
put camera(cx+random(-10,10),cy+random(-10,10))
wait(1)
)
put camera(cx,cy)
tb(5866)
jig hero(0)
stop song
tb(5867)
walk hero(0,up,1)
wait for hero(0)
show backdrop(46)
play song(7)
wait(1)
fade screen out(63,63,63)
wait(1)
show backdrop(0)
wait(1)
palin(1)
end
###

#########################
script, daopyafter, begin
wait(15)
pyrus level up(3,111)
wait(10)
palout(1)
wait(1)

camera follows hero(0)
teleport to map(41+poff,22,14)
stop song
wait(1)
pan camera(south,0,0)
set hero position(0,22,5)
set hero frame(0,0)
wait(1)

show map
pan camera(up,9,2)
play song(91)
wait(1)
palin(5)

wait for camera
wait(15)
tb(5868)
jig npc(4)
set npc frame(4,1)
tb(5869)
tb(5870)
jig hero(0)
tb(5871)
wait(3)
set npc frame(4,0)
wait(3)
tb(5872)

set tag(8,0)
camera follows hero(0)
set hero speed(0,hspeed)
set party in
set death script(3)
set tag(437,1)
end
###

############################
script, bountycollect, begin
suspend player
suspend npcs
suspend obstruction

#Wobbler
if(herox(0)==21,and,heroy(0)==25,and,check tag(442)==false) then(
	set tag(441,1)
	set tag(449,1)
	tb(5884)
)

#Pecu
if(herox(0)==25,and,heroy(0)==25,and,check tag(444)==false) then(
	set tag(443,1)
	tb(5900)
)

#Pyrus
if(herox(0)==23,and,heroy(0)==25,and,check tag(446)==false) then(
	set tag(445,1)
	tb(5917)

	#check if pyrus is leading
	if(check tag(22)) then(
		stop song
		tb(5918)
		play song(15)
		wait(2)
		alter npc(4,NPCstat:picture,509)
		alter npc(4,NPCstat:palette,277+poff)
		alter npc(5,NPCstat:picture,201)
		alter npc(5,NPCstat:palette,429+poff)
		alter npc(4,NPCstat:movespeed,2)
		alter npc(5,NPCstat:movespeed,2)
		set npc position(4,23,31)
		walk npc(4,up,3)
		pan camera(down,3,4)
		wait(2)
		set hero direction(0,left)
		wait(2)
		set hero direction(0,down)
		wait for npc(4)
		set npc frame(4,0)
		wait(5)
		variable(goon1)
		variable(goon2)
		variable(goon3)
		set variable(goon1,create npc(5,npcx(4),npcy(4)))
		set variable(goon2,create npc(5,npcx(4),npcy(4)))
		set variable(goon3,create npc(5,npcx(4),npcy(4)))

		pybounty1(goon1,goon2,goon3)
		pybounty2
		pybounty3(goon1,goon2,goon3)
	)
)

#Dayne
if(herox(0)==27,and,heroy(0)==25,and,check tag(448)==false) then(
set tag(447,1)
tb(5939)
)

#Clerk
if((herox(0)==19,and,heroy(0)==28),or,(herox(0)==21,and,heroy(0)==26)) then(
#have completed all bounties
if(check tag(442),and,check tag(444),and,check tag(446),and,check tag(448)) then(tb(6924))
#have not completed all
else(tb(5881))
)

resume obstruction
resume npcs
resume player
end
###

#############################################
script, pybounty1, goon1, goon2, goon3, begin
walk npc(goon1,left,1)
walk npc(goon2,right,1)
walk npc(goon3,down,1)
wait for npc(goon1)
set npc frame(goon1,0)
set npc direction(goon1,up)
wait for npc(goon2)
set npc frame(goon2,0)
set npc direction(goon2,up)
wait for npc(goon3)
set npc frame(goon3,0)
set npc direction(goon3,right)
wait(2)
set npc direction(goon3,up)

hero clothes
set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk npc(3,down,1)
walk npc(2,left,1)
walk npc(1,right,1)
wait for npc(3)
set npc frame(3,0)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,down)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait(15)

jig npc(3)
tb(5919)
wait(2)
set npc direction(4,right)
jig npc(4)
tb(5920)
wait(1)
set npc direction(4,up)
wait(1)
tb(5921)
wait(2)
set npc direction(2,right)
jig npc(2)
tb(5922)
jig npc(4)
show text box(5923)
wait(2)
set npc direction(2,down)
wait for text box
jig npc(3)
tb(5924)
wait(2)
set npc direction(4,left)
wait(6)
set npc direction(4,up)
wait(2)
set npc direction(4,right)
wait(6)
set npc direction(4,up)
wait(10)
jig npc(4)
tb(5925)
jig npc(3)
tb(5926)
jig npc(4)
tb(5927)
jig npc(3)
tb(5928)
end
###
#############################################
script, pybounty2, begin
stop song
battleflash
set party in
ff(284+poff)
play song(82)
set party out
swap by position(find hero(0),0)
write map block(23,24,read map block(24,24))
if(check tag(442)) then(write map block(21,24,read map block(24,24)))
if(check tag(444)) then(write map block(25,24,read map block(24,24)))
#if(check tag(446)) then(write map block(23,24,read map block(24,24)))
if(check tag(448)) then(write map block(27,24,read map block(24,24)))
end
###
#############################################
script, pybounty3, goon1, goon2, goon3, begin
alter npc(4,NPCstat:movespeed,10)
alter npc(5,NPCstat:movespeed,10)

#goon1 is left
#goon2 is right
#goon3 is down

walk npc(goon1,left,1)
walk npc(goon3,down,1)
walk npc(4,down,1)
walk npc(goon2,left,1)
wait for npc(goon1)

walk npc(goon1,down,1)
walk npc(goon3,down,1)
walk npc(4,down,1)
walk npc(goon2,down,1)
wait for npc(goon1)

walk npc(goon1,down,1)
walk npc(goon3,left,1)
walk npc(4,down,1)
walk npc(goon2,down,1)
wait for npc(goon1)

walk npc(goon1,down,1)
walk npc(goon3,down,1)
walk npc(4,left,1)
walk npc(goon2,down,1)
wait for npc(goon1)

destroy npc(goon3)
walk npc(goon1,right,1)
walk npc(4,down,1)
walk npc(goon2,left,1)
wait for npc(goon1)

destroy npc(4)
walk npc(goon1,down,1)
walk npc(goon2,down,1)
wait for npc(goon1)

destroy npc(goon1)
destroy npc(goon2)

wait(1)
pan camera(up,3,5)
wait for camera
wait(10)
set npc direction(3,left)
wait(2)
set npc direction(3,up)
jig npc(3)
show text box(5929)
wait(2)
set npc direction(2,right)
wait(2)
set npc direction(1,left)
wait for text box
jig npc(1)
tb(5930)
jig npc(2)
tb(5931)
jig hero(0)
tb(5932)
jig npc(3)
tb(5933)
tb(5934)
jig npc(2)
tb(5935)
jig npc(1)
tb(5936)
jig npc(2)
tb(5937)
jig hero(0)
tb(5938)
stop song
pan camera(south,1,2)
set hero speed(0,4)
walk npc(1,left,1)
walk npc(2,right,1)
walk hero(0,down,1)
wait for npc(1)
set npc position(1,0,0)
wait for npc(2)
set npc position(2,0,0)
wait for hero(0)
set npc position(3,0,0)
set hero frame(0,0)
set party in
set hero speed(0,hspeed)
wait for camera
camera follows hero(0)
set tag(446,1)
wait(3)
jadeup(4,1)
wait(3)
if(check tag(6)) then(play song(4))
else(play song(77))
end
###

############################
script, rebuildcastle, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#finished
if(check tag(455)) then(
jig npc(7)
tb(5988)
)

#finished, special one time only
if(check tag(454),and,check tag(455)==false) then(
jig npc(7)
tb(5977)
set npc frame(7,0)
tb(5978)
jig hero(0)
tb(5979)
jig npc(7)
tb(5983)
tb(5984)
tb(7986)
jig npc(7)
tb(5985)
tb(5986)
jig npc(7)
tb(5987)
set tag(455,1)
)

#after init, have invested
if(check tag(452),and,check tag(453),and,check tag(454)==false) then(
jig npc(4)
tb(5975)
set variable(text1,castleday--day)
tb(5976)
)

#after init, have yet to invest
if(check tag(452),and,check tag(453)==false) then(
jig npc(4)
tb(5966)
#chose to pay
if(check tag(258)) then(
if(paymoney(300)) then(
stop song
jig hero(0)
tb(5967)
wait(3)
tb(5971)
wait(2)
jig npc(4)
tb(5972)
wait(3)
tb(5973)
get item(76,1)
jig npc(4)
show text box(5974)
wait(2)
set npc direction(4,up)
wait for text box
wait(2)
palout(1)
set npc position(4,0,0)
set tag(453,1)
set hero direction(0,up)
camera follows hero(0)
set variable(castleday,day+6)
wait(1)
palin(3)
if(check tag(3)) then(play song(76))
if(check tag(4)) then(play song(76))
if(check tag(5)) then(play song(76))
if(check tag(6)) then(play song(4))
)

#not enough money
else(
jig hero(0)
tb(5956)
jig npc(4)
show text box(5960)
wait(2)
set npc direction(4,up)
wait for text box
)
)

#chose not to pay
else(
jig hero(0)
tb(5961)
jig npc(4)
show text box(5965)
wait(2)
set npc direction(4,up)
wait for text box
)
)

#init conversation
if(check tag(452)==false) then(
set tag(452,1)
jig npc(4)
stop song
tb(5940)
play song(91)
set hero speed(0,2)
wait(3)
focus camera(41,38,2)
wait(3)
if(heroy(0)<<43) then(
walk hero to x(0,43)
wait for hero(0)
walk hero to y(0,40)
wait for hero(0)
walk hero to x(0,41)
wait for hero(0)
)
else(
walk hero to y(0,42)
wait for hero(0)
walk hero to x(0,41)
wait for hero(0)
walk hero to y(0,40)
wait for hero(0)
)
set hero frame(0,0)
set hero direction(0,left)
wait for camera
wait(3)
jig hero(0)
tb(5941)
jig npc(4)
tb(5945)
jig npc(4)
show text box(5946)
wait(2)
set hero direction(0,up)
wait for text box
tb(5947)
jig npc(4)
tb(5948)
tb(5949)
wait(10)
focus camera(herox(0),heroy(0),2)
wait(4)
set npc direction(4,right)
wait for camera
wait(2)
jig npc(4)
tb(5950)
tb(5951)
jig npc(4)
tb(5952)
wait(4)
set hero direction(0,left)
wait(3)
jig npc(4)
tb(5953)
tb(5954)
jig npc(4)
tb(5955)

#chose to pay
if(check tag(258)) then(
if(paymoney(300)) then(
stop song
jig hero(0)
tb(5967)
wait(3)
tb(5971)
wait(2)
jig npc(4)
tb(5972)
wait(3)
tb(5973)
get item(76,1)
jig npc(4)
show text box(5974)
wait(2)
set npc direction(4,up)
wait for text box
wait(2)
palout(1)
set npc position(4,0,0)
set tag(453,1)
set hero direction(0,up)
camera follows hero(0)
set variable(castleday,day+6)
wait(1)
palin(3)
if(check tag(3)) then(play song(76))
if(check tag(4)) then(play song(76))
if(check tag(5)) then(play song(76))
if(check tag(6)) then(play song(4))
)

#not enough money
else(
jig hero(0)
tb(5956)
jig npc(4)
show text box(5960)
wait(2)
set npc direction(4,up)
wait for text box
)
)

#chose not to pay
else(
jig hero(0)
tb(5961)
jig npc(4)
show text box(5965)
wait(2)
set npc direction(4,up)
wait for text box
)
camera follows hero(0)
set hero speed(0,hspeed)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, worldending, num, begin
suspend player
suspend npcs
suspend obstruction

#check if on ten's map or sparra's
if(currentmap==41,or,currentmap==42,or,currentmap==43,or,currentmap==44,or,currentmap==53,or,currentmap==54,or,currentmap==55,or,currentmap==56) then(

worldending1
worldending2
worldending3
worldending4

)

#on sparra's map
else( worldending5(num) )

resume obstruction
resume npcs
resume player
end
###
###########################
script, worldending1, begin
	#Tag 422 - Beat Ten, use key
	if(check tag(421),and,check tag(422)==false) then(
		set tag(426,1)
		tb(6098)
		delete item(74,1)
		wait(2)
		stop song
		palout(1)
		show backdrop(0)
		wait(1)
		palin(1)
		wait(5)
		tb(6099)
		wait(10)
		tb(6100)
		wait(2)
		tb(6101)
		wait(10)
		tb(6102)
		wait(2)
		tb(6103)
		wait(2)
		tb(6104)
		wait(2)
		tb(6105)
		wait(2)
		tb(6106)
		wait(2)
		tb(6107)
		wait(2)
		tb(6108)
		unequip(find hero(4),2)
		unequip(find hero(4),3)
		unequip(find hero(4),4)
		unequip(find hero(4),5)
		unequip(find hero(5),2)
		unequip(find hero(5),3)
		unequip(find hero(5),4)
		unequip(find hero(5),5)
		swap in hero(0)
		delete hero(4)
		delete hero(5)
		set party in
		set hero direction(0,down)
		camera follows hero(0)
		teleport to map(49+poff,11,129)
		stop song
		wait(1)
		play song(69)
		palout(1)
		show map
		set tag(422,1)
		set tag(423,1)
		#turning 424 back on
		set tag(424,1)
		wait(1)
		palin(5)
		wait(3)
		jadeup(7,2)
		create npc(26,10,129)
		create npc(26,12,129)
		set variable(isrunning,true)
		wait(3)
	)
end
###
###########################
script, worldending2, begin
	#Tag 421 - Ten hype 8
	if(check tag(420),and,check tag(421)==false) then(
		set npc position(11,0,0)
		jig npc(10)
		play song(15)
		tb(6093)
		wait(2)
		variable(k)
		for(k,1,5,1,) do(
		show backdrop(1)
		wait(2)
		show map
		load tileset(104)
		wait(2)
		)
		set variable(battlesfought,battlesfought+1)
		fight formation(283)
		stop song
		load tileset(104)
		alter npc(10,NPCstat:picture,503)
		set npc direction(10,left)
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:whenactivated,npcwhenactivated:donotfaceplayer)
		set hero speed(0,2)
		walk hero(0,up,1)
		wait for hero(0)
		set hero frame(0,0)
		alter npc(31,NPCstat:picture,324)
		alter npc(31,NPCstat:palette,125+poff)
		alter npc(31,NPCstat:movespeed,2)
		swap by position(find hero(5),0)
		set npc position(31,herox(0),heroy(0))
		walk npc(31,right,1)
		wait for npc(31)
		set npc frame(31,0)
		set npc direction(31,up)
		jig hero(0)
		tb(6094)
		jig npc(31)
		tb(6095)
		wait(5)
		jig hero(0)
		tb(6096)
		wait(2)
		tb(6097)
		get item(74,1)
		walk npc(31,left,1)
		wait for npc(31)
		set npc position(31,0,0)
		set hero speed(0,hspeed)
		write pass block(52,25,1+2+4+8)
		set tag(421,1)
		play song(17)
	)
end
###
###########################
script, worldending3, begin
	#Tag 420 - Ten hype 7
	if(check tag(419),and,check tag(420)==false) then(
		set npc position(11,52,24)
		jig npc(10)
		tb(6092)
		set tag(420,1)
	)
	#Tag 419 - Ten hype 6
	if(check tag(418),and,check tag(419)==false) then(
		set npc position(11,52,26)
		tb(6091)
		set tag(419,1)
	)
	#Tag 418 - Ten hype 5
	if(check tag(417),and,check tag(418)==false) then(
		set npc position(11,52,28)
		tb(6090)
		set tag(418,1)
	)
	#Tag 417 - Ten hype 4
	if(check tag(416),and,check tag(417)==false) then(
		set npc position(11,52,31)
		tb(6089)
		set tag(417,1)
	)
	#Tag 416 - Ten hype 3
	if(check tag(415),and,check tag(416)==false) then(
		set npc position(11,52,34)
		tb(6088)
		set tag(416,1)
	)
	#Tag 415 - Ten hype 2
	if(check tag(414),and,check tag(415)==false) then(
		set npc position(11,52,37)
		tb(6087)
		set tag(415,1)
	)
	#Tag 414 - Ten hype 1
	if(check tag(425),and,check tag(414)==false) then(
		#turning 424 (captured) off, to display ten, npc 10
		set tag(424,0)
		set npc position(10,52,22)

		set npc direction(10,down)
		set npc position(11,52,40)
		tb(6086)
		set tag(414,1)
	)

	#Tag 425 - CAPTURED
	if(check tag(424),and,check tag(425)==false) then(
		stop song
		tb(84)
		palout(1)
		camera follows hero(0)
		teleport to map(49+poff,9,130)
		wait(1)
		pan camera(south,0,0)
		wait(1)
		set hero position(0,0,0)
		wait(1)
		palin(1)
		wait(10)
		set npc position(npc at spot(7,130),0,0)
		set npc position(npc at spot(8,129),0,0)
		alter npc(9,NPCstat:picture,324)
		set npc direction(npc at spot(7,129),right)
		jig npc(npc at spot(7,129))
		tb(6079)
		jig npc(8)
		tb(6080)
		wait(5)
		jig npc(npc at spot(7,129))
		tb(6081)
		jig npc(8)
		tb(6082)
		add hero(5)
		add hero(4)
		set party out
		swap out hero(0)
		swap out hero(1)
		swap in hero(5)
		swap in hero(4)
		swap out hero(2)
		swap out hero(3)
		swap by position(find hero(5),0)
		swap by position(find hero(4),2)
		palout(1)
		camera follows hero(0)
		teleport to map(53+poff,20,52)
		wait(1)
		set npc position(6,0,0)
		set hero direction(0,up)
		alter npc(3,NPCstat:picture,324)
		alter npc(3,NPCstat:palette,125+poff)
		set hero palette(find hero(5),141+poff)
		set hero palette(find hero(4),125+poff)
		set npc position(3,20,51)
		set npc direction(3,up)
		wait(1)
		palin(1)
		wait(10)
		jig npc(3)
		jig npc(3)
		wait(6)
		set npc direction(3,right)
		wait(2)
		set npc direction(3,down)
		jig npc(3)
		stop song
		tb(6083)
		jig hero(0)
		tb(6084)
		tb(6085)
		palout(2)
		teleport to map(41+poff,4,134)
		stop song
		pan camera(south,0,0)
		wait(1)
		set npc position(10,0,0)
		set variable(isrunning,false)
		set hero position(0,5,136)
		write map block(1,133,read map block(80,0))
		wait(1)
		palin(2)
		play song(17)
		write pass block(5,137,1+2+4+8)
		create npc(35,1,133)
		set tag(425,1)
	)

	#Tag 424 - captured, just kidding
	if(check tag(413),and,check tag(424)==false,and,currentmap>>48) then(
		palout(1)
		teleport to map(41+poff,5,136)
		stop song
		set npc position(10,0,0)
		wait(1)
		palin(1)
		walk hero(0,up,2)
		wait for hero(0)
		pan camera(south,0,0)
		set hero direction(0,left)
		wait(4)
		set hero direction(0,up)
		wait(4)
		set hero direction(0,left)
		wait(2)
		set hero direction(0,down)
		wait(4)
		set hero direction(0,left)
		heroclothes
		pright
		jig hero(0)
		tb(6076)
		jig npc(2)
		tb(6077)
		jig npc(1)
		tb(6078)
		ppright
		set tag(424,1)
	)
end
###
###########################
script, worldending4, begin
	#making sure one cannot wait for text phase to trigger wrong script
	if(check tag(413),and,check tag(424)==false,and,currentmap<<48,and,herox(0)<<40) then(
		tb(6075)
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:displaytext,6075)
	)

	#Tag 413 - pre cature
	if(check tag(411),and,check tag(413)==false) then(
		stop song
		tb(6063)
		delete item(74,1)
		palout(1)
		teleport to map(41+poff,5,136)
		stop song
		set npc position(10,1,132)
		set npc direction(10,up)
		wait(1)
		palin(1)
		walk hero(0,up,3)
		wait for hero(0)
		set hero direction(0,left)
		jig hero(0)
		tb(6064)
		jig npc(10)
		play song(15)
		tb(6068)
		tb(6069)
		wait(5)
		variable(j)
		variable(nx)
		variable(ny)
		set variable(nx,npc pixel x(10))
		set variable(ny,npc pixel y(10))
		for(j,1,8,1) do(
			put npc(10,nx+random(-1,1),ny+random(-1,1))
			wait(1)
		)
		put npc(10,nx,ny)
		wait(5)
		tb(6070)
		jig npc(10)
		tb(6071)
		wait(10)
		set npc direction(10,right)
		wait(10)
		tb(6072)
		wait(10)
		tb(6073)
		jig npc(10)
		tb(6074)
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:displaytext,6075)
		set tag(413,1)
	)

	#special case to the below, still inside
		if(check tag(410),and,check tag(411)==false,and,currentmap<<50) then(
		jig npc(10)
		tb(6052)
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:displaytext,6052)
		alter npc(10,NPCstat:whenactivated,npcwhenactivated:donotfaceplayer)
	)

	#Tag 412 - locked door
		if(check tag(410),and,check tag(411)==false,and,currentmap>>52) then(
		show text box(84)
		walk hero(0,down,1)
		set hero direction(0,up)
		wait for hero(0)
		wait for text box
		jig hero(0)
		tb(6053)
		set tag(412,1)
	)

	#Tag 410 - Ten locks himself inside, need key
	if(check tag(407),and,check tag(409),and,check tag(410)==false) then(
		jig hero(0)
		tb(6027)
		jig npc(10)
		tb(6031)
		jig npc(10)
		tb(6032)
		tb(6033)
		jig npc(10)
		tb(6034)
		jig hero(0)
		tb(6035)
		jig npc(10)
		tb(6039)
		jig hero(0)
		tb(6040)
		jig npc(10)
		tb(6044)
		jig hero(0)
		tb(6045)
		jig npc(10)
		tb(6049)
		wait(2)
		set npc direction(10,right)
		wait(2)
		tb(6050)
		jig npc(10)
		tb(6051)
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:displaytext,6052)
		alter npc(10,NPCstat:whenactivated,npcwhenactivated:donotfaceplayer)
		set tag(410,1)
	)

	#before asking sparra
	if(check tag(407),and,check tag(409)==false) then(
		jig npc(10)
		tb(6008)
	)

	#Tag 407 - Ten wants you to ask Sparra
	if(check tag(406),and,check tag(407)==false) then(
		jig npc(10)
		tb(6000)
		jig hero(0)
		tb(6001)
		jig npc(10)
		tb(6005)
		jig npc(10)
		tb(6006)
		tb(6007)
		jig npc(10)
		tb(6008)
		set tag(407,1)
	)

	#Tag 406 - Ten init
	if(check tag(406)==false) then(
		teleport to map(41+poff,5,136)
		wait(1)
		palin(1)
		alter npc(10,NPCstat:movespeed,5)
		walk hero(0,up,1)
		wait for hero(0)
		walk npc(10,down,1)
		wait for npc(10)
		set npc frame(10,0)
		set npc direction(10,right)
		jig npc(10)
		stop song
		show text box(5991)
		wait(2)
		set hero direction(0,left)
		wait for text box
		walk npc(10,right,2)
		wait for npc(10)
		set npc frame(10,0)
		jig npc(10)
		tb(5992)
		jig hero(0)
		tb(5993)
		wait(5)
		set npc frame(10,1)
		wait(3)
		set npc frame(10,0)
		wait(3)
		tb(5997)
		tb(5998)
		alter npc(10,NPCstat:movespeed,2)
		walk npc(10,left,2)
		wait(3)
		show text box(5999)
		wait for npc(10)
		walk npc(10,up,1)
		wait for npc(10)
		set npc frame(10,0)
		set npc direction(10,right)
		wait for text box
		alter npc(10,NPCstat:script,0)
		alter npc(10,NPCstat:displaytext,5999)
		set tag(406,1)
		if(check tag(6)) then(play song(4))
		else(play song(77))
	)
end
###
################################
script, worldending5, num, begin
	#Tag 423 - Quest OVER!
	if(check tag(423)) then(
		if(num==8) then(
				jig npc(8)
				tb(6109)
		)
		if(num==10) then(tb(6111))
	)

	#inbetween
	if(check tag(410),and,check tag(411),and,check tag(423)==false) then(
		jig npc(8)
		tb(6061)
	)

	#Tag 411 - get ten key
	if(check tag(410),and,check tag(412),and,check tag(411)==false) then(
		jig npc(8)
		tb(6057)
		tb(6058)
		wait(2)
		tb(6059)
		get item(74,1)
		wait(2)
		jig npc(8)
		tb(6060)
		set tag(411,1)
	)

	#inbetween
	if(check tag(408),and,check tag(407),and,check tag(409),and,check tag(412)==false) then(
		jig npc(8)
		tb(6024)
	)

	#Tag 409 - Sparra responds to Ten
	if(check tag(408),and,check tag(407),and,check tag(409)==false) then(
		jig hero(0)
		tb(6017)
		jig npc(8)
		tb(6021)
		tb(6022)
		jig npc(8)
		tb(6023)
		set tag(409,1)
	)

	#inbetween
	if(check tag(408),and,check tag(407)==false) then(
		jig npc(8)
		tb(6918)
	)

	#Tag 408 - Sparra init
	if(check tag(408)==false) then(
		teleport to map(49+poff,6,134)
		wait(1)
		palin(1)
		wait(1)
		walk hero(0,up,1)
		wait for hero(0)
		set npc direction(8,down)
		wait(10)
		walk npc(8,down,2)
		wait for npc(8)
		walk npc to x(8,herox(0))
		wait for npc(8)
		set npc direction(8,down)
		set npc frame(8,0)
		jig npc(8)
		tb(6009)
		jig npc(npc at spot(7,129))
		tb(6010)
		jig hero(0)
		tb(6011)
		jig npc(npc at spot(7,129))
		tb(6015)
		jig npc(8)
		tb(6016)
		set tag(408,1)
	)
end
###

#######################
script, mazinggo, begin
suspend player
suspend npcs
suspend obstruction

#finished text
if(check tag(463),and,(inventory(20)==0,or,inventory(21)==0,or,inventory(22)==0,or,inventory(23)==0)) then(zing5)

#jade sword
if(check tag(463),and,(inventory(20)==1,and,inventory(21)==1,and,inventory(22)==1,and,inventory(23)==1)) then(zing4)

#upgrade weapons finished
if(check tag(460),and,day--amazing>=3,and,check tag(463)==false) then(zing3)

#closed for weapons
if(check tag(460),and,day--amazing<<3,and,check tag(463)==false) then(
walk hero(0,down,1)
set hero direction(0,up)
tb(6162)
wait for hero(0)
)

#upgrade weapons
#init
if(check tag(459),and,check tag(174),and,check tag(460)==false) then(zing2)

#after init, but do not have winter clothing
if(check tag(459),and,check tag(174)==false) then(
jig npc(13)
tb(7760)
tb(7761)
)

#init
if(check tag(459)==false) then(zing1)

resume obstruction
resume npcs
resume player
end
###

####################
script, zing1, begin
set tag(459,1)

palout(1)
teleport to map(41+poff,5,121)
stop song
pan camera(south,0,0)
alter npc(13,NPCstat:picture,140)
set npc position(13,5,114)
set npc direction(13,down)
alter npc(13,NPCstat:whenactivated,npcwhenactivated:donotfaceplayer)
alter npc(13,NPCstat:movespeed,2)
wait(1)
set hero position(0,0,0)
wait(1)
palin(1)

wait(10)
set hero position(0,4,121)
walk hero(0,up,3)
wait for hero(0)
walk hero(0,right,1)
wait for hero(0)
set hero direction(0,up)
wait(5)
pan camera(up,4,4)
walk npc(13,down,2)
wait for npc(13)
set npc frame(13,0)
wait for camera

jig npc(13)
tb(6115)
play song(82)

hero clothes
set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,up)

wait(5)
jig hero(0)
tb(6116)
jig npc(13)
tb(6117)
walk npc(13,down,1)
wait(2)
set npc direction(2,right)
wait(1)
set npc direction(1,left)
wait for npc(13)
set npc frame(13,0)
wait(2)
set npc frame(13,1)
wait(2)
set hero frame(0,1)
wait(2)
set npc frame(13,0)
wait(2)
set hero frame(0,0)
wait(2)
tb(6118)
get money(300)
wait(2)
jig npc(1)
tb(6119)
wait(3)
set npc direction(13,left)
wait(2)
show text box(6120)
wait(3)
walk npc(13,up,1)
wait(2)
set npc direction(1,up)
set npc direction(2,up)
wait for npc(13)
set npc frame(13,0)
set npc direction(13,right)
wait(2)
set npc direction(13,down)
wait for text box
tb(6121)
jig npc(2)
tb(6122)
jig npc(13)
tb(6123)
jig npc(2)
tb(6124)
show text box(6125)
alter npc(13,NPCstat:movespeed,5)
wait(1)
walk npc(13,left,1)
wait for npc(13)
walk npc(13,down,1)
wait for npc(13)
wait for text box
set npc frame(13,1)
wait(2)
set npc frame(2,1)
wait(2)
set npc frame(13,0)
wait(2)
set npc frame(2,0)
set npc direction(13,left)
jig npc(13)
tb(6126)
wait(10)
jig npc(2)
show text box(6127)
wait(2)
set npc direction(13,down)
wait for text box
set npc direction(1,left)
jig npc(1)
tb(6128)
jig npc(2)
tb(6129)
jig npc(13)
tb(6130)
jig hero(0)
tb(6131)
jig npc(13)
tb(6132)
jig npc(2)
show text box(6133)

set hero speed(0,4)
set npc direction(3,right)
wait(1)
set npc direction(1,left)
wait(1)
set hero direction(0,right)
stop song
walk npc(3,down,1)
wait for npc(3)
walk hero(0,down,2)
walk npc(1,left,1)
walk npc(3,left,1)
wait for npc(3)
walk npc(3,down,1)
walk npc(1,down,1)
wait for npc(3)
set npc position(3,0,0)
wait for hero(0)
walk hero(0,left,1)
walk npc(1,down,1)
wait for hero(0)
walk hero(0,down,1)
walk npc(1,left,1)
wait for hero(0)
set hero position(0,0,0)
walk npc(1,down,1)
wait for npc(1)
set npc position(1,0,0)

wait for text box
jig npc(13)
tb(6134)
jig npc(2)
tb(6135)
jig npc(13)
tb(6136)
jig npc(2)
tb(6137)
jig npc(13)
tb(6138)
show text box(6139)
alter npc(2,NPCstat:movespeed,2)
set npc direction(2,right)
wait(1)
set npc direction(2,down)
wait(1)
set npc direction(2,left)
wait(1)
set npc direction(2,up)
wait(1)
walk npc(2,down,1)
set npc direction(2,right)
wait(1)
set npc direction(2,down)
wait(1)
set npc direction(2,left)
wait(1)
set npc direction(2,up)
wait for npc(2)
alter npc(2,NPCstat:movespeed,5)
walk npc(2,down,2)
wait for npc(2)
set npc position(2,0,0)
wait for text box
jig npc(13)
tb(6140)

palout(1)
camera follows hero(0)
teleport to map(53+poff,30,51)
stop song
wait(1)
set npc position(5,35,52)
set npc direction(5,left)
pan camera(south,0,0)
hero clothes
set hero position(0,29,51)
set npc position(1,30,52)
set npc position(3,31,51)
set hero frame(0,0)
set hero direction(0,right)
set npc direction(1,up)
set npc direction(3,left)
wait(1)
palin(3)

wait(15)
set npc position(2,30,49)
walk npc(2,down,1)
wait for npc(2)
set npc frame(2,0)
jig npc(1)
play song(84)
tb(6141)
jig npc(2)
show text box(6142)
wait(2)
set hero direction(0,down)
wait(2)
set npc direction(3,down)
wait for text box
jig hero(0)
tb(6143)
jig npc(3)
tb(6144)
jig npc(1)
tb(6145)
jig npc(2)
tb(6146)
jig npc(1)
tb(6147)
jig hero(0)
show text box(6148)
wait(2)
set hero direction(0,right)
wait(2)
set npc direction(3,left)
wait for text box
wait(2)

walk hero(0,right,1)
walk npc(1,up,1)
walk npc(2,down,1)
walk npc(3,left,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
set npc position(1,0,0)
wait for npc(2)
set npc position(2,0,0)
wait for npc(3)
set npc position(3,0,0)
set hero direction(0,down)
set party in

set hero speed(0,hspeed)
camera follows hero(0)
end
###
####################
script, zing2, begin
if(check tag(462)) then(
jig npc(13)
tb(6157)
)
else(
set tag(462,1)
jig npc(13)
tb(6149)
stop song
focus camera(5,115,2)
set hero speed(0,2)
walk hero to y(0,115)
wait for hero(0)
set npc direction(13,down)
walk hero to x(0,5)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,up)
camera follows hero(0)
set hero speed(0,hspeed)
hero clothes
pdown
jig hero(0)
tb(6150)
jig npc(13)
tb(6151)
play song(82)
tb(6152)
jig npc(13)
tb(6153)
jig npc(2)
tb(6154)
set npc direction(3,right)
wait(2)
set npc direction(3,down)
jig npc(3)
tb(6155)
jig npc(13)
tb(6156)
)

#if have refined ore
if(check tag(381)) then(
stop song
hero clothes
if(check tag(462),and,npcx(1)==0) then(
	focus camera(5,115,2)
	set hero speed(0,2)
	walk hero to y(0,115)
	wait for hero(0)
	set npc direction(13,down)
	walk hero to x(0,5)
	wait for hero(0)
	set hero frame(0,0)
	set hero direction(0,up)
	camera follows hero(0)
	set hero speed(0,hspeed)
	pdown
)
jig hero(0)
tb(6158)
jig npc(13)
show text box(6159)
wait(2)
set npc direction(13,up)
wait for text box
jig hero(0)
tb(6160)
jig npc(13)
tb(6161)
wait(2)
palout(1)
teleport to map(53+poff,30,50)
stop song
set hero direction(0,down)
palin(3)
play song(69)
set tag(460,1)
set variable(amazing,day)
delete item(19)
)
else(ppdown)
end
###
####################
script, zing3, begin
stop song
palout(1)
teleport to map(41+poff,6,115)
stop song
pan camera(south,0,0)
wait(1)
set hero position(0,0,0)
alter npc(13,NPCstat:picture,140)
set npc position(13,5,114)
set hero position(0,4,116)
set npc position(1,5,116)
set npc position(3,6,116)
set npc position(2,7,116)
set npc direction(13,up)
set hero direction(0,up)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
hero clothes
set party out
swap by position(find hero(0),0)
alter npc(13,NPCstat:script,0)
alter npc(13,NPCstat:displaytext,6180)
alter npc(13,NPCstat:whenactivated,npcwhenactivated:changedirection)
alter npc(13,NPCstat:movespeed,1)
wait(1)
palin(5)

wait(5)
set npc direction(13,right)
wait(1)
set npc direction(13,down)
jig npc(13)
play song(82)
tb(6163)
walk npc(13,left,1)
wait for npc(13)
walk npc(13,down,1)
wait for npc(13)
set npc frame(13,0)
jig npc(13)
tb(6164)
tb(6165)
wait(3)
set npc frame(13,1)
wait(2)
set hero frame(0,1)
wait(2)
set npc frame(13,0)
wait(2)
set hero frame(0,0)
tb(6166)
set default weapon(find hero(0),33)
set hero picture(find hero(0),10,insidebattle)
get item(32,1)
wait(2)
jig hero(0)
tb(6167)
wait(5)

walk npc(13,right,1)
wait for npc(13)
set npc frame(13,0)
set npc direction(13,down)
jig npc(13)
tb(6168)
tb(6169)
wait(3)
set npc frame(13,1)
wait(2)
set npc frame(1,1)
wait(2)
set npc frame(13,0)
wait(2)
set npc frame(1,0)
tb(6170)
set default weapon(find hero(1),38)
set hero picture(find hero(1),19,insidebattle)
get item(37,1)
wait(2)
jig npc(1)
tb(6171)
wait(5)

walk npc(13,right,1)
wait for npc(13)
set npc frame(13,0)
set npc direction(13,down)
jig npc(13)
tb(6172)
tb(6173)
wait(3)
set npc frame(13,1)
wait(2)
set npc frame(3,1)
wait(2)
set npc frame(13,0)
wait(2)
set npc frame(3,0)
tb(6174)
set default weapon(find hero(3),44)
set hero picture(find hero(3),25,insidebattle)
get item(43,1)
wait(2)
jig npc(3)
tb(6175)
wait(5)

walk npc(13,right,1)
wait for npc(13)
set npc frame(13,0)
set npc direction(13,down)
wait(20)
jig npc(13)
tb(6176)
wait(3)
set npc frame(13,1)
wait(2)
set npc frame(2,1)
wait(2)
set npc frame(13,0)
wait(2)
set npc frame(2,0)
tb(6177)
set default weapon(find hero(2),41)
set hero picture(find hero(2),22,insidebattle)
get item(40,1)
wait(2)
jig npc(2)
tb(6178)
jig npc(13)
tb(6179)

wait(2)
focus camera(7,116,2)
set hero speed(0,4)
wait(3)
walk hero(0,right,1)
walk npc(1,right,1)
walk npc(3,right,1)
wait for hero(0)
walk hero(0,right,1)
walk npc(1,right,1)
set npc position(3,0,0)
wait for hero(0)
walk hero(0,right,1)
set npc position(1,0,0)
wait for hero(0)
set hero frame(0,0)
set npc position(2,0,0)
set hero direction(0,up)

set party in
wait for camera
camera follows hero(0)
set hero speed(0,hspeed)

set tag(463,1)
end
###
####################
script, zing4, begin
delete item(20,1)
delete item(21,1)
delete item(22,1)
delete item(23,1)

stop song

set hero speed(0,4)
focus camera(5,115,2)
walk hero to y(0,115)
wait for hero(0)
walk hero to x(0,5)
set npc direction(13,down)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,up)
wait for camera

heroclothes
pdown

jig hero(0)
tb(6181)
jig npc(13)
tb(6182)
wait(3)
set hero frame(0,1)
wait(2)
set npc frame(13,1)
wait(2)
set hero frame(0,0)
wait(2)
set npc frame(13,0)
wait(5)
jig npc(13)
play song(91)
tb(6183)
wait(15)
jig hero(0)
tb(6184)
jig npc(13)
show text box(6185)
wait(2)
set npc direction(13,right)
wait(2)
set npc direction(13,up)
wait for text box

palout(1)
variable(nextmap)
set variable(nextmap,41+poff+1)
if(nextmap==45) then(set variable(nextmap,41))
camera follows hero(0)
teleport to map(nextmap,6,116)
stop song
wait(1)
pan camera(south,0,0)
#set variable(nextmap,1+poff)
#if(nextmap==5) then(set variable(nextmap,1))
#set hero palette(0,nextmap)
#noon
if(current map==41) then(
set tag(3,0)
set tag(4,1)
set tag(5,0)
set tag(6,0)
set hero palette(0,1)
alter npc(4,NPCstat:palette,117)
)
#afternoon
if(current map==42) then(
set tag(3,0)
set tag(4,0)
set tag(5,1)
set tag(6,0)
set hero palette(0,2)
alter npc(4,NPCstat:palette,118)
)
#night
if(current map==43) then(
set tag(3,0)
set tag(4,0)
set tag(5,0)
set tag(6,1)
set hero palette(0,3)
alter npc(4,NPCstat:palette,119)
)
#morning
if(current map==44) then(
set tag(3,1)
set tag(4,0)
set tag(5,0)
set tag(6,0)
set hero palette(0,4)
alter npc(4,NPCstat:palette,120)
)
alter npc(4,NPCstat:picture,139)
hero clothes
alter npc(13,NPCstat:picture,140)
alter npc(13,NPCstat:movespeed,2)
set hero position(0,6,118)
set npc position(1,11,115)
set npc position(2,8,114)
set npc position(3,2,117)
set npc position(13,5,114)
set hero picture(0,397)
set hero direction(0,right)
set npc direction(1,right)
set npc direction(2,left)
set npc direction(3,left)
set npc direction(13,up)
wait(1)
palin(15)

play song(17)

alter npc(13,NPCstat:movespeed,2)
alter npc(4,NPCstat:movespeed,1)

suspend npc walls
wait(5)
jig npc(13)
wait(2)
set npc direction(13,right)
wait(2)
walk npc(13,right,1)
wait for npc(13)
set npc frame(13,0)
wait(5)
set npc frame(13,1)
set npc position(4,npcx(13),npcy(13))
walk npc(4,right,1)
set npc direction(4,down)
wait(2)
set npc frame(13,0)
wait for npc(4)
wait(15)

variable(i)
for(i,1,4,1) do(
set npc frame(13,1)
wait(2)
play song(8)
show backdrop(46)
set npc frame(13,0)
wait(2)
stop song
show map
wait(7)
set npc frame(2,1)
wait(2)
play song(8)
show backdrop(46)
set npc frame(2,0)
wait(2)
stop song
show map
wait(15)
)

play song(17)

alter npc(2,NPCstat:movespeed,4)
walk npc(2,down,1)
wait for npc(2)
walk npc(2,left,3)
wait for npc(2)
walk npc(2,up,1)
wait for npc(2)
set npc frame(2,0)
wait(2)
set npc direction(2,right)
wait(10)
walk npc(4,left,1)
set npc direction(4,down)
wait for npc(4)
set npc position(4,0,0)
wait(4)
set npc direction(13,up)
wait(4)
set npc direction(13,left)
wait(2)
set npc frame(13,1)
wait(2)
set npc frame(2,1)
wait(2)
set npc frame(13,0)
wait(2)
set npc frame(2,0)
wait(4)
set npc direction(2,up)
wait(10)
jig npc(2)
set npc position(4,npcx(2),npcy(2))
walk npc(4,up,1)
set npc direction(4,down)
wait(2)
set npc direction(13,up)
wait for npc(4)
wait(15)
alter npc(3,NPCstat:movespeed,2)
set npc direction(3,down)
wait(3)
set npc direction(3,right)
wait(3)
walk npc(3,right,3)
wait for npc(3)
set npc frame(3,0)
wait(10)
set npc direction(3,up)
resume npc walls
wait(15)

palout(15)
set variable(nextmap,41+poff+1)
if(nextmap==45) then(set variable(nextmap,41))
set variable(nextmap,nextmap+1)
if(nextmap==45) then(set variable(nextmap,41))
camera follows hero(0)
teleport to map(nextmap,6,116)
play song(17)
wait(1)
#set variable(nextmap,1+poff)
#if(nextmap==5) then(set variable(nextmap,1))
#set variable(nextmap,nextmap+1)
#if(nextmap==5) then(set variable(nextmap,1))
#set hero palette(0,nextmap)
#noon
if(current map==41) then(
set tag(3,0)
set tag(4,1)
set tag(5,0)
set tag(6,0)
set hero palette(0,1)
alter npc(4,NPCstat:palette,117)
)
#afternoon
if(current map==42) then(
set tag(3,0)
set tag(4,0)
set tag(5,1)
set tag(6,0)
set hero palette(0,2)
alter npc(4,NPCstat:palette,118)
)
#night
if(current map==43) then(
set tag(3,0)
set tag(4,0)
set tag(5,0)
set tag(6,1)
set hero palette(0,3)
alter npc(4,NPCstat:palette,119)
)
#morning
if(current map==44) then(
set tag(3,1)
set tag(4,0)
set tag(5,0)
set tag(6,0)
set hero palette(0,4)
alter npc(4,NPCstat:palette,120)
)
hero clothes
alter npc(13,NPCstat:picture,140)
alter npc(13,NPCstat:movespeed,2)
set hero position(0,6,118)
set npc position(1,7,117)
set npc position(2,4,114)
set npc position(3,5,117)
set npc position(13,5,114)
set hero picture(0,397)
set hero direction(0,right)
alter npc(1,NPCstat:picture,407)
set npc direction(1,down)
set npc direction(2,right)
alter npc(3,NPCstat:picture,405)
set npc direction(3,right)
set npc direction(13,up)
alter npc(4,NPCstat:picture,139)
wait(1)
palin(10)

wait(15)
jig npc(13)
tb(6186)
play song(92)
wait(2)
set npc direction(2,right)
set hero picture(0,230)
set hero direction(0,up)
wait(2)
alter npc(1,NPCstat:picture,233)
set npc direction(1,up)
wait(2)
alter npc(3,NPCstat:picture,236)
wait(2)
set npc direction(3,up)
focus camera(5,115,2)
wait(2)
set hero speed(0,2)
walk hero(0,left,2)
wait for hero(0)
walk hero(0,up,2)
wait for hero(0)
walk hero(0,right,1)
wait for hero(0)
walk hero(0,up,1)
set npc direction(2,down)
set npc direction(13,left)
wait for hero(0)
set hero frame(0,0)
set npc direction(13,down)
wait for camera
wait(10)
set npc frame(13,1)
wait(3)
set npc frame(13,0)
wait(2)
tb(6187)
alter npc(4,NPCstat:picture,139)
alter npc(4,NPCstat:palette,117+nextmap--1)
alter npc(4,NPCstat:movespeed,1)
set npc direction(4,down)
set npc position(4,5,114)
walk npc(4,down,1)
wait for npc(4)
fade screen out(0,63,0)
set npc position(4,0,0)
get item(34,1)
wait(1)
fade screen in
alter npc(1,NPCstat:movespeed,4)
alter npc(2,NPCstat:movespeed,4)
alter npc(3,NPCstat:movespeed,4)
wait(2)
walk npc(2,down,1)
walk npc(3,up,1)
walk npc(1,up,2)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,right)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,up)
wait for npc(1)
walk npc(1,left,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,left)
wait(20)
jig npc(3)
tb(6188)
jig npc(1)
tb(6189)
jig hero(0)
tb(6190)
tb(6191)
jig npc(13)
tb(6192)
jig hero(0)
tb(6193)
jig npc(13)
tb(6194)
jig hero(0)
show text box(6195)
set hero picture(0,396)
wait(2)
set hero direction(0,right)
wait(2)
set hero direction(0,down)
wait for text box
tb(6196)

alter npc(13,NPCstat:script,0)
alter npc(13,NPCstat:displaytext,6197)
alter npc(13,NPCstat:whenactivated,npcwhenactivated:changedirection)

#noon
if(currentmap==41) then(
set tag(3,0)
set tag(4,1)
set tag(5,0)
set tag(6,0)
set variable(hour,noontime)
)

#afternoon
if(currentmap==42) then(
set tag(3,0)
set tag(4,0)
set tag(5,1)
set tag(6,0)
set variable(hour,afternoontime)
)

#night
if(currentmap==43) then(
set tag(3,0)
set tag(4,0)
set tag(5,0)
set tag(6,1)
set variable(hour,nighttime)
)

#morning
if(currentmap==44) then(
set tag(3,1)
set tag(4,0)
set tag(5,0)
set tag(6,0)
set variable(hour,morningtime)
)

walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for npc(1)
set npc position(1,0,0)
wait for npc(2)
set npc position(2,0,0)
wait for npc(3)
set npc position(3,0,0)
set hero picture(0,230)
set party in
camera follows hero(0)
set hero speed(0,hspeed)

end
###
####################
script, zing5, begin
if(check tag(19)) then(
jig npc(13)
tb(6198)
jig hero(0)
tb(6199)
jig npc(13)
tb(6200)
)
if(check tag(20)) then(
jig npc(13)
tb(6198)
jig hero(0)
tb(6201)
jig npc(13)
tb(6202)
)
if(check tag(22)) then(
jig npc(13)
tb(6198)
jig hero(0)
tb(6203)
jig npc(13)
tb(6204)
)
if(check tag(21)) then(
if(check tag(464),and,check tag(465)) then(
jig npc(13)
tb(6210)
jig hero(0)
tb(6211)
jig npc(13)
tb(6212)
set tag
)
if(check tag(464),and,check tag(465)==false) then(
jig npc(13)
tb(6208)
jig hero(0)
tb(6209)
)
if(check tag(464)==false,and,check tag(465)==false) then(
jig npc(13)
tb(6205)
jig hero(0)
tb(6206)
jig npc(13)
tb(6207)
)


if(check tag(464)==false) then(
	set tag(464,1)
)
else(
	if(check tag(465)==false) then(
		set tag(465,1)
	)
	else(
		set tag(464,0)
		set tag(465,0)
	)
)

)
end
###

#########################
script, gamblegame, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
variable(i)
variable(n)
set variable(n,8)

#game
set npc direction(n,right)
tb(6213)
tb(6214)

if(check tag(258)) then(
	if(pay money(1)) then(
		if(check tag(466),and,check tag(467)) then(
			set npc direction(n,up)
			for(i,1,6,1) do(
				set npc frame(n,1)
				wait(1)
				set npc frame(n,0)
				wait(1)
			)
			for(i,1,3,1) do(
				set npc frame(n,1)
				wait(2)
				set npc frame(n,0)
				wait(2)
			)
			tb(6218)
		)
		if(check tag(466),and,check tag(467)==false) then(
			set npc direction(n,up)
			for(i,1,3,1) do(
				set npc frame(n,1)
				wait(1)
				set npc frame(n,0)
				wait(1)
			)
			for(i,1,2,1) do(
				set npc frame(n,1)
				wait(2)
				set npc frame(n,0)
				wait(2)
			)
			tb(6217)
			set npc direction(n,down)
			set tag(467,1)
		)
		if(check tag(466)==false) then(
			set npc direction(n,down)
			tb(6215)
			set tag(466,1)
		)
	)
	else(
		set npc direction(n,down)
		tb(6216)
	)
)
else(set npc direction(n,down))

resume obstruction
resume npcs
resume player
end
###

########################
script, falsejade, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#bought into the scam
if(check tag(468)) then(
jig npc(14)
tb(6232)
if(check tag(258)) then(
if(pay money(10)) then(
wait(2)
tb(6231)
jig npc(14)
tb(6233)
wait(2)
palout(1)
set npc position(14,0,0)
wait(1)
palin(1)
)
else(
jig npc(14)
tb(6945)
)
)
else(
jig npc(14)
tb(6234)
jig hero(0)
tb(6235)
jig npc(14)
set npc direction(14,up)
jig npc(14)
tb(6239)
)
)

#have not bought into the scame
else(
jig npc(14)
tb(6219)
if(check tag(258)) then(
if(paymoney(10)) then(
jig hero(0)
tb(6225)
jig npc(14)
jig npc(14)
jig npc(14)
tb(6229)
jig npc(14)
tb(6230)
wait(3)
tb(6231)
wait(3)
palout(1)
set npc position(14,0,0)
wait(1)
palin(1)
set tag(468,1)
)
else(
jig npc(14)
tb(6945)
)
)
else(
jig hero(0)
tb(6220)
set npc direction(14,up)
jig npc(14)
tb(6224)
)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, lootcyport, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#have read bounty
if(check tag(469),and,check tag(470)==false,and,check tag(447)) then( lootcyport1 )

#have collected all
if(check tag(447)==false,and,check tag(469),and,check tag(470)==false,and,(inventory(77)>>0,and,inventory(78)>>0,and,inventory(79)>>0)) then( lootcyport2 )

#have not collected all
if(check tag(447)==false,and,check tag(469),and,check tag(470)==false,and,(inventory(77)==0,or,inventory(78)==0,or,inventory(79)==0)) then(
jig npc(5)
tb(6252)
)

#initialize systems, go go go
if(check tag(469)==false) then( lootcyport3 )

resume obstruction
resume npcs
resume player
end
###

##########################
script, lootcyport1, begin
jig npc(5)
tb(6269)
if(check tag(258)) then(
stop song
jig hero(0)
tb(6270)

palout(3)
teleport to map(45+poff,9,6)
stop song
wait(1)
hero clothes
pan camera(south,0,0)
set party out
swap by position(find hero(0),0)
set hero position(0,9,8)
set npc position(1,10,9)
set npc position(2,9,9)
set npc position(3,8,9)
set hero direction(0,up)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
wait(1)
palin(6)

wait(6)
set npc direction(10,left)
wait(2)
set npc direction(10,down)
wait(2)
jig npc(10)
play song(61)
tb(6274)
jig hero(0)
tb(6275)
jig npc(10)
tb(6276)
jig hero(0)
stop song
tb(6277)
wait(15)
tb(6278)
walk npc(10,down,1)
wait for npc(10)
set npc frame(10,0)
show text box(6279)
jig npc(10)
wait for text box
jig hero(0)
tb(6280)
jig npc(10)
tb(6281)

battleflash
set tag(470,1)
set tag(448,1)
set party in
ff(275+poff)
stop song
set party out
swap by position(find hero(0),0)
wait(3)

palout(1)
camera follows hero(0)
set party in
teleport to map(41+poff,19,28)
stop song
wait(1)
palin(3)

wait(5)
jig npc(npc at spot(19,26))
tb(6282)
jig npc(npc at spot(19,26))
tb(6283)
wait(3)
tb(6284)
get money(200)
delete item(80,1)
set tag(483,1)
set tag(484,1)
set tag(485,1)
wait(3)
jadeup(6,1)
wait(3)
play song(82)
)
end
###
##########################
script, lootcyport2, begin
jig npc(5)
tb(6253)

if(check tag(258)) then(
stop song
palout(3)
teleport to map(45+poff,9,6)
stop song
wait(1)
hero clothes
pan camera(south,0,0)
set party out
swap by position(find hero(0),0)
set hero position(0,9,8)
set npc position(1,10,9)
set npc position(2,9,9)
set npc position(3,8,9)
set hero direction(0,up)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
wait(1)
palin(6)

wait(6)
set npc direction(10,left)
wait(2)
set npc direction(10,down)
wait(2)
play song(61)
tb(6254)
jig npc(10)
tb(6255)
jig hero(0)
tb(6256)
jig npc(10)
tb(6257)
delete item(80,1)
delete item(77,1)
delete item(78,1)
delete item(79,1)
walk npc(9,down,1)
wait for npc(9)
walk npc(9,right,1)
wait(2)
set hero direction(0,left)
wait for npc(9)
set npc frame(9,0)
wait(2)
set hero frame(0,1)
wait(2)
set npc frame(9,1)
wait(2)
set hero frame(0,0)
wait(2)
set npc frame(9,0)
wait(2)
walk npc(9,up,2)
wait(4)
set npc direction(10,left)
wait(2)
set hero direction(0,up)
wait for npc(9)
set npc frame(9,0)
set npc direction(9,right)
wait(2)
set npc frame(9,1)
wait(2)
set npc frame(10,1)
wait(2)
set npc frame(9,0)
wait(2)
set npc frame(10,0)
wait(2)
walk npc(9,down,1)
wait for npc(9)
walk npc(9,left,1)
wait for npc(9)
set npc frame(9,0)
set npc direction(9,down)
wait(5)
jig npc(10)
show text box(6258)
wait(3)
set npc direction(10,down)
wait for text box
jig npc(10)
tb(6259)
jig hero(0)
stop song
tb(6260)
jig npc(10)
tb(6261)
tb(6262)
jig npc(10)
tb(6263)
tb(6264)
battleflash
set tag(470,1)
set party in
ff(279+poff)
stop song
set party out
swap by position(find hero(0),0)
wait(10)
jig npc(2)
show text box(6265)
wait(2)
set npc direction(1,left)
wait(2)
set npc direction(3,right)
wait for text box
jig npc(1)
tb(6266)
set npc direction(2,right)
jig npc(2)
tb(6947)
jig npc(3)
tb(6267)
wait(15)
tb(6268)

wait(3)
palout(6)
camera follows hero(0)
teleport to map(37+poff,58,17)
set party in
wait(1)
palin(3)
)
end
###
##########################
script, lootcyport3, begin
palout(1)
set tag(469,1)
teleport to map(37+poff,61,17)
stop song
palin(1)

walk npc(5,down,1)
wait for npc(5)
walk npc(5,right,2)
wait(2)
set hero direction(0,left)
wait for npc(5)

jig npc(5)
tb(6240)
tb(6241)

palout(3)
teleport to map(45+poff,9,6)
stop song
wait(1)
hero clothes
pan camera(south,0,0)
set party out
swap by position(find hero(0),0)
set hero position(0,9,8)
set npc position(1,10,9)
set npc position(2,9,9)
set npc position(3,8,9)
set hero direction(0,up)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
wait(1)
palin(6)

wait(6)
set npc direction(10,left)
wait(2)
set npc direction(10,down)
wait(3)
jig npc(10)
play song(61)
tb(6242)
tb(6243)
jig hero(0)
tb(6244)
jig npc(10)
tb(6245)
tb(6246)
jig npc(10)
tb(6247)
wait(2)
set npc direction(10,left)
jig npc(10)
walk npc(9,down,1)
wait(2)
set npc direction(10,down)
wait for npc(9)
walk npc(9,right,1)
wait(2)
set hero direction(0,left)
wait for npc(9)
set npc frame(9,0)
wait(2)
set npc frame(9,1)
wait(2)
set hero frame(0,1)
wait(2)
set npc frame(9,0)
wait(2)
set hero frame(0,0)
set npc direction(9,up)
show text box(6248)
get item(80,1)
wait(2)
walk npc(9,left,1)
wait for npc(9)
walk npc(9,up,1)
wait for npc(9)
set npc frame(9,0)
set npc direction(9,right)
wait(2)
set npc direction(9,down)
wait for text box
jig npc(10)
show text box(6249)
wait(3)
set hero direction(0,up)
wait for text box
tb(6946)
jig npc(10)
tb(6250)
stop song
show text box(6251)
wait(5)
set npc direction(10,left)
wait(2)
set npc direction(10,up)
wait for text box
wait(3)

palout(6)
camera follows hero(0)
teleport to map(37+poff,58,17)
set party in
wait(1)
palin(3)
end
###

#################################
script, etcetera, whichone, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

if(whichone==1) then(
	jig npc(13)
	tb(6285)
	if(check tag(258)) then(
		if(pay money(1)) then(
		wait(3)
		tb(6286)
		jig npc(13)
		tb(6287)
		)
	)
	else(
		jig npc(13)
		tb(6288)
	)
)
if(whichone==2) then(
	jig npc(12)
	tb(6289)
	if(check tag(258)) then(
		if(pay money(1)) then(
		wait(3)
		tb(6290)
		jig npc(12)
		tb(6291)
		)
	)
	else(
		jig npc(12)
		tb(6292)
	)
)
if(whichone==3) then(
	jig npc(14)
	tb(6293)
	tb(6294)
	if(check tag(258)) then(
		if(pay money(1)) then(
		wait(3)
		tb(6295)
		jig npc(14)
		tb(6296)
		)
	)
	else(
		jig npc(14)
		tb(6297)
	)
)
if(whichone==4) then(
if(check tag(471)) then(
jig npc(15)
tb(6305)
tb(6306)
)
else(
	jig npc(15)
	tb(6298)
	if(check tag(258)) then(
		if(pay money(1)) then(
		tb(6299)
		jig npc(15)
		tb(6300)
		)
	)
	else(
		set tag(258,0)
		jig npc(15)
		tb(6301)
		tb(6302)
		jig npc(15)
		tb(6303)
		if(check tag(258)) then(
			if(pay money(1)) then(
			tb(6299)
			jig npc(15)
			tb(6300)
			)
		)
		else(
			jig npc(15)
			play song(15)
			tb(6304)
			battleflash
			ff(585+poff)
			set tag(471,1)
		)
	)
)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, wanderingjoke, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

if(check tag(472)) then(
	jig npc(13)
	tb(6949)
)
else(
	jig npc(13)
	tb(6307)
	if(check tag(258)) then(
		set tag(258,0)
		jig npc(13)
		tb(6308)
		if(check tag(258)) then(
			set tag(258,0)
			jig npc(13)
			stop song
			tb(6309)
			if(check tag(258)) then(
jig npc(13)
tb(6310)
palout(1)
show backdrop(0)
wait(1)
palin(1)
play song(80)
wait(10)
tb(6311)
wait(3)
tb(6312)
wait(3)
tb(6313)
wait(3)
tb(6314)
wait(3)
tb(6315)
wait(3)
tb(6316)
wait(3)
tb(6317)
wait(3)
tb(6318)
wait(3)
tb(6319)
wait(3)
tb(6320)
wait(3)
tb(6321)
wait(3)
tb(6322)
wait(3)
tb(6323)
wait(3)
tb(6324)
wait(3)
tb(6951)
wait(3)
tb(6325)
wait(3)
tb(6326)
wait(3)
tb(6327)
wait(3)
stop song
tb(6328)

palout(1)
show map
if(check tag(3)) then(play song(76))
if(check tag(4)) then(play song(76))
if(check tag(5)) then(play song(76))
if(check tag(6)) then(play song(4))
wait(1)
palin(1)
wait(5)
jig npc(13)
tb(6948)
set tag(472,1)
			)
			else(
				jig npc(13)
				tb(6950)
			)
		)
		else(
			jig npc(13)
			tb(6950)
		)
	)
	else(
		jig npc(13)
		tb(6950)
	)
)

resume obstruction
resume npcs
resume player
end
###

##################
script, nix, begin
suspend player
suspend npcs
suspend obstruction

#final
if(check tag(478),and,check tag(479)==false) then(

nix1
nix2
nix3

)

#speech 6
if(check tag(477),and,check tag(478)==false) then(
jig nix
tb(6334)
wait(10)
jig nix
tb(6335)
set tag(478,1)
wait(1)
save game
)

#speech 5
if(check tag(476),and,check tag(477)==false) then(
jig nix
tb(6333)
set tag(477,1)
)

#speech 4
if(check tag(475),and,check tag(476)==false) then(
jig nix
tb(6332)
set tag(476,1)
)

#speech 3
if(check tag(474),and,check tag(475)==false) then(
jig nix
tb(6331)
set tag(475,1)
)

#speech 2
if(check tag(473),and,check tag(474)==false) then(
jig nix
tb(6330)
set tag(474,1)
)

#speech 1
if(check tag(473)==false) then(
jig nix
tb(6329)
set tag(473,1)
)

resume obstruction
resume npcs
resume player
end
###

#####################
script, jignix, begin
tweak palette (0,3,3)
update palette
wait (1)
tweak palette (0,6,6)
update palette
wait (1)
tweak palette (0,12,12)
update palette
reset palette
wait (1)
tweak palette (0,6,6)
update palette
reset palette
wait (1)
tweak palette (0,3,3)
update palette
wait (1)
reset palette
update palette
end
###

###################
script, nix1, begin
jig nix
stop song
tb(6336)
play song(59)
hero clothes
set hero speed(0,1)
pan camera(down,5,2)
walk hero(0,down,2)
wait for hero(0)
set hero frame(0,0)
wait for camera
set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk npc(1,right,1)
walk npc(3,left,1)
walk npc(2,up,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,down)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,left)
wait(2)
set npc direction(2,down)

wait(10)
variable(i)
variable(cx)
variable(cy)
set variable(cx,camera pixel x)
set variable(cy,camera pixel y)
for(i,1,10,1) do(
put camera(cx+10,cy)
wait(1)
put camera(cx--10,cy)
wait(1)
)
put camera(cx,cy)

jig hero(0)
tb(6337)
wait(2)
set npc direction(1,left)
set npc direction(3,right)
wait(2)
walk npc(1,up,1)
walk npc(3,up,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,right)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait(2)
set npc direction(1,down)
set npc direction(3,down)

wait(15)
for(i,1,10,1) do(
put camera(cx+30,cy)
wait(1)
put camera(cx--30,cy)
wait(1)
)
for(i,1,4,1) do(
put camera(cx+5,cy)
wait(2)
put camera(cx--5,cy)
wait(2)
)
put camera(cx,cy)
jig nix
tb(6338)
wait(3)
palout(1)
reset palette
update palette
wait(1)
palout(1)
reset palette
update palette
wait(1)
palout(1)
set npc direction(4,up)
reset palette
update palette
wait(1)
palout(1)
pan camera(down,4,20)
wait for camera
wait(1)
pan camera(up,7,2)
wait(1)
palin(10)
wait for camera

wait(15)
jig nix
tb(6339)
end
###
###################
script, nix2, begin
stop song
battleflash(1)
set party in
ff(302)
stop song
set party out
swap by position(find hero(0),0)
end
###
###################
script, nix3, begin
wait(10)
play song(15)
jig nix
tb(6340)
jig nix
tb(6341)
wait(5)
jig npc(3)
tb(6342)
wait(10)
tb(6343)
wait(3)
set npc frame(4,1)
wait(6)
jig nix
tb(6344)
wait(3)
jig npc(3)
tb(6345)
jig nix
tb(6346)
wait(5)
jig npc(3)
tb(6347)
jig nix
set npc frame(4,0)
tb(6348)
jig nix
tb(6349)
jig nix
tb(6350)
jig nix
tb(6351)
wait(15)
jig nix
tb(6352)

wait(35)

variable(i)
variable(cx)
variable(cy)
set variable(cx,camera pixel x)
set variable(cy,camera pixel y)
for(i,1,5,1) do(
put camera(cx+10,cy)
wait(1)
put camera(cx--10,cy)
wait(1)
)
put camera(cx,cy)

jig nix
stop song
tb(6353)
jig hero(0)
tb(6354)
play song(15)

for(i,1,5,1) do(
put camera(cx--10,cy)
wait(1)
put camera(cx+10,cy)
wait(1)
)
put camera(cx,cy)

jig nix
tb(6355)
jig nix
set npc frame(4,1)
tb(6356)

wait(10)
stop song
palout(10)
show backdrop(0)
suspend box advance
show text box(6357)
wait(10)
palin(5)
wait for key(usekey)
palout(5)
advance text box
show text box(6358)
wait(10)
palin(5)
wait for key(usekey)
palout(5)
advance text box
resume obstruction
resume npcs
camera follows hero(0)
set hero position(0,90,83)
show map
wait(1)
pan camera(south,0,0)
set hero position(0,0,0)
wait(15)
pan camera(up,50,1)
play song(19)
wait(1)
palin(5)

text out(1)
show text box(6359)
wait(3)
text in(5)
wait for key(usekey)
text out(5)
advance text box
show text box(6360)
wait(3)
text in(5)
wait for key(usekey)
text out(5)
advance text box
show text box(6361)
wait(3)
text in(5)
wait for key(usekey)
text out(5)
advance text box
show text box(6362)
wait(3)
text in(5)
wait for key(usekey)
text out(5)
advance text box
wait(5)

stop song

palout(10)
text in(1)
resume box advance
suspend npcs
suspend obstruction
camera follows hero(0)
set hero position(0,46,177)
wait(1)
pan camera(south,0,0)
set hero position(0,46,171)
wait(1)
pan camera(up,3,1)
set npc frame(4,1)
wait(1)
palin(10)
wait for camera

wait(15)
jig nix
set npc frame(4,0)
tb(6363)
set hero speed(0,2)
walk hero(0,down,1)
wait(1)
pan camera(up,3,1)
wait for hero(0)
set hero frame(0,0)
wait for camera
wait(5)
jig hero(0)
play song(91)
tb(6364)
wait(8)
tb(6365)
wait(5)
jig nix
tb(6366)
jig npc(2)
tb(6367)
jig nix
tb(6368)
jig npc(1)
tb(6369)
wait(2)
set hero direction(0,left)
wait(2)
walk hero(0,up,1)
wait(1)
pan camera(up,1,2)
set npc direction(1,left)
set npc direction(3,right)
wait(2)
set npc direction(2,right)
set npc direction(1,up)
set npc direction(3,up)
wait(2)
set npc direction(2,up)
wait for hero(0)
set hero frame(0,0)
jig nix
stop song
show text box(6370)
set npc position(4,46,168)
set npc direction(4,right)
set npc frame(4,0)
wait for text box
wait for camera
wait(15)
jig nix
set npc frame(4,1)
play song(75)
tb(6371)
jig nix
tb(6372)
jig nix
tb(6373)
jig npc(3)
tb(6374)
jig nix
set npc frame(4,0)
tb(6375)
wait(10)
jig nix
tb(6376)
jig nix
set npc frame(4,1)
tb(6377)

alter npc(4,NPCstat:movespeed,1)
walk npc(4,down,1)
set npc direction(4,left)
wait for npc(4)
wait(10)
variable(j)
for(j,1,4,1) do(
alter npc(4,NPCstat:picture,155)
alter npc(4,NPCstat:palette,253)
wait(2)
alter npc(4,NPCstat:picture,511)
alter npc(4,NPCstat:palette,285)
wait(2)
)
for(j,1,2,1) do(
alter npc(4,NPCstat:picture,155)
alter npc(4,NPCstat:palette,253)
wait(3)
alter npc(4,NPCstat:picture,511)
alter npc(4,NPCstat:palette,285)
wait(3)
)
alter npc(4,NPCstat:picture,155)
alter npc(4,NPCstat:palette,253)
walk npc(4,down,1)
jig nix
show text box(6378)
wait for npc(4)
set tag(479,1)
get item(191,1)
wait for text box
wait(3)
jadeup(5,1)
tb(6379)
wait(3)
focus camera(46,170,2)
alter npc(1,NPCstat:movespeed,2)
alter npc(2,NPCstat:movespeed,2)
alter npc(3,NPCstat:movespeed,2)
set hero speed(0,2)
walk npc(1,left,1)
walk npc(3,right,1)
walk hero(0,up,1)
wait for hero(0)
set hero frame(0,0)
set npc position(1,0,1)
set npc position(2,1,1)
set npc position(3,2,1)
set party in
wait for camera
camera follows hero(0)
set hero speed(0,hspeed)
set variable(musicsave,75)
save game
end
###

#############################
script, fedoraharmtile, begin
suspend player
suspend npcs
suspend obstruction

if(herox(0)<<54,and,herox(0)>>18,and,heroy(0)<<156,and,heroy(0)>>120) then(

show backdrop(1)
wait(3)
show map
set hero stat(find hero(0),0,get hero stat(find hero(0),0,currentstat)--25,currentstat)
set hero stat(find hero(1),0,get hero stat(find hero(1),0,currentstat)--25,currentstat)
set hero stat(find hero(2),0,get hero stat(find hero(2),0,currentstat)--25,currentstat)
set hero stat(find hero(3),0,get hero stat(find hero(3),0,currentstat)--25,currentstat)
if(get hero stat(find hero(0),0,currentstat)<<1) then(set hero stat(find hero(0),0,1,currentstat))
if(get hero stat(find hero(1),0,currentstat)<<1) then(set hero stat(find hero(1),0,1,currentstat))
if(get hero stat(find hero(2),0,currentstat)<<1) then(set hero stat(find hero(2),0,1,currentstat))
if(get hero stat(find hero(3),0,currentstat)<<1) then(set hero stat(find hero(3),0,1,currentstat))
)

resume obstruction
resume npcs
resume player
end
###

####################
script, cyinn, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(7)
tb(6914)

#choose to stay
if(check tag(258)) then(
	if(pay money(4)) then(
		palout(2)

		innfancy

		set hp
		wait(1)
		teleport to map(49+poff,44,4)
		suspend npcs
		innrest
		set party out
		swap by position(0,findhero(0))
		heroclothes
		pan camera(south,0,0)
		wait(1)
		set hero position(0,40,2)
		set npc position(1,42,2)
		set npc position(2,44,2)
		set npc position(3,46,2)
		alter npc(1,NPCstat:movespeed,2)
		alter npc(2,NPCstat:movespeed,2)
		alter npc(3,NPCstat:movespeed,2)
		set hero speed(0,2)
		set hero direction(0,down)
		wait(10)
		palin(2)
		walk hero(0,right,1)
		walk npc(1,right,1)
		walk npc(2,right,1)
		walk npc(3,right,1)
		wait for hero(0)
		wait for npc(3)
		walk hero(0,down,2)
		walk npc(1,down,2)
		walk npc(2,down,2)
		walk npc(3,down,2)
		wait for hero(0)
		wait for npc(3)
		walk hero(0,right,3)
		walk npc(1,right,1)
		walk npc(2,left,1)
		walk npc(3,left,3)
		wait for hero(0)
		set hero frame(0,0)
		wait for npc(3)
		set party in
		set npc position(1,5,1)
		set npc position(2,6,1)
		set npc position(3,7,1)
		set hero direction(0,down)
		set hero speed(0,hspeed)
		camera follows hero(0)
		alter npc(7,NPCstat:script,0)
		alter npc(7,NPCstat:displaytext,6915)
		save game
	)
	#do not pay
	else(
		jig npc(7)
		tb(6916)
	)
)
#chose not to pay
else(
	jig npc(7)
	tb(6917)
)

resume obstruction
resume npcs
resume player
end
###

#####################
script, cyitem, begin
suspend player
suspend npcs
suspend obstruction

if(herox(0)==9) then(set npc direction(npc at spot(7,129),right))
else(set npc direction(npc at spot(7,129),down))

set tag(258,0)
jig npc(npc at spot(7,129))
tb(6952)

#check if want to buy
if(check tag(258)) then(

alter npc(9,NPCstat:script,0)
wait(3)
set tag(258,0)
tb(6596)
if(check tag(258)) then(use shop(4))
else( itemcyport )
wait(1)
alter npc(9,NPCstat:script,243)

)#end check to buy

#don't want to buy
else(
jig npc(npc at spot(7,129))
if(check tag(423)) then(tb(6110))
else(
	if(check tag(411)) then(tb(6062))
	else(
		if(check tag(409)) then(tb(6026))
		else(tb(6025))
	)
)
)


resume obstruction
resume npcs
resume player
end
###

#####################
script, cyicona, begin
suspend player
suspend npcs
suspend obstruction

if((herox(0)==3,and,heroy(0)==4),or,(herox(0)==5,and,heroy(0)==4)) then(

)
else(

#main
set tag(258,0)

#direct npc to pc
if(herox(0)==3) then(set npc direction(npc at spot(4,3),left))
else(
	if(herox(0)==5) then(set npc direction(npc at spot(4,3),right))
	else(set npc direction(npc at spot(4,3),down))
)

jig npc(npc at spot(4,3))
tb(7033)
if(check tag(258)) then( iconcraft(56,148,6953,12,8,4,87) )
else(
jig npc(npc at spot(4,3))
tb(7034)
)

)

resume obstruction
resume npcs
resume player
end
###

#####################
script, cyiconb, begin
suspend player
suspend npcs
suspend obstruction

#check if waiting
if( cyporticonsave <> 0 ) then(
	#get icon
	if(iconwaitcheck(cyporticonsave,cyporticonhour,cyporticonday)) then(
		jig npc(npc at spot(4,55))
		tb(7037)
		tb(6985 + (cyporticonsave -- 156) )
		get item(cyporticonsave)
		set variable(cyporticonsave,0)
		set variable(cyporticonhour,0)
		set variable(cyporticonday,0)
	)
	#still waiting
	else(
		jig npc(npc at spot(4,55))
		tb(7038)
	)
)

#main
set tag(258,0)
jig npc(npc at spot(4,55))
tb(7035)
if(check tag(258)) then( iconcraft(59,156,6961,12,8,5,87) )
else(
jig npc(npc at spot(4,55))
tb(7036)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, cytrainer, begin
suspend player
suspend npcs
suspend obstruction

#figure out which npc to jig
variable(nnn)
if(herox(0)<<22) then(
	if(herox(0)==19,and,heroy(0)==8) then(
		if(hero direction(0)==up) then(set variable(nnn,npc at spot(19,7)))
		if(hero direction(0)==down) then(set variable(nnn,npc at spot(19,9)))
	)
	else(
		if(heroy(0)<<8) then(set variable(nnn,npc at spot(19,7)))
		else(set variable(nnn,npc at spot(19,9)))
	)
)
else(
	if(herox(0)==25,and,heroy(0)==8) then(
		if(hero direction(0)==up) then(set variable(nnn,npc at spot(25,7)))
		if(hero direction(0)==down) then(set variable(nnn,npc at spot(25,9)))
	)
	else(
		if(heroy(0)<<8) then(set variable(nnn,npc at spot(25,7)))
		else(set variable(nnn,npc at spot(25,9)))
	)
)

set tag(258,0)
jig npc(nnn)
tb(7039)

if(check tag(258)) then(
	#npc, firstscreen,firsttextbox,$cost,phasecost,
	#strup,accup,defup,ddgup,sklup,evdup,
	#strcap,acccap,defcap,ddgcap,sklcap,evdcap
	stattrain(nnn,92,7041,6,4,10,15,5,15,10,10,99,94,56,89,104,56)
)
else(
	wait(3)
	jig npc(nnn)
	tb(7040)
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, cytrader, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(6)
tb(6638)
if(check tag(258)) then( trader(7404,15) )
else(
wait(2)
jig npc(6)
tb(7051)
)

resume obstruction
resume npcs
resume player
end
###

######################
script, cyavis, begin
suspend player
suspend npcs
suspend obstruction

variable(n)
set variable(n,npc at spot(11,20))

#lockdown, no buy
#if had avis taken away text check
if(check tag(296)==false) then(
	if(check tag(481)) then(
		if(check tag(482)) then(
			jig npc(n)
			tb(7059)
		)
		else(
			jig npc(n)
			tb(7053)
			jig hero(0)
			tb(7054)
			jig npc(n)
			tb(7058)
			set tag(482,1)
		)
	)
	else(
		jig npc(n)
		tb(7060)
	)
)

#lockdown lifted, can buy
#if had avis, give avis back
else(

#already have avis
if(check tag(481),and,inventory(72)==0) then(
jig npc(n)
tb(7061)
jig npc(n)
tb(7062)
wait(3)
tb(7076)
get item(72,1)
set tag(481,0)
)

#have avis
if(check tag(265)) then(
jig npc(n)
tb(7066)
jig hero(0)
tb(7067)
jig npc(n)
tb(7071)
jig hero(0)
tb(7072)
)

#get avis
else(
	set tag(258,0)
	jig npc(n)
	tb(7063)
	wait(2)
	if(check tag(258)) then(
		if(pay money(25)) then(
			set tag(265,1)
			tb(7065)
			wait(2)
			if(check tag(261)==false) then(
				jig gahn
				tb(6616)
				set tag(261,1)
				get item(72,1)
			)
		)
		#not enough money
		else(
			jig npc(n)
			tb(7064)
		)
	)
	#chose not to buy
	else(
		jig npc(n)
		tb(7077)
	)
)
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, daodeath, begin
set npc frame(4,0)
wait(5)
tb(5815)
set death script(3)
set hero stat(0,0,1,currentstat)
set party in
if(check tag(3)) then(play song(77))
if(check tag(4)) then(play song(77))
if(check tag(5)) then(play song(77))
if(check tag(6)) then(play song(4))
end
###

############################
script, wobblerbounty, begin
suspend player
suspend npcs
suspend obstruction

jig hero(0)
stop song
tb(5885)
jig npc(30)
tb(5889)
wait(8)
jig npc(30)
play song(72)
tb(5890)

battleflash
ff(577+poff)
stop song
set tag(442,1)
set tag(294,1)
destroy npc(29)

wait(3)
palout(2)
teleport to map(41+poff,19,28)
set hero direction(0,up)
wait(1)
palin(2)

wait(5)
jig npc(npc at spot(19,26))
tb(5891)
jig hero(0)
tb(5892)
jig npc(npc at spot(19,26))
tb(5896)
jig hero(0)
wait(4)
tb(5897)
wait(4)
jig npc(npc at spot(19,26))
tb(5898)
wait(2)
tb(5899)
get money(100)
wait(3)
jadeup(4,1)
wait(3)
resume obstruction
resume npcs
resume player
end
###

########################
script, cycomauto, begin
if(check tag(442)) then(write map block(21,24,read map block(24,24)))

if(check tag(444)) then(write map block(25,24,read map block(24,24)))

if(check tag(446)) then(write map block(23,24,read map block(24,24)))

if(check tag(448)) then(write map block(27,24,read map block(24,24)))
end
###

###################
script, pecu, begin
suspend player
suspend npcs
suspend obstruction

#have talked to pecu before
if(check tag(451),and,check tag(443)==false) then(
jig npc(18)
tb(6931)
)

#haven't
if(check tag(451)==false) then(
jig npc(18)
tb(6925)
jig hero(0)
tb(6926)
jig npc(18)
tb(6930)
set tag(451,1)
)

#capture
if(check tag(443)) then(
stop song
wait(5)
jig npc(18)
tb(5901)
jig hero(0)
tb(5902)
wait(1)
palout(1)
set tag(444,1)
wait(1)
teleport to map(41+poff,19,28)
stop song
set hero direction(0,up)
wait(1)
alter npc(31,NPCstat:picture,510)
alter npc(31,NPCstat:palette,281+poff)
set npc position(31,20,28)
set npc direction(31,up)
wait(1)
palin(5)

wait(5)
jig npc(npc at spot(19,26))
tb(5906)
jig hero(0)
tb(5907)
jig npc(npc at spot(19,26))
tb(5911)
wait(3)
tb(5912)
get money(50)
wait(3)
palout(2)
set npc position(31,0,0)
wait(2)
palin(2)
wait(5)
pan camera(right,4,1)
wait(5)
set hero speed(0,2)
set hero direction(0,right)
wait(3)
walk hero(0,right,4)
wait for hero(0)
set hero frame(0,0)
wait(3)
set hero direction(0,down)
wait for camera
wait(3)
jig hero(0)
tb(5913)
wait(3)
jadeup(4,1)
wait(3)
set hero speed(0,hspeed)
camera follows hero(0)
if(check tag(3)) then(play song(77))
if(check tag(4)) then(play song(77))
if(check tag(5)) then(play song(77))
if(check tag(6)) then(play song(4))
)

resume obstruction
resume npcs
resume player
end
###

########################
script, castlepayment, begin
suspend player
suspend npcs
suspend obstruction

#init, make sure they receive payment at start
if(check tag(458)==false) then(
	set variable(castlepay,day--5)
	set tag(458,1)
)

#ask how the player is doing
#fine, great
#and player asks for money!
jig npc(npc at spot(27,60))
tb(6932)
jig hero(0)
tb(6936)

#receive payment if castlepay is 5 days old
if( (day--castlepay) >= 5) then(
	set variable(text1,50)
	wait(3)
	tb(6940)
	get money(50)
	set variable(castlepay,day)
	set variable(text1,5)
	alter npc(8,NPCstat:displaytext,6943)
	alter npc(8,NPCstat:script,0)
)
#no payment
else(
	set variable(text1,5--(day--castlepay))
	jig npc(npc at spot(27,60))
	if(text1==1) then(
		tb(6942)
		alter npc(8,NPCstat:displaytext,6944)
		alter npc(8,NPCstat:script,0)
	)
	else(
		tb(6941)
		alter npc(8,NPCstat:displaytext,6943)
		alter npc(8,NPCstat:script,0)
	)
)

resume obstruction
resume npcs
resume player
end
###

##############################
script, cyportnorthauto, begin
if(castleday--day<=0,and,check tag(480)==false,and,check tag(453)) then(
	set tag(480,1)
	set tag(454,1)
)
end
###

########################
script, rorcicona, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(506)) then(
if(check tag(507)==false) then(
jig npc(24)
tb(7255)
wait(12)
tb(7256)
wait(12)
jig npc(24)
tb(7257)
set tag(507,1)
)
#main
set tag(258,0)
jig npc(24)
tb(7258)
if(check tag(258)) then( iconcraft(62,164,6993,16,10,6,87) )
else(
jig npc(24)
tb(7259)
)
)
else(
jig npc(24)
tb(7254)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, rorciconb, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(501)) then(
	#check if waiting
	if( rorciconsave <> 0 ) then(
		#get icon
		if(rorciconwaitcheck(rorciconsave,rorciconhour,rorciconday)) then(
			jig npc(21)
			tb(7209)
			tb( 7025 + (rorciconsave -- 172) )
			get item(rorciconsave)
			set variable(rorciconsave,0)
			set variable(rorciconhour,0)
			set variable(rorciconday,0)
		)
		#still waiting
		else(
			jig npc(21)
			tb(7208)
		)
	)
	#main
	set tag(258,0)
	jig npc(21)
	tb(7206)
	if(check tag(258)) then( iconcraft(65,172,7001,16,10,7,87) )
	else(
		jig npc(21)
		tb(7207)
	)
)
#pre-scene
else(
	jig npc(21)
	tb(7202)
	jig npc(21)
	tb(7203)
	tb(7204)
	jig npc(21)
	tb(7205)
	set tag(501,1)
)

resume obstruction
resume npcs
resume player
end
###

###################################
script, cyportmisc, whichone, begin
suspend player
suspend npcs
suspend obstruction

#seamstress 1
if(whichone==1) then(
	if(check tag(177)) then(
jig npc(20)
tb(7095)
	)
	else(
jig npc(19)
tb(7089)
if(check tag(175)) then(
jig hero(0)
tb(7090)
jig npc(19)
tb(7094)
wait(2)
palout(1)
set tag(177,1)
wait(1)
palin(1)
)
	)

)

#cold npc 2
if(whichone==2) then(
if(check tag(486)) then(
jig npc(18)
tb(7102)
)
else(
jig npc(18)
tb(7096)
if(inventory(15)>>0) then(
jig hero(0)
tb(7097)
jig npc(18)
tb(7101)
wait(2)
palout(1)
delete item(15,1)
set tag(486,1)
set tag(178,1)
set npc position(18,0,0)
wait(1)
palin(1)
)
)
)

#chitter chatter npc 3
if(whichone==3) then(
if(check tag(487)) then(
jig npc(16)
tb(7105)
)
else(
jig npc(16)
tb(7103)
if(inventory(15)>>0) then(
jig hero(0)
tb(7097)
jig npc(16)
tb(7104)
wait(2)
palout(1)
delete item(15,1)
set tag(487,1)
set tag(179,1)
set npc position(16,0,0)
alter npc(16,NPCstat:movespeed,0)
wait(1)
palin(1)
)
)
)

#image upgrade npc 4
if(whichone==4) then(
if(check tag(488)) then(
jig npc(17)
tb(7108)
)
else(
jig npc(17)
tb(7106)
if(inventory(15)>>0) then(
jig hero(0)
tb(7097)
jig npc(17)
tb(7107)
wait(2)
palout(1)
delete item(15,1)
set tag(488,1)
set tag(180,1)
set npc position(17,0,0)
alter npc(17,NPCstat:movespeed,0)
wait(1)
palin(1)
)
)
)

resume obstruction
resume npcs
resume player
end
###

################################
script, cycentralautoload, begin
if(check tag(487),and,currentmap<>47) then(alter npc(16,NPCstat:picture,514))
if(check tag(488),and,currentmap<>47) then(alter npc(17,NPCstat:picture,516))
end
###

##########################
script, cysignposts, begin
suspend player

#Mazing
if((herox(0)==32,and,heroy(0)==50),or,(herox(0)==33,and,heroy(0)==51),or,(herox(0)==34,and,heroy(0)==50)) then(
	if(check tag(282)) then(tb(7110))
	else(tb(7109))
)
else(
#cyport central, <--cyport west
if((herox(0)==15,and,heroy(0)==52),or,(herox(0)==16,and,heroy(0)==51),or,(herox(0)==15,and,heroy(0)==66),or,(herox(0)==16,and,heroy(0)==65)) then(
	tb(7111)
)
)
do(
#art house
if((herox(0)==28,and,heroy(0)==52),or,(herox(0)==29,and,heroy(0)==51),or,(herox(0)==28,and,heroy(0)==50)) then(
	tb(7112)
)
)
do(
#avis shop
if((herox(0)==34,and,heroy(0)==36),or,(herox(0)==33,and,heroy(0)==35),or,(herox(0)==34,and,heroy(0)==34)) then(
	tb(7113)
)
)
do(
#cyport central, up to cyport north
if((herox(0)==53,and,heroy(0)==32),or,(herox(0)==54,and,heroy(0)==33)) then(
	tb(7114)
)
)
do(
#inn
if((herox(0)==64,and,heroy(0)==48),or,(herox(0)==65,and,heroy(0)==47),or,(herox(0)==64,and,heroy(0)==46)) then(
	tb(7115)
)
)
do(
#cyport central, --> rorc mountains
if((herox(0)==74,and,heroy(0)==48),or,(herox(0)==73,and,heroy(0)==47),or,(herox(0)==74,and,heroy(0)==60),or,(herox(0)==73,and,heroy(0)==61),or,(herox(0)==74,and,heroy(0)==62)) then(
	tb(7116)
)
)
do(
#bounty office
if((herox(0)==67,and,heroy(0)==58),or,(herox(0)==66,and,heroy(0)==59),or,(herox(0)==67,and,heroy(0)==60)) then(
	tb(7117)
)
)
do(
#town hall left sign post
if((herox(0)==54,and,heroy(0)==64),or,(herox(0)==53,and,heroy(0)==65),or,(herox(0)==54,and,heroy(0)==66),or,(herox(0)==55,and,heroy(0)==65,and,herodirection(0)==left)) then(
	tb(7118)
)
)
do(
#town hall right sign post
if((herox(0)==56,and,heroy(0)==64),or,(herox(0)==57,and,heroy(0)==65),or,(herox(0)==56,and,heroy(0)==66),or,(herox(0)==55,and,heroy(0)==65,and,herodirection(0)==right)) then(
	tb(7119)
)
)
do(
#dao's domain
if((herox(0)==45,and,heroy(0)==77),or,(herox(0)==46,and,heroy(0)==78),or,(herox(0)==45,and,heroy(0)==79)) then(
	tb(7120)
)
)
do(
#cyport central, down to fralin
if((herox(0)==34,and,heroy(0)==88),or,(herox(0)==33,and,heroy(0)==89),or,(herox(0)==34,and,heroy(0)==90)) then(
	tb(7121)
)
)
do(
#items, sparra and talon
if((herox(0)==32,and,heroy(0)==65),or,(herox(0)==33,and,heroy(0)==66),or,(herox(0)==32,and,heroy(0)==67)) then(
	tb(7122)
)
)
do(
#fabric imports
if((herox(0)==21,and,heroy(0)==63),or,(herox(0)==22,and,heroy(0)==64),or,(herox(0)==21,and,heroy(0)==65)) then(
	tb(7123)
)
)
resume player
end
###

#########################
script, rorcbridge, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(490)) then(
	jig npc(7)
	tb(7136)
)

else(
	jig npc(7)
	tb(7128)
	tb(7129)
	if(check tag(489)) then(
		jig hero(0)
		tb(7130)
		stop song
		wait(15)
		tb(7134)
		jig npc(7)
		play song(82)
		tb(7135)
		wait(2)
		palout(1)
		set tag(490,1)
		set npc position(7,0,0)
		wait(1)
		palin(1)
	)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, rorcbusted, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(493)) then(
	jig npc(13)
	tb(7151)
)

else(
	jig npc(13)
	if(check tag(491)==false) then(
		tb(7141)
		set tag(491,1)
	)
	tb(7142)
	tb(7143)
	jig npc(13)
	tb(7144)
	if(check tag(492)) then(
		jig hero(0)
		tb(7145)
		stop song
		wait(5)
		jig npc(13)
		tb(7149)
		wait(15)
		jig npc(13)
		play song(82)
		tb(7150)
		wait(2)
		palout(1)
		set tag(493,1)
		set npc position(13,0,0)
		wait(1)
		palin(1)
	)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, rorcladder, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(495)) then(
	jig npc(14)
	tb(7168)
)

else(
	jig npc(14)
	tb(7156)
	if(check tag(494)) then(
		jig hero(0)
		tb(7157)
		wait(5)
		jig npc(14)
		tb(7161)
		jig hero(0)
		tb(7162)
		stop song
		jig npc(14)
		tb(7166)
		wait(2)
		palout(1)
		set tag(495,1)
		wait(25)
		palin(1)
		play song(69)
		wait(2)
		jig npc(14)
		tb(7167)
	)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, rorcdiver, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(497)) then(
	jig npc(16)
	tb(7181)
)

else(
	jig npc(16)
	tb(7173)
	if(check tag(496)) then(
		jig hero(0)
		tb(7174)
		wait(5)
		jig npc(16)
		tb(7178)
		wait(15)
		jig npc(16)
		tb(7179)
		wait(2)
		stop song
		palout(1)
		set tag(497,1)
		wait(20)
		palin(1)
		wait(2)
		jig npc(16)
		tb(7180)
		wait(3)
		tb(7810)
		get item(29,1)
		play song(74)
	)
)

resume obstruction
resume npcs
resume player
end
###

########################
script, rorcspunk, begin
suspend player
suspend npcs
suspend obstruction



resume obstruction
resume npcs
resume player
end
###

######################
script, rorcmap, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(500)) then(
	palout(1)
	wait(1)
	show backdrop(114)
	wait(1)
	palin(1)
	wait(1)
	wait for key(usekey)
	wait(1)
	palout(1)
	show map
	wait(1)
	palin(1)
	wait(2)
	jig npc(17)
	tb(7200)
)
else(
	if(check tag(506)) then(
		jig npc(17)
		tb(7197)
		wait(2)
		stop song
		palout(1)
		wait(1)
		show backdrop(114)
		wait(1)
		palin(1)
		play song(96)
		wait(1)
		wait for key(usekey)
		wait(1)
		stop song
		palout(1)
		show map
		wait(1)
		palin(1)
		play song(74)
		wait(5)
		tb(7198)
		jig npc(17)
		tb(7199)
		set tag(500,1)
	)
	else(
		jig npc(17)
		tb(7195)
	)
)

resume obstruction
resume npcs
resume player
end
###

######################
script, rorcten, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

if(check tag(502)) then(
	jig npc(22)
	tb(7213)
	if(check tag(258)) then(
		set tag(258,0)
		wait(2)
		tb(7214)
		if(check tag(258)) then(
			wait(2)
			fade screen out(0,0,63)
			set hero stat(find hero(0),0,dohp,current stat)
			set hero stat(find hero(0),0,dohp,maximum stat)
			set hero stat(find hero(1),0,mihp,current stat)
			set hero stat(find hero(1),0,mihp,maximum stat)
			set hero stat(find hero(2),0,johp,current stat)
			set hero stat(find hero(2),0,johp,maximum stat)
			set hero stat(find hero(3),0,pyhp,current stat)
			set hero stat(find hero(3),0,pyhp,maximum stat)
			wait(15)
			palin(5)
		)
		else(
			wait(2)
			palout(1)

			restfancy

			set hp
			wait(1)
			teleport to map(77+poff,4,69)
			innrest
			set npc direction(22,right)
			set hero direction(0,down)
			wait(15)
			palin(5)
			wait(2)
			savegame
		)
	)
	else(
		jig npc(22)
		tb(7215)
	)
)
else(
	stop song
	jig npc(22)
	tb(7210)
	play song(69)
	tb(7211)
	jig npc(22)
	tb(7212)
	set tag(502,1)
)


resume obstruction
resume npcs
resume player
end
###

#####################################
script, rorckeeljack, whichone, begin
suspend player
suspend npcs
suspend obstruction

#jack
if(whichone==1) then(
jig npc(20)
tb(7216)
jig hero(0)
tb(7217)
jig npc(20)
tb(7221)
)

#keel
if(whichone==2) then(
	if(check tag(503)) then(
		jig npc(19)
		tb(7227)
	)
	else(
		jig npc(19)
		tb(7222)
		tb(7223)
		jig npc(19)
		tb(7224)
		tb(7225)
		jig npc(19)
		tb(7226)
		set tag(503,1)
	)
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, finaldao, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

#have not met dao in cyport yet
if(check tag(440)==false) then(
	tb(7228)
)

#met dao in cyport
else(
	#walk hero to correct position
	focus camera(26,96,2)
	set hero speed(0,2)
	walk hero to y(0,96)
	wait for hero(0)
	walk hero to x(0,26)
	wait for hero(0)
	set hero frame(0,0)
	set hero direction(0,up)
	set hero speed(0,hspeed)
	wait for camera
	camera follows hero(0)

	#have already talked to him here
	if(check tag(504)) then(
		#have maxed out stats
		if(check tag(505)) then(
			#finished text 3
			if(check tag(692),and,check tag(693)) then(
				play song(72)
				wait(5)
				jig npc(23)
				set npc frame(23,1)
				tb(7247)
				wait(10)
				set npc frame(23,0)
				wait(10)
				tb(7248)
				set tag(692,0)
				set tag(693,0)
			)
			else(
				#finished text 2
				if(check tag(692),and,check tag(693)==false) then(
					tb(7246)
					set tag(693,1)
				)
				#finished text 1
				else(
					jig npc(23)
					tb(7244)
					tb(7245)
					set tag(692,1)
				)
			)
		)

		#train
		else(
			play song(72)
			jig npc(23)
			set npc frame(23,1)
			tb(7242)

			#TRAIN!!
			if(check tag(258)) then(
				#check if stats are high enough
				if(dostr>>90,and,doacc>>80,and,dodef>>53,and,doddg>>75,and,doskl>>95,and,doevd>>47) then(
					wait(2)
					stattrain(23,95,7988,25,5,30,30,20,30,30,20,129,124,76,119,134,76,true)
					wait(2)

					#check if have maxed out stats
					if(check tag(509),and,check tag(510),and,check tag(511),and,check tag(512),and,check tag(513),and,check tag(514)) then(
						set tag(505,1)
					)
				)
				#stats aren't high enough for training
				else(
					set npc frame(23,0)
					tb(7260)
					tb(7261)
				)
			)
			#No train?!
			else(
				wait(2)
				set npc frame(23,0)
				tb(7243)
			)
		)
	)

	#have not yet talked to him here
	else(
		stop song
		set npc frame(23,1)
		tb(7229)
		jig npc(23)
		set npc frame(23,1)
		tb(7230)
		jig hero(0)
		tb(7231)
		jig npc(23)
		tb(7235)
		set npc frame(23,1)
		play song(72)
		tb(7236)
		wait(10)
		jig npc(23)
		set npc frame(23,1)
		tb(7237)
		jig npc(23)
		set npc frame(23,1)
		tb(7238)
		tb(7239)
		wait(10)
		jig npc(23)
		set npc frame(23,1)
		tb(7240)
		wait(5)
		tb(7241)
		wait(2)
		set npc frame(23,0)
		set tag(504,1)
	)

)

resume obstruction
resume npcs
resume player
end
###

#########################
script, mysterious, begin
suspend player
suspend npcs
suspend obstruction

palout(1)
variable(twelvehundred)
variable(hoohah)
set variable(hoohah,1)
set variable(text1,currenttime)
set variable(text2,day)
#PM
if(text1>>1199,and,text1<<2500) then(
	set variable(text1,text1--1200)
	set variable(twelvehundred,2)
)
#AM
else(
	set variable(twelvehundred,1)
)
set variable(hm,(text1,mod,100))
set variable(text1,(text1--hm)/100)
#check to see if 12PM
if(text1==0) then(set variable(text1,12))

wait(2)
palin(1)
wait(5)
show backdrop(7)
#AM
if(twelvehundred==1) then(
	#need a zero on the end?
	if((hm,mod,10)==0) then(
		show text box(7793)
		set variable(hoohah,2)
	)
	#need a zero on the start?
	if(hm<<10) then(
		show text box(7794)
		set variable(hoohah,2)
	)
	#minute is fine
	if(hoohah==1) then(
		show text box(7249)
	)
)
#PM
else(
	#need a zero on the end?
	if((hm,mod,10)==0) then(
		show text box(7795)
		set variable(hoohah,2)
	)
	#need a zero on the start?
	if(hm<<10) then(
		show text box(7796)
		set variable(hoohah,2)
	)
	#minute is fine
	if(hoohah==1) then(
		show text box(7774)
	)
)
wait(3)
show map
wait for text box

resume obstruction
resume npcs
resume player
end
###

########################
script, rorcitems, begin
suspend player
suspend npcs
suspend obstruction

if(check tag(508)==false) then(
jig npc(10)
tb(7250)
tb(7251)
set tag(508,1)
)

set tag(258,0)
jig npc(10)
tb(7252)

#check if want to buy
if(check tag(258)) then(

alter npc(10,NPCstat:script,0)
wait(3)
set tag(258,0)
tb(6596)
if(check tag(258)) then(use shop(5))
else( itemrorc )
wait(1)
alter npc(10,NPCstat:script,270)

)#end check to buy

#don't want to buy
else(
jig npc(10)
tb(7253)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, shodachests, begin
suspend player
suspend npcs
suspend obstruction

#fourth key is gained from defeating thief in bottom-left

#top-left key 1
if((herox(0)==27,and,heroy(0)==43),or,(herox(0)==28,and,heroy(0)==42),or,(herox(0)==27,and,heroy(0)==41),or,(herox(0)==26,and,heroy(0)==42)) then(
	set npc position(npc at spot(27,42),1,0)
	set tag(515,1)
	tb(1053)
	get item(29,1)
)

#above maze key 2
if((herox(0)==133,and,heroy(0)==54),or,(herox(0)==134,and,heroy(0)==53),or,(herox(0)==133,and,heroy(0)==52),or,(herox(0)==132,and,heroy(0)==53)) then(
	set npc position(npc at spot(133,53),1,0)
	set tag(516,1)
	tb(1053)
	get item(29,1)
)

#above maze key 3
if((herox(0)==156,and,heroy(0)==79),or,(herox(0)==157,and,heroy(0)==78),or,(herox(0)==156,and,heroy(0)==77),or,(herox(0)==155,and,heroy(0)==78)) then(
	set npc position(npc at spot(156,78),1,0)
	set tag(517,1)
	tb(1053)
	get item(29,1)
)

#top-left valid icon 1
if((herox(0)==45,and,heroy(0)==68),or,(herox(0)==46,and,heroy(0)==67),or,(herox(0)==45,and,heroy(0)==66),or,(herox(0)==44,and,heroy(0)==67)) then(
	set npc position(npc at spot(45,67),1,0)
	set tag(518,1)
	tb(7262)
	get item(237,1)
)

#top-right LOCKED hero icon 2
if((herox(0)==105,and,heroy(0)==55),or,(herox(0)==106,and,heroy(0)==54),or,(herox(0)==105,and,heroy(0)==53),or,(herox(0)==104,and,heroy(0)==54)) then(
	set npc position(npc at spot(105,54),1,0)
	set tag(519,1)
	variable(rand)
	set variable(rand,random(232,235))
	if(rand==232) then(
		tb(7265)
		get item(232,1)
	)
	if(rand==233) then(
		tb(7266)
		get item(233,1)
	)
	if(rand==234) then(
		tb(7267)
		get item(234,1)
	)
	if(rand==235) then(
		tb(7268)
		get item(235,1)
	)
)

#top-right LOCKED living icon 3
if((herox(0)==135,and,heroy(0)==32),or,(herox(0)==136,and,heroy(0)==31),or,(herox(0)==135,and,heroy(0)==30),or,(herox(0)==134,and,heroy(0)==31)) then(
	set npc position(npc at spot(135,31),1,0)
	set tag(520,1)
	variable(rand2)
	set variable(rand2,random(240,243))
	if(rand2==240) then(
		tb(7269)
		get item(240,1)
	)
	if(rand2==241) then(
		tb(7270)
		get item(241,1)
	)
	if(rand2==242) then(
		tb(7271)
		get item(242,1)
	)
	if(rand2==243) then(
		tb(7272)
		get item(243,1)
	)
)

#top-right truth icon 4
if((herox(0)==117,and,heroy(0)==5),or,(herox(0)==118,and,heroy(0)==4),or,(herox(0)==117,and,heroy(0)==3),or,(herox(0)==116,and,heroy(0)==4)) then(
	set npc position(npc at spot(117,4),1,0)
	set tag(521,1)
	tb(7263)
	get item(238,1)
)

#bottom-left logic icon 5
if((herox(0)==49,and,heroy(0)==129),or,(herox(0)==50,and,heroy(0)==128),or,(herox(0)==49,and,heroy(0)==127),or,(herox(0)==48,and,heroy(0)==128)) then(
	set npc position(npc at spot(49,128),1,0)
	set tag(522,1)
	tb(7264)
	get item(239,1)
)

resume obstruction
resume npcs
resume player
end
###

#########################
script, shodadoors, begin
suspend player
suspend npcs
suspend obstruction

variable(i)
variable(d1)
variable(d2)
variable(yyy)

#busted lock
if(herox(0)==63,and,heroy(0)==53) then(
	set hero direction(0,up)
	jig hero(0)
	tb(7137)
	set tag(492,1)
)

#locked door 1
if(herox(0)==20,and,heroy(0)==137) then(
	set hero direction(0,up)
	if (inventory(29)==0) then(
		tb(84)
	)

	if (inventory(29)>>0) then(
		set tag(15,0)
		tb(222)
		if(check tag(15)) then(
			delete item(29,1)
			suspend npc walls
			set variable (yyy,hero pixel y (0))
			set variable (d1,NPC at spot (herox(0),heroy(0)))
			set variable (d2,NPC at spot (herox(0),heroy(0)--1))
			for (i,1,20,1) do(
				put npc (d1,hero pixel x(0),yyy--i)
				put npc (d2,hero pixel x(0),yyy--20--i)
				wait (1)
			)
			set npc position (d1,0,2)
			set npc position (d2,0,2)
			resume npc walls
			set tag(523,1)
			write pass block(herox(0),heroy(0),0)
			create npc(35,20,136)
		)
	)
)

#locked door 2
if(herox(0)==99,and,heroy(0)==65) then(
	set hero direction(0,up)
	if (inventory(29)==0) then(
		tb(84)
	)

	if (inventory(29)>>0) then(
		set tag(15,0)
		tb(222)
		if(check tag(15)) then(
			delete item(29,1)
			suspend npc walls
			set variable (yyy,hero pixel y (0))
			set variable (d1,NPC at spot (herox(0),heroy(0)))
			set variable (d2,NPC at spot (herox(0),heroy(0)--1))
			for (i,1,20,1) do(
				put npc (d1,hero pixel x(0),yyy--i)
				put npc (d2,hero pixel x(0),yyy--20--i)
				wait (1)
			)
			set npc position (d1,0,2)
			set npc position (d2,0,2)
			resume npc walls
			set tag(524,1)
			write pass block(herox(0),heroy(0),0)
			create npc(35,99,64)
		)
	)
)

#locked door 3
if(herox(0)==117,and,heroy(0)==41) then(
	set hero direction(0,up)
	if (inventory(29)==0) then(
		tb(84)
	)

	if (inventory(29)>>0) then(
		set tag(15,0)
		tb(222)
		if(check tag(15)) then(
			delete item(29,1)
			suspend npc walls
			set variable (yyy,hero pixel y (0))
			set variable (d1,NPC at spot (herox(0),heroy(0)))
			set variable (d2,NPC at spot (herox(0),heroy(0)--1))
			for (i,1,20,1) do(
				put npc (d1,hero pixel x(0),yyy--i)
				put npc (d2,hero pixel x(0),yyy--20--i)
				wait (1)
			)
			set npc position (d1,0,2)
			set npc position (d2,0,2)
			resume npc walls
			set tag(525,1)
			write pass block(herox(0),heroy(0),0)
			create npc(35,117,40)
		)
	)
)

#locked door 4
if(herox(0)==135,and,heroy(0)==41) then(
	set hero direction(0,up)
	if (inventory(29)==0) then(
		tb(84)
	)

	if (inventory(29)>>0) then(
		set tag(15,0)
		tb(222)
		if(check tag(15)) then(
			delete item(29,1)
			suspend npc walls
			set variable (yyy,hero pixel y (0))
			set variable (d1,NPC at spot (herox(0),heroy(0)))
			set variable (d2,NPC at spot (herox(0),heroy(0)--1))
			for (i,1,20,1) do(
				put npc (d1,hero pixel x(0),yyy--i)
				put npc (d2,hero pixel x(0),yyy--20--i)
				wait (1)
			)
			set npc position (d1,0,2)
			set npc position (d2,0,2)
			resume npc walls
			set tag(526,1)
			write pass block(herox(0),heroy(0),0)
			create npc(35,135,40)
		)
	)
)

resume obstruction
resume npcs
resume player
end
###

###########################
script, scarfsixone1, begin

wait(20)
alter npc(8,NPCstat:picture,519)
set npc direction(8,right)
wait(5)
walk npc(8,up,6)
wait for npc(8)
set tag(528,1)

end
###

###########################
script, scarfsixone2, begin
suspend player
suspend npcs
suspend obstruction

jig horror
tb(4216)
wait(10)
tb(4217)
wait(2)
tb(4218)

resume obstruction
resume npcs
resume player
end
###

###########################
script, scarfsixone3, begin
suspend player
suspend npcs
suspend obstruction

jig horror
tb(4219)
wait(10)
tb(4220)
wait(2)
tb(4221)

resume obstruction
resume npcs
resume player
end
###

###########################
script, scarfsixone4, begin

walk npc(9,right,10)
#hidden item appears
set tag(566,1)
wait for npc(9)
walk npc(9,up,2)
wait for npc(9)
walk npc(9,right,1)
wait for npc(9)
walk npc(9,up,6)
wait for npc(9)
set tag(529,1)

end
###

###########################
script, scarfsixone5, begin
suspend player
suspend npcs
suspend obstruction

stop song

focus camera(77,8,2)
set hero speed(0,2)
walk hero to x(0,77)
wait for hero(0)
walk hero(0,up,1)
wait for hero(0)
set hero frame(0,0)

#doesn't seem to work, changing to a walkabout picture check instead
#if(check tag(41)) then(
#if(get hero picture(find hero(0),outsidebattle)<>98) then(
#if(find hero(6)==false,or,find hero(6)>>3) then(
if(check tag(642)==false) then(
	hero clothes
	set party out
	swap by position(find hero(0),0)
)

if(check tag(85)) then(set npc position(1,herox(0),heroy(0)))
if(check tag(86)) then(set npc position(2,herox(0),heroy(0)))
if(check tag(87)) then(set npc position(3,herox(0),heroy(0)))
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait(2)
set npc direction(3,up)
wait for camera

wait(25)

jig horror
play song(59)
tb(4222)
wait(15)
tb(4223)
if(check tag(85)) then(
	jig npc(1)
	tb(4224)
)
wait(15)
set npc direction(10,left)
wait(4)
set npc direction(10,down)
wait(10)
tb(4225)
wait(5)
walk npc(10,down,1)
wait for npc(10)
set npc frame(10,0)
wait(10)
tb(4226)
wait(10)
jig npc(10)
tb(4227)
wait(2)
set npc frame(10,1)
set npc direction(11,up)
put npc(11,77*20,(7*20)+5)
wait(2)
set npc frame(10,0)
put npc(11,77*20,(7*20)+9)
put npc(12,77*20,8*20)
wait(2)
put npc(11,77*20,(7*20)+11)
put npc(12,77*20,9*20)
wait(2)
put npc(11,77*20,(7*20)+15)
put npc(12,77*20,10*20)
wait(1)
put npc(11,77*20,(7*20)+20)
set npc position(12,0,0)
wait(1)
put npc(11,77*20,(7*20)+30)
wait(1)
put npc(11,77*20,(7*20)+45)
wait(1)
put npc(11,77*20,(7*20)+70)
wait(1)
set npc position(11,0,0)
jig hero(0)
jig gahn2(8)
jig gahn
wait(2)
tb(4228)
get item(20,1)
wait(2)
jig horror
tb(4229)
wait(10)
set npc direction(10,right)
wait(3)
set npc direction(10,up)
wait(10)
tb(4230)
alter npc(10,NPCstat:movespeed,1)
wait(10)
walk npc(10,up,5)
wait(5)
tb(4231)
wait(2)
wait for npc(10)
stop song
wait(2)
focus camera(herox(0),heroy(0))
walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for npc(1)
set npc position(1,0,0)
wait for npc(2)
set npc position(2,0,0)
wait for npc(3)
set npc position(3,0,0)
set hero speed(0,hspeed)
set tag(530,1)
if(check tag(642)==false) then(set party in)
wait for camera
camera follows hero(0)

play song(68)

resume obstruction
resume npcs
resume player
end
###

########################
script, scarf2end, begin
suspend player
suspend npcs
suspend obstruction

set tag(539,1)
tb(7273)
get item(21,1)
wait(3)
palout(10)
set hero position(0,40,3)
wait(1)
palin(10)

resume obstruction
resume npcs
resume player
end
###

######################
script, whisper, begin
suspend player
suspend npcs
suspend obstruction
suspend npc walls

variable(spot)
variable(rand)
set variable(rand,random(1,3))
if(rand==1) then(set variable(spot,11))
if(rand==2) then(set variable(spot,25))
if(rand==3) then(set variable(spot,39))

pan camera(south,0,0)
walk hero(0,up,1)
wait for hero(0)
palout(2)
camera follows hero(0)
set hero position(0,spot,110)
wait(1)
pan camera(south,0,0)
set hero position(0,spot,116)
wait(1)
palin(2)
walk hero(0,up,5)
wait for hero(0)

alter npc(6,NPCstat:picture,522)
alter npc(6,NPCstat:movespeed,10)
set npc position(6,herox(0)--2,heroy(0)--6)
walk npc(6,down,4)
wait for npc(6)
walk npc(6,right,2)
walk npc(6,down,2)
wait for npc(6)
alter npc(6,NPCstat:picture,521)
alter npc(6,NPCstat:movespeed,2)
walk npc(6,up,1)
set hero position(0,10,10)
set npc direction(6,down)
wait for npc(6)
alter npc(6,NPCstat:movespeed,5)
alter npc(6,NPCstat:picture,522)
walk npc(6,up,2)
walk npc(6,right,9)
wait for npc(6)

palout(2)
camera follows hero(0)
wait(1)
pan camera(south,0,0)
set hero position(0,0,1)
wait(1)
palin(2)

set npc position(6,1,10)
walk npc(6,right,7)
wait for npc(6)
walk npc(6,down,2)
walk npc(6,right,2)
wait for npc(6)
set hero position(0,10,12)
alter npc(6,NPCstat:picture,521)
alter npc(6,NPCstat:movespeed,2)
walk npc(6,up,1)
set npc direction(6,down)
wait for npc(6)
alter npc(6,NPCstat:movespeed,10)
alter npc(6,NPCstat:picture,522)
walk npc(6,right,2)
walk npc(6,up,7)
wait for npc(6)
set npc position(6,0,1)

jig horror
tb(4236)
wait(2)
tb(4237)

resume npc walls
resume obstruction
resume npcs
resume player
end
###

#############################
script, lavascarfintro, begin

focus camera(27,20,2)
set hero speed(0,4)
hero clothes
wait(2)
walk hero(0,up,5)
wait for hero(0)
set hero frame(0,0)
set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
if(check tag(87)) then(set npc position(3,herox(0),heroy(0)))
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait(2)
set npc direction(3,up)
wait for camera
wait(15)

play song(59)

palout(1)
palin(1)
tb(4248)
wait(2)
tb(4249)
jig hero(0)
tb(4250)
wait(2)
alter npc(4,NPCstat:picture,519)
jig npc(4)
jig npc(4)
tb(4251)
jig npc(2)
tb(4252)
jig npc(1)
tb(4253)
jig npc(4)
tb(4254)
wait(2)
set npc direction(4,right)
wait(5)
jig npc(4)
tb(4255)
wait(2)
tb(4256)
wait(2)
set npc direction(4,down)
jig npc(4)
tb(4257)
play song(65)
palout(1)
set tag(540,1)
wait(1)
palin(1)
tb(4258)

wait(2)
focus camera(herox(0),heroy(0))
walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for npc(1)
set npc position(1,0,1)
wait for npc(2)
set npc position(2,1,1)
wait for npc(3)
set npc position(3,2,1)
set party in
set hero speed(0,hspeed)
wait for camera
camera follows hero(0)

end
###

########################
script, lavascarf, begin
suspend player
suspend npcs
suspend obstruction

battleflash
ff(221)

if(check tag(541)) then(
stop song
palout(1)
set hero position(0,27,20)
wait(1)
pan camera(south,0,0)
hero clothes
set party out
swap by position(find hero(0),0)
set npc position(5,27,19)
set hero position(0,27,23)
set npc position(1,28,23)
set npc position(2,26,23)
if(check tag(87)) then(set npc position(3,27,24))
set hero direction(0,up)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
set npc direction(5,up)
set npc frame(1,0)
set npc frame(2,0)
set npc frame(3,0)
set npc frame(5,0)
wait(1)
play song(59)
palin(1)

jig npc(5)
tb(4260)
wait(2)
set npc direction(5,right)
jig npc(5)
tb(4261)
wait(2)
tb(4262)

palout(1)
set tag(542,1)
wait(1)
palin(1)
stop song

focus camera(herox(0),heroy(0),4)
wait for camera

wait(5)
set npc direction(2,right)
jig npc(2)
tb(4263)
wait(15)
tb(4264)
jig npc(2)
tb(4265)
jig npc(1)
tb(4266)
wait(2)
set hero direction(0,right)
wait(2)
set hero direction(0,down)
jig hero(0)
tb(4267)

walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for npc(1)
set npc position(1,0,0)
wait for npc(2)
set npc position(2,0,0)
wait for npc(3)
set npc position(3,0,0)
set party in
set hero speed(0,hspeed)
camera follows hero(0)
)

else(
palout(1)
variable(pos)
if(heroy(0)<<14) then(set variable(pos,2))
else(
	if(herox(0)<<27) then(set variable(pos,1))
	else(set variable(pos,3))
)
if(pos==1) then(set npc position(5,27,8))
if(pos==2) then(set npc position(5,37,18))
if(pos==3) then(set npc position(5,19,18))
wait(1)
palin(1)
tb(4259)
)

resume obstruction
resume npcs
resume player
end
###

############################
script, scarfwanderer, begin
suspend player
suspend npcs
suspend obstruction

#if haven't finished scarf1
if(check tag(530)==false) then(tb(7274))
else(
	#if haven't finished scarf2
	if(check tag(539)==false) then(tb(7275))
	else(
		#if haven't finished scarf3
		if(check tag(542)==false) then(tb(7276))
	)
)

#it is go time!
if(check tag(530),and,check tag(539),and,check tag(542)) then(
	#already talked
	if(check tag(543)) then(
		jig npc(4)
		tb(4269)
		jig hero(0)
		tb(4277)
		jig npc(4)
		tb(4285)
		walk npc to x(4,herox(0))
		wait for npc(4)
		walk npc to y(4,heroy(0))
		wait for npc(4)
		set npc position(4,0,0)
		set tag(544,1)
		set tag(648,1)
	)

	#init
	else(
		jig npc(4)
		tb(4268)
		tb(4269)
		jig hero(0)
		tb(4270)
		jig npc(4)
		tb(4274)
		tb(4275)
		jig npc(4)
		tb(4276)
		wait(5)
		jig hero(0)
		tb(4277)
		jig npc(4)
		tb(4285)
		walk npc to x(4,herox(0))
		wait for npc(4)
		walk npc to y(4,heroy(0))
		wait for npc(4)
		set npc position(4,0,0)
		set tag(543,1)
		set tag(544,1)
		set tag(648,1)
	)
)

resume obstruction
resume npcs
resume player
end
###

#######################
script, exitcave, begin
set tag(648,0)
set npc position(4,herox(0),heroy(0))
walk npc(4,up,2)
wait(2)
set hero direction(0,left)
wait(2)
set hero direction(0,up)
wait for npc(4)
set npc frame(4,0)
set npc direction(4,right)
wait(2)
set npc direction(4,down)
jig npc(4)
tb(4286)
set tag(544,0)

pan camera(south,0,0)
set hero direction(0,right)
wait(2)
walk hero(0,down,1)
wait for hero(0)
palout(2)
camera follows hero(0)
teleport to map(58+poff,83,96)
set hp
wait(1)
pan camera(south,0,0)
set hero position(0,83,94)
wait(1)
palin(2)
walk hero(0,down,2)
wait for hero(0)
camera follows hero(0)
end
###

#############################
script, prematurescarf, begin
suspend player
suspend npcs
suspend obstruction

set tag(648,0)
alter npc(4,NPCstat:movespeed,4)
set npc position(4,herox(0),heroy(0))
walk npc(4,down,1)
wait(1)
stop song
show text box(4287)
wait for npc(4)
walk npc to x(4,152)
wait for npc(4)
walk npc(4,down,5)
wait for npc(4)
set npc position(4,0,0)
set tag(544,0)
set tag(545,1)
set tag(648,1)
wait for text box

resume obstruction
resume npcs
resume player
end
###

#########################
script, meetbackup, begin
suspend player
suspend npcs
suspend obstruction

tb(4288)
stop song
wait(2)
set hero speed(0,2)
focus camera(54,64,2)
walk hero to y(0,65)
wait for hero(0)
walk hero to x(0,54)
wait for hero(0)
walk hero to y(0,64)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,right)
pleft
wait for camera

wait(10)
jig npc(2)
tb(4289)
wait(2)
set npc direction(5,down)
wait(2)
set npc direction(5,left)
wait(2)
jig npc(5)
tb(4290)
wait(15)
tb(4291)
jig hero(0)
play song(91)
tb(4292)
jig npc(5)
show text box(4293)
wait(5)
set npc direction(5,down)
wait(3)
set npc direction(5,right)
wait for text box
jig npc(3)
tb(4294)
wait(2)
set npc direction(5,up)
wait(2)
set npc direction(5,left)
tb(4295)
jig npc(3)
tb(4296)
jig npc(5)
tb(4297)
tb(4298)
wait(2)
set npc direction(5,up)
wait(2)
set npc direction(5,right)
wait(10)
jig npc(5)
tb(4299)
wait(10)
tb(4300)
wait(10)
set npc direction(5,down)
wait(2)
set npc direction(5,left)
wait(2)
jig npc(5)
tb(4301)
jig npc(1)
tb(4302)
jig npc(2)
tb(4303)
jig hero(0)
tb(4304)
jig npc(5)
tb(4305)

walk npc(5,left,1)
wait for npc(5)
walk npc(5,left,1)
ppleft
wait for npc(5)
set npc position(5,3,1)
set hero speed(0,hspeed)
camera follows hero(0)

set tag(548,1)

resume obstruction
resume npcs
resume player
end
###

#########################
script, badfeeling, begin
suspend player
suspend npcs
suspend obstruction

walk hero to x(0,93)
wait for hero(0)

pan camera(south,0,0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
set npc position(4,herox(0),heroy(0))
set party out
swap by position(find hero(0),0)
set hero speed(0,4)
walk hero(0,down,1)
walk npc(1,right,1)
set npc direction(2,right)
walk npc(3,left,1)
walk npc(4,up,1)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,left)
wait for npc(1)
walk npc(1,down,1)
walk npc(2,right,1)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,down)
wait for npc(4)
set npc frame(4,0)
set npc direction(4,right)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,left)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,down)
wait(2)
set hero direction(0,up)
set npc direction(4,down)

jig hero(0)
play song(15)
tb(4306)
jig npc(1)
tb(4307)
wait(2)
set hero direction(0,right)
jig hero(0)
tb(4308)
jig npc(1)
tb(4309)
jig hero(0)
show text box(4310)
wait(5)
set hero direction(0,up)
wait for text box
jig npc(4)
tb(4311)
wait(2)
set npc direction(3,right)
jig npc(3)
show text box(4312)
wait(3)
set npc direction(2,left)
wait for text box
jig npc(2)
tb(4313)
jig npc(4)
tb(4314)
wait(2)

walk hero(0,up,1)
walk npc(1,left,1)
walk npc(2,left,1)
walk npc(3,right,1)
walk npc(4,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
walk npc(1,up,1)
wait for npc(2)
set npc position(2,1,1)
wait for npc(3)
set npc position(3,2,1)
wait for npc(4)
set npc position(4,3,1)
wait for npc(1)
set npc position(1,0,1)
set party in
set hero speed(0,hspeed)
camera follows hero(0)

resume obstruction
resume npcs
resume player
end
###

#####################
script, badhmm, begin
suspend player
suspend npcs
suspend obstruction

walk hero to y(0,58)
wait for hero(0)

pan camera(south,0,0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
set npc position(4,herox(0),heroy(0))
set party out
swap by position(find hero(0),0)
set hero speed(0,4)
walk hero(0,down,1)
walk npc(1,right,1)
set npc direction(2,right)
walk npc(3,left,1)
walk npc(4,up,1)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,left)
wait for npc(1)
walk npc(1,down,1)
walk npc(2,right,1)
wait for npc(3)
set npc frame(3,0)
wait for npc(4)
set npc frame(4,0)
set npc direction(4,left)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,left)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,down)
wait(2)
set npc direction(2,left)

stop song
tb(4315)
jig npc(2)
tb(4316)
wait(7)
set npc direction(3,down)
wait(2)
set npc direction(3,right)
jig npc(3)
play song(19)
tb(4317)
jig npc(1)
tb(4318)
jig npc(3)
tb(4319)
show text box(4320)
wait(5)
set hero direction(0,up)
wait for text box
jig hero(0)
show text box(4321)
wait(4)
set npc direction(4,down)
wait for text box
jig npc(4)
show text box(4322)
wait(3)
set npc direction(1,up)
wait for text box
jig npc(3)
tb(4323)
jig npc(3)
tb(4324)
jig npc(4)
tb(4325)

walk hero(0,up,1)
walk npc(1,left,1)
walk npc(2,left,1)
walk npc(3,right,1)
walk npc(4,down,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
walk npc(1,up,1)
wait for npc(2)
set npc position(2,1,1)
wait for npc(3)
set npc position(3,2,1)
wait for npc(4)
set npc position(4,3,1)
wait for npc(1)
set npc position(1,0,1)
set party in
set hero speed(0,hspeed)
camera follows hero(0)

resume obstruction
resume npcs
resume player
end
###

#######################
script, thisisit, begin
suspend player
suspend npcs
suspend obstruction

thisisit1
thisisit2
thisisit3

resume obstruction
resume npcs
resume player
end
###

########################
script, thisisit1, begin

play song(17)

walk hero to x(0,100)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,up)

set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,up)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,up)

set npc position(4,herox(0),heroy(0))
walk npc(4,up,1)
wait for npc(4)
set npc frame(4,0)

wait(15)
alter npc(2,NPCstat:movespeed,2)
walk npc(2,up,1)
wait(2)
show text box(4326)
wait for npc(2)
set npc frame(2,0)
wait for text box
set npc direction(1,left)
jig npc(1)
tb(4327)
wait(15)
set npc direction(2,right)
wait(2)
walk npc(2,down,1)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,left)
wait(2)
set npc direction(2,up)
wait(15)
jig npc(3)
show text box(4328)
wait(3)
set npc direction(1,up)
wait for text box

wait(2)
walk npc(4,up,1)
wait for npc(4)
set npc frame(4,0)
wait(10)
jig npc(4)
tb(4329)
wait(2)
set npc direction(4,left)
wait(2)
set npc direction(4,down)
jig npc(4)
stop song
tb(4330)
jig npc(4)
jig npc(4)
tb(4331)
wait(15)
jig hero(0)
tb(4332)
wait(5)
jig npc(4)
tb(4333)
suspend box advance
variable(i)
alter npc(4,NPCstat:picture,520)
set npc direction(4,right)
show text box(4334)
for(i,1,5,1) do(
wait(3)
set npc frame(4,1)
wait(3)
set npc frame(4,0)
)
advance text box
show text box(4335)
alter npc(4,NPCstat:picture,523)
set npc direction(4,left)
wait(2)
alter npc(4,NPCstat:picture,520)
for(i,1,15,1) do(
wait(1)
set npc frame(4,1)
wait(1)
set npc frame(4,0)
)
advance text box
resume box advance
jig hero(0)
play song(59)
tb(4336)
alter npc(4,NPCstat:picture,523)
set npc direction(4,up)
wait(25)
jig npc(4)
tb(4337)
wait(5)
set npc direction(4,left)
wait(2)
set npc direction(4,down)
wait(5)
alter npc(4,NPCstat:movespeed,1)
variable(cape)
alter npc(4,NPCstat:picture,524)
set npc direction(4,down)
set variable(cape,create npc(4,npcx(4),npcy(4)))
walk npc(cape,right,1)
wait for npc(cape)
walk npc(cape,right,1)
set npc direction(cape,up)
wait for npc(cape)
destroy npc(cape)
alter npc(4,NPCstat:picture,525)
wait(5)
tb(4338)
jig npc(4)
tb(4339)
jig hero(0)
tb(4340)
alter npc(4,NPCstat:movespeed,10)
walk npc(4,down,1)
wait for npc(4)
set npc frame(4,0)
tb(4341)
tb(4342)
jig npc(2)
tb(4343)
jig hero(0)
tb(4344)
alter npc(4,NPCstat:movespeed,2)
wait(2)
set npc direction(4,right)
wait(2)
walk npc(4,up,1)
wait(3)
show text box(4345)
wait for npc(4)
set npc frame(4,0)
wait for text box
jig hero(0)
tb(4346)
wait(1)
set npc direction(4,right)
wait(1)
set npc direction(4,down)
alter npc(4,NPCstat:picture,524)
set npc direction(4,left)
variable(j)
for(j,1,7,1) do(
wait(1)
set npc frame(4,1)
wait(1)
set npc frame(4,0)
)
for(j,1,3,1) do(
wait(2)
set npc frame(4,1)
wait(2)
set npc frame(4,0)
)
play song(15)
tb(4347)
tb(4348)
palout(1)
reset palette
update palette
palout(1)
alter npc(4,NPCstat:picture,525)
set npc direction(4,down)
reset palette
update palette
jig horror
tb(4349)
jig npc(4)
tb(4350)
wait(2)
set npc direction(4,left)
wait(2)
set npc direction(4,up)
stop song
show text box(4351)
variable(g1)
variable(g2)
variable(g3)
variable(g4)
variable(g5)
variable(g6)
variable(g7)
variable(g8)
variable(g9)
set variable(g1,npc at spot(97,11))
set variable(g2,npc at spot(98,10))
set variable(g3,npc at spot(98,9))
set variable(g4,npc at spot(99,10))
set variable(g5,npc at spot(100,9))
set variable(g6,npc at spot(100,10))
set variable(g7,npc at spot(101,10))
set variable(g8,npc at spot(102,11))
set variable(g9,npc at spot(103,10))
variable(cx)
variable(cy)
set variable(cx, camera pixel x)
set variable(cy, camera pixel y)
wait for text box
play song(8)
variable(k)
for(k,1,8,1) do(
wait(2)
put camera(cx--10,cy)
wait(2)
put camera(cx+10,cy)
)
for(k,1,16,1) do(
wait(1)
put camera(cx+random(-20,20),cy+random(-5,5))
)
walk npc to x(g1,npcx(4))
walk npc to y(g1,npcy(4))
walk npc to x(g2,npcx(4))
walk npc to y(g2,npcy(4))
walk npc to x(g3,npcx(4))
walk npc to y(g3,npcy(4))
walk npc to x(g4,npcx(4))
walk npc to y(g4,npcy(4))
walk npc to x(g5,npcx(4))
walk npc to y(g5,npcy(4))
walk npc to x(g6,npcx(4))
walk npc to y(g6,npcy(4))
walk npc to x(g7,npcx(4))
walk npc to y(g7,npcy(4))
walk npc to x(g8,npcx(4))
walk npc to y(g8,npcy(4))
walk npc to x(g9,npcx(4))
walk npc to y(g9,npcy(4))
for(k,1,35,1) do(
wait(1)
put camera(cx+random(-40,40),cy+random(-20,20))
)
put camera(cx,cy)

#equiping leech icons, SNEAKY!!
unequip(0,2)
unequip(1,3)
unequip(2,4)
unequip(3,5)
get item(244,1)
get item(245,1)
get item(246,1)
get item(247,1)
force equip(0,2,244)
force equip(1,3,245)
force equip(2,4,246)
force equip(3,5,247)
end
###
########################
script, thisisit2, begin
set party in
battleflash(1)
set tag(546,1)
ff(405+poff)
stop song
set party out
swap by position(find hero(0),0)
end
###
########################
script, thisisit3, begin
set npc direction(4,up)
alter npc(4,NPCstat:picture,526)
set npc frame(4,1)
wait(15)
play song(17)
tb(4352)
wait(10)
tb(4353)
pan camera(down,1,1)
set hero speed(0,2)
walk hero(0,up,1)
wait for hero(0)
set hero frame(0,0)
wait for camera
wait(10)
jig hero(0)
tb(4354)
get item(23,1)
wait(10)
set hero direction(0,right)
set hero picture(0,374)
wait(2)
set hero direction(0,down)
wait(2)
set npc frame(4,0)
jig npc(4)
tb(4355)
wait(2)
set hero picture(0,375)
set hero frame(0,1)
wait(10)
set hero picture(0,376)
wait(2)
tb(4356)
stop song
variable(o)
variable(nx)
variable(ny)
set variable(nx,npc pixel x(4))
set variable(ny,npc pixel y(4))
wait(10)
set npc frame(4,0)
wait(5)
for(o,1,5,1) do(
put npc(4,nx+random(-2,2),ny+random(-2,2))
wait(2)
)
put npc(4,nx,ny)
wait(5)
tb(4357)
set hero direction(0,left)
set hero frame(0,0)
set hero picture(0,230)
wait(1)
set hero direction(0,up)
variable(cxx)
variable(cyy)
set variable(cxx,camera pixel x)
set variable(cyy,camera pixel y)
jig hero(0)
play song(82)
show text box(4358)
for(o,1,5,1) do(
put camera(cxx+10,cyy)
wait(1)
put camera(cxx--10,cyy)
wait(1)
)
put camera(cxx,cyy)
wait for text box
wait(15)
set npc frame(4,0)
wait(15)
for(o,1,5,1) do(
put npc(4,nx+random(-2,2),ny+random(-2,2))
wait(2)
)
put npc(4,nx,ny)
set npc direction(4,right)
wait(10)
set npc frame(4,1)
wait(5)
for(o,1,5,1) do(
put npc(4,nx+random(-2,2),ny+random(-2,2))
wait(2)
)
put npc(4,nx,ny)
set npc direction(4,down)
wait(15)
set npc frame(4,0)
wait(5)
jig hero(0)
tb(4359)
tb(4360)
wait(15)
set npc frame(4,1)
wait(5)
tb(4361)
wait(3)
tb(4362)
wait(5)
set npc frame(4,0)
wait(5)
tb(4363)
wait(10)
tb(4364)
wait(2)
set npc frame(4,1)
wait(2)
tb(4365)

wait(10)
stop song
palout(10)
suspend box advance
camera follows hero(0)
teleport to map(68,21,37)
stop song
wait(1)
pan camera(south,0,0)
alter npc(2,NPCstat:picture,134)
set npc direction(2,up)
set hero picture(0,0)
set npc position(2,18,38)
set npc position(10,21,36)
wait(10)

show backdrop(0)
wait(1)
palin(1)

textout(1)
show text box(4366)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)
show text box(4367)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)
show text box(4368)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)
show text box(4369)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box

wait(1)
palout(1)
show map
wait(10)

play song(88)

reset palette
greyscale palette
tweak palette (-40,-40,-40)
update palette
wait (15)
reset palette
greyscale palette
tweak palette (-20,-20,-20)
update palette
wait (15)
reset palette
greyscale palette
tweak palette (-10,-10,-10)
update palette
wait (15)
reset palette
greyscale palette
tweak palette (-5,-5,-5)
update palette
wait (15)
reset palette
greyscale palette
update palette


wait(20)
textout(1)
show text box(4370)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)

show text box(4371)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)

show text box(4372)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)

show text box(4373)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(5)

show text box(4374)
wait(2)
textin(2)
wait for key(usekey)
textout(2)
advance text box
wait(25)

palout(10)
show backdrop(0)
wait(1)
palin(2)

textout(1)
stop song
wait(15)
show text box(4375)
wait(2)
textin(4)
wait for key(usekey)
textout(4)
advance text box

wait(10)
palout(1)
show map
resume box advance
set hero picture(0,230)
camera follows hero(0)
teleport to map(85+poff,100,5)
stop song
wait(1)
pan camera(south,0,0)
set npc position(8,3,1)
set hero position(0,100,12)
set npc position(1,101,13)
set npc position(3,100,14)
set npc position(2,99,13)
set npc position(4,100,11)
alter npc(4,NPCstat:picture,526)
set npc direction(4,right)
set npc direction(1,up)
set npc direction(2,up)
set npc direction(3,up)
set npc frame(4,1)
wait(1)
palin(10)

play song(17)

wait(15)
focus camera(100,10,1)
wait for camera
wait(20)
tb(4376)
tb(4377)
variable(p)
variable(nxxx)
variable(nyyy)
set variable(nxxx,npc pixel x(4))
set variable(nyyy,npc pixel y(4))
for(p,1,5,1) do(
put npc(4,nxxx+random(-3,3),nyyy+random(-3,3))
wait(1)
)
put npc(4,nxxx,nyyy)
tb(4378)
wait(5)
jig hero(0)
stop song
tb(4379)
wait(2)
pan camera(down,2,1)
wait for camera
wait(15)
jig hero(0)
tb(4380)
wait(20)
tb(4381)
set hero direction(0,right)
wait(3)
set hero direction(0,down)
wait(3)
walk hero(0,down,1)
wait for hero(0)

walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for npc(1)
set npc position(1,0,1)
wait for npc(2)
set npc position(2,1,1)
wait for npc(3)
set npc position(3,2,1)
set party in

set hero speed(0,hspeed)
set npc position(8,100,11)
set npc position(4,3,1)
end
###

#######################
script, itisover, begin
suspend player
suspend npcs
suspend obstruction

stop song

walk hero to x(0,100)
wait for hero(0)
set hero speed(0,4)
pan camera(south,0,0)

set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk hero(0,up,1)
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,right)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait(2)
set hero direction(0,down)
set npc direction(1,left)
set npc direction(2,right)
set npc direction(3,up)

jig npc(2)
tb(4382)
jig npc(1)
play song(91)
tb(4383)
tb(4384)
jig npc(1)
tb(4385)
jig hero(0)
show text box(4386)
alter npc(1,NPCstat:picture,381)
wait for text box
jig npc(1)
tb(4387)
jig npc(3)
tb(4388)
wait(25)
jig hero(0)
tb(4389)
wait(2)
alter npc(1,NPCstat:picture,233)
set npc direction(1,up)
wait(2)
set npc direction(2,up)
wait(10)
jig hero(0)
tb(4390)

walk hero(0,down,1)
walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
set npc position(1,0,1)
wait for npc(2)
set npc position(2,0,1)
wait for npc(3)
set npc position(3,0,1)
set party in
set hero speed(0,hspeed)
camera follows hero(0)

resume obstruction
resume npcs
resume player
end
###

###########################
script, goodbyescarf, begin
suspend player
suspend npcs
suspend obstruction

stop song

walk hero to y(0,76)
wait for hero(0)
set hero speed(0,4)

pan camera(south,0,0)

set party out
swap by position(find hero(0),0)
set npc position(1,herox(0),heroy(0))
set npc position(2,herox(0),heroy(0))
set npc position(3,herox(0),heroy(0))
walk hero(0,up,1)
walk npc(1,right,1)
walk npc(2,left,1)
walk npc(3,down,1)
wait for hero(0)
set hero frame(0,0)
set hero direction(0,right)
wait for npc(1)
set npc frame(1,0)
set npc direction(1,down)
wait for npc(3)
set npc frame(3,0)
set npc direction(3,left)
wait for npc(2)
set npc frame(2,0)
set npc direction(2,up)
wait(2)
set hero direction(0,down)
set npc direction(1,left)
set npc direction(2,right)
set npc direction(3,up)

jig npc(3)
play song(91)
tb(4391)
tb(4392)
jig hero(0)
tb(4393)
jig npc(2)
tb(4394)
jig npc(3)
tb(4395)
tb(4396)
wait(10)
jig npc(3)
tb(4397)
jig hero(0)
tb(4398)
tb(4399)
jig npc(1)
tb(4400)
jig npc(3)
tb(4401)
jig npc(2)
tb(4402)
tb(4403)
jig npc(1)
tb(4404)
jig npc(3)
tb(4405)
jig npc(2)
tb(4406)
jig npc(1)
tb(4407)

walk hero(0,down,1)
walk npc(1,left,1)
walk npc(2,right,1)
walk npc(3,up,1)
wait for hero(0)
set hero frame(0,0)
wait for npc(1)
set npc position(1,0,1)
wait for npc(2)
set npc position(2,0,1)
wait for npc(3)
set npc position(3,0,1)
set hero speed(0,hspeed)
set hero direction(0,left)

stop song

set hero direction(0,down)
wait(3)
set hero direction(0,right)
wait(10)
jig hero(0)
tb(4408)
set tag(547,1)
wait(15)
walk hero(0,left,1)
wait for hero(0)
walk hero(0,up,3)
wait for hero(0)

set party in
set hero speed(0,2)

wait(10)
palout(10)
set hero speed(0,hspeed)
camera follows hero(0)
teleport to map(72,152,95)
stop song
set pal(noon)
wait(1)
pan camera(south,0,0)
set hero position(0,152,101)
wait(1)
play song(69)
palin(2)
walk hero(0,up,2)
wait for hero(0)

resume obstruction
resume npcs
resume player
end
###

#######################
script, rorcsave, begin
suspend player
suspend npcs
suspend obstruction

jig npc(6)
tb(7299)
alter npc(6,NPCstat:script,0)
save game
wait(1)
alter npc(6,NPCstat:script,287)

resume obstruction
resume npcs
resume player
end
###

#######################
script, rorcavis, begin
suspend player
suspend npcs
suspend obstruction

#already have avis
if(check tag(266)) then(
	jig npc(8)
	tb(7307)
)

#get avis
else(
	#defeated rorc protector
	if(check tag(506)) then(
		jig npc(8)
		tb(7303)
		wait(2)
		tb(7304)
		wait(2)
		set tag(266,1)
		tb(7305)
		wait(2)
		if(check tag(261)==false) then(
			jig gahn
			tb(6616)
			set tag(261,1)
			get item(72,1)
		)
		wait(2)
		jig npc(8)
		tb(7306)
	)
	#have yet to defeat rorc protector
	else(
		jig npc(8)
		tb(7301)
		tb(7302)
	)
)

resume obstruction
resume npcs
resume player
end
###

###################
script, hunt, begin
suspend player
suspend npcs
suspend obstruction

itemhunt

resume obstruction
resume npcs
resume player
end
###

#########################
script, shodaspunk, begin
suspend player
suspend npcs
suspend obstruction

#part 2
if(check tag(498),and,check tag(499)==false) then(
	stop song
	pan camera (right,9,10)
	walk hero (0,right,3)
	alter npc(34,NPCstat:movespeed,4)
	alter npc(34,NPCstat:movetype,NPCmovetype:chaseyou)
	variable(ninny1)
	variable(ninny2)
	variable(ninny3)
	variable(ninny4)
	set variable(ninny1,create npc(34,47,160))
	set variable(ninny2,create npc(34,48,161))
	set variable(ninny3,create npc(34,48,163))
	set variable(ninny4,create npc(34,47,164))
	variable(spunk)
	set variable(spunk,create npc(33,39,162,right))
	wait for camera
	#set pal(4)
	pan camera (right,9,10)
	resume obstruction
	resume npcs
	wait for camera
	wait for hero (0)

	play song(8)
	jig npc(spunk)
	tb(7186)
	wait(2)
	show backdrop(1)
	wait(3)
	show map
	wait(3)
	show backdrop(1)
	wait(2)
	show map
	wait(2)
	show backdrop(1)
	wait(2)
	show map
	wait(2)
	show backdrop(1)
	destroy npc(ninny1)
	destroy npc(ninny2)
	destroy npc(ninny3)
	destroy npc(ninny4)
	stop song
	wait(3)
	show backdrop(0)
	wait(45)
	tb(7187)
	set hero position(0,45,161)
	set npc position(spunk,45,159)
	set hero direction(0,up)
	set npc direction(spunk,up)
	palout(1)
	show map
	wait(6)
	play song(97)
	palin(10)
	wait(10)
	jig npc(spunk)
	tb(7191)
	wait(2)
	tb(7192)
	wait(3)
	set npc direction(spunk,right)
	wait(2)
	set npc direction(spunk,down)
	jig npc(spunk)
	tb(7193)
	set tag(499,1)
)

#part 1
if(check tag(498)==false,and,check tag(499)==false) then(
	stop song
	variable(nin)
	set variable(nin,create npc(34,9,156,up))
	alter npc(34,NPCstat:movespeed,10)
	walk npc(nin,up,7)
	wait for npc(nin)
	show backdrop(1)
	destroy npc(nin)
	set hero stat (find hero(0),0,get hero stat(find hero(0),0,current stat)--100,current stat)
	if (get hero stat(find hero(0),0,current stat) << 1)
	then(set hero stat(find hero(0),0,1,currentstat))
	set hero stat (find hero(1),0,get hero stat(find hero(1),0,current stat)--100,current stat)
	if (get hero stat(find hero(1),0,current stat) << 1)
	then(set hero stat(find hero(1),0,1,currentstat))
	set hero stat (find hero(2),0,get hero stat(find hero(2),0,current stat)--100,current stat)
	if (get hero stat(find hero(2),0,current stat) << 1)
	then(set hero stat(find hero(2),0,1,currentstat))
	set hero stat (find hero(3),0,get hero stat(find hero(3),0,current stat)--100,current stat)
	if (get hero stat(find hero(3),0,current stat) << 1)
	then(set hero stat(find hero(3),0,1,currentstat))
	wait(6)
	show map
	wait(2)
	jig hero(0)
	tb(7182)
	set tag(498,1)
	play song(95)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, wobblerloot, begin
suspend player
suspend npcs
suspend obstruction

#if lost money and wobbler has been killed by party or charlock
if((herox(0)==3,and,heroy(0)==200,and,herodirection(0)==right),or,(herox(0)==4,and,heroy(0)==201),or,(herox(0)==5,and,heroy(0)==200)) then(
	get money(wobblermoney)
	set tag(605,1)
	destroy npc(npc at spot(4,200))
	tb(7422)
)

if(herox(0)==3,and,heroy(0)==200,and,herodirection(0)==up) then(
	#if wobbler has been killed by party
	if(check tag(606)==false,and,check tag(246)==false,and,check tag(442)) then(
		get money(200)
		set tag(606,1)
		destroy npc(npc at spot(3,199))
		tb(7420)
	)

	#if wobbler has been killed by charlocke
	if(check tag(607)==false,and,check tag(246),and,check tag(442)==false) then(
		get money(50)
		set tag(607,1)
		destroy npc(npc at spot(3,199))
		tb(7421)
	)
)
resume obstruction
resume npcs
resume player
end
###

######################
script, cybooks, begin

if(herox(0)==1,and,heroy(0)==92) then(tb(7615))
else(
if(herox(0)==2,and,heroy(0)==92) then(tb(7616))
)
do(
if(herox(0)==4,and,heroy(0)==92) then(tb(7617))
)
do(
if(herox(0)==5,and,heroy(0)==92) then(tb(7618))
)
do(
if(herox(0)==1,and,heroy(0)==95) then(tb(7619))
)
do(
if(herox(0)==2,and,heroy(0)==95) then(tb(7620))
)
do(
if(herox(0)==4,and,heroy(0)==95) then(tb(7621))
)
do(
if(herox(0)==5,and,heroy(0)==95) then(tb(7622))
)

end
###

##########################
script, limeverdant, begin
suspend player
suspend npcs

set tag(258,0)

#in cyport
if(currentmap==49,or,currentmap==50,or,currentmap==51,or,currentmap==52) then(
	if(check tag(622)) then(tb(7657))
	else(
		tb(7649)
		if(check tag(632)) then(
			tb(7650)
			if(check tag(258)) then(
				tb(7651)
				tb(7655)
				tb(7656)
				if(check equipment(find hero(0),3)==221) then(unequip(find hero(0),3))
				if(check equipment(find hero(1),3)==221) then(unequip(find hero(1),3))
				if(check equipment(find hero(2),3)==221) then(unequip(find hero(2),3))
				if(check equipment(find hero(3),3)==221) then(unequip(find hero(3),3))
				delete item(221,1)
				get item(222,1)
				set tag(622,1)
			)
		)
	)
)

#in rorc (actually, snowfall mountains, BUT YOU KNOW WHAT I MEAN)
if(currentmap==73,or,currentmap==74,or,currentmap==75,or,currentmap==76) then(
	if(check tag(624)) then(tb(7673))
	else(
		tb(7670)
		if(check tag(633)) then(
			tb(7671)
			if(check tag(258)) then(
				tb(7651)
				tb(7672)
				if(check equipment(find hero(0),4)==222) then(unequip(find hero(0),4))
				if(check equipment(find hero(1),4)==222) then(unequip(find hero(1),4))
				if(check equipment(find hero(2),4)==222) then(unequip(find hero(2),4))
				if(check equipment(find hero(3),4)==222) then(unequip(find hero(3),4))
				delete item(222,1)
				get item(223,1)
				set tag(624,1)
			)
		)
	)
)

#in rorc (yes, actually in RORC)
if(currentmap==77,or,currentmap==78,or,currentmap==79,or,currentmap==80) then(
	if(check tag(638),and,check tag(637),and,check tag(636),and,check tag(635),and,check tag(634)) then(
		tb(7684)
		set tag(634,0)
		set tag(635,0)
		set tag(636,0)
		set tag(637,0)
		set tag(638,0)
	)
	else(
	if(check tag(638)==false,and,check tag(637),and,check tag(636),and,check tag(635),and,check tag(634)) then(
		tb(7683)
		set tag(638,1)
	)
	if(check tag(637)==false,and,check tag(636),and,check tag(635),and,check tag(634)) then(
		tb(7682)
		set tag(637,1)
	)
	if(check tag(636)==false,and,check tag(635),and,check tag(634)) then(
		tb(7681)
		set tag(636,1)
	)
	if(check tag(635)==false,and,check tag(634)) then(
		tb(7680)
		set tag(635,1)
	)
	if(check tag(634)==false) then(
		tb(7679)
		set tag(634,1)
	)
	)
)

resume npcs
resume player
end
###

###########################
script, charfyreicon, begin
suspend player
suspend npcs

#char icon
if(check tag(640)==false,and,heroy(0)<<90) then(
	get item(212,1)
	set tag(640,1)
	tb(7753)
)
#fyre icon
if(check tag(641)==false,and,heroy(0)>>90) then(
	get item(213,1)
	set tag(641,1)
	tb(7754)
)

resume npcs
resume player
end
###

#########################
script, rorctrader, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)
jig npc(31)
tb(7775)
if(check tag(258)) then( trader(7777,20) )
else(
wait(2)
jig npc(31)
tb(7776)
)

resume obstruction
resume npcs
resume player
end
###

##################################
script, unknowntombautoload, begin

#if the player has finished the unknown tomb
#then remove the pass blocks on the statue placeholders
if(check tag(595)) then(
write pass block(5,64,0)
write pass block(9,64,0)
write pass block(5,67,0)
write pass block(9,67,0)
)

end
###

#####################
script, broinn, begin
suspend player
suspend npcs
suspend obstruction

set tag(258,0)

jig npc(4)
tb(7805)
tb(7806)

if(check tag(258)) then(
	wait(2)
	palout(2)

	innfancy

	set hp
	wait(1)
	teleport to map(5+poff,6,254)
	suspend npcs
	innrest
	wait(15)

	#end part
	set party out
	swap by position(find hero(0),0)
	wait(1)
	pan camera(south,0,0)
	set hero position(0,6,252)
	set hero direction(0,down)
	hero clothes
	if(check tag(85)) then(set npc position(1,8,252))
	if(check tag(86)) then(set npc position(2,6,256))
	if(check tag(87)) then(set npc position(3,8,256))
	set hero speed(0,2)
	alter npc(1,NPCstat:movespeed,2)
	alter npc(2,NPCstat:movespeed,2)
	alter npc(3,NPCstat:movespeed,2)
	wait(10)
	palin(2)

	wait(4)

	walk hero(0,left,1)
	walk npc(1,left,1)
	walk npc(2,left,1)
	walk npc(3,left,1)
	wait for hero(0)
	walk hero(0,down,2)
	walk npc(1,down,2)
	walk npc(2,up,2)
	walk npc(3,up,2)
	wait for hero(0)
	walk hero(0,right,1)
	walk npc(1,left,1)
	walk npc(2,right,1)
	walk npc(3,left,1)
	wait for hero(0)
	set npc position(1,0,0)
	set npc position(2,0,0)
	set npc position(3,0,0)

	set party in
	wait(2)
	set hero direction(0,down)
	wait(2)
	set hero speed(0,hspeed)
	camera follows hero(0)
	alter npc(4,NPCstat:script,0)
	alter npc(4,NPCstat:displaytext,7807)
	save game
)
else(
	jig npc(4)
	tb(7808)
	tb(7809)
)

resume obstruction
resume npcs
resume player
end
###

##########################
script, bunnyhophop, begin
suspend player
suspend npcs
suspend hero walls
suspend obstruction

set party out
if(hero by slot(0)==-1) then(
	if(hero by slot(1)==-1) then(
		if(hero by slot(2)==-1) then(swap by position(0,3))
		else(swap by position(0,2))
	)
	else(swap by position(0,1))

)

if(hero by slot(1)==-1) then(
	if(hero by slot(2)==-1) then(swap by position(1,3))
	else(swap by position(1,2))
)

variable(saveheropic1)
variable(saveheropic2)
variable(saveheropic3)
variable(saveheropal1)
set variable(saveheropic1,getheropicture(1))
set variable(saveheropic2,getheropicture(2))
set variable(saveheropic3,getheropicture(3))
set variable(saveheropal1,getheropalette(1))

set hero picture(1,0)
set hero picture(2,0)
set hero picture(3,0)

set caterpillar mode (ON)
set hero position(1,herox(0),heroy(0))

#setting up the bunny
set hero picture(1,306)
set hero palette(1,random(189,464))
set hero speed(1,4)

#walk the bunny
set hero direction(0,down)
walk hero(1,down,1)
wait for hero(1)
walk hero(1,left,1)
wait for hero(1)
walk hero(1,up,1)
set hero direction(0,left)
wait for hero(1)
walk hero(1,up,1)
wait for hero(1)
walk hero(1,right,1)
set hero direction(0,up)
wait for hero(1)
walk hero(1,right,1)
wait for hero(1)
walk hero(1,down,1)
set hero direction(0,right)
wait for hero(1)
walk hero(1,down,1)
wait for hero(1)
walk hero(1,left,1)
set hero direction(0,down)
wait for hero(1)
walk hero(1,up,1)
wait for hero(1)

set caterpillar mode (OFF)

set hero picture(1,saveheropic1)
set hero picture(2,saveheropic2)
set hero picture(3,saveheropic3)
set hero palette(1,saveheropal1)

set party in

#if that was the first time, give waddi item
if(check tag(650)==false) then(
	set tag(650,1)
	get item(203,1)
	tb(7821)
)

resume obstruction
resume hero walls
resume npcs
resume player
end
###

########################
script, clockitem, begin
suspend player
suspend npcs

variable(twelvehundred)
variable(hoohah)
set variable(hoohah,1)
set variable(text1,currenttime)
set variable(text2,day)

#PM
if(text1>>1199,and,text1<<2500) then(
	set variable(text1,text1--1200)
	set variable(twelvehundred,2)
)
#AM
else(
	set variable(twelvehundred,1)
)

set variable(hm,(text1,mod,100))
set variable(text1,(text1--hm)/100)
#check to see if 12PM
if(text1==0) then(set variable(text1,12))

wait(2)

#AM
if(twelvehundred==1) then(
	#need a zero on the end?
	if((hm,mod,10)==0) then(
		show text box(7822)
		set variable(hoohah,2)
	)
	#need a zero on the start?
	if(hm<<10) then(
		show text box(7823)
		set variable(hoohah,2)
	)
	#minute is fine
	if(hoohah==1) then(
		show text box(7824)
	)
)
#PM
else(
	#need a zero on the end?
	if((hm,mod,10)==0) then(
		show text box(7825)
		set variable(hoohah,2)
	)
	#need a zero on the start?
	if(hm<<10) then(
		show text box(7826)
		set variable(hoohah,2)
	)
	#minute is fine
	if(hoohah==1) then(
		show text box(7827)
	)
)
wait for text box

resume npcs
resume player
end
###

##########################
script, intropolish, begin

intropolish1
intropolish2
intropolish3
intropolish4
intropolish5

end
###

###########################
script, intropolish1, begin
suspend box advance
palout(1)
teleport to map(0,29,6)
set hero picture(0,0)
load tileset(108)
wait(1)
stop song
palin(10)

#[Text 7811]Only one hundred seasons ago...
textout(1)
show text box(7811)
play song(19)
wait(15)
textin(4)
wait for key(usekey)
textout(4)
advance text box

#[Text 7812]The Time of Suffering
show text box(7812)
wait(15)
textin(4)
wait for key(usekey)
textout(4)
advance text box

variable(spire1)
variable(spire11)
variable(spire111)
variable(spire2)
variable(spire22)
variable(spire3)
variable(spire33)
variable(spire4)
variable(spire44)
variable(spire444)
set variable(spire1,create npc(5,47,4))
set variable(spire11,create npc(5,47,5))
set variable(spire111,create npc(5,47,6))
set variable(spire2,create npc(5,49,5))
set variable(spire22,create npc(5,49,6))
set variable(spire3,create npc(5,57,5))
set variable(spire33,create npc(5,57,6))
set variable(spire4,create npc(5,59,4))
set variable(spire44,create npc(5,59,5))
set variable(spire444,create npc(5,59,6))
alter npc(5,NPCstat:picture,608)
alter npc(5,NPCstat:palette,69)
alter npc(5,NPCstat:movespeed,2)

pan camera(right,16,4)
walk npc(spire1,left,8)
walk npc(spire11,left,8)
set npc direction(spire11,down)
walk npc(spire111,left,8)
set npc direction(spire111,right)
walk npc(spire2,left,8)
walk npc(spire22,left,8)
set npc direction(spire22,down)
walk npc(spire3,left,8)
walk npc(spire33,left,8)
set npc direction(spire33,down)
walk npc(spire4,left,8)
walk npc(spire44,left,8)
set npc direction(spire44,down)
walk npc(spire444,left,8)
set npc direction(spire444,right)
wait for camera
end
###

###########################
script, intropolish2, begin
#[Text 7813]As prophesized by numerous enemies of the nature of man,
show text box(7813)
wait(15)
textin(4)
wait for key(usekey)
textout(4)
advance text box

#[Text 7814]civilization ended at the hands of one creatures ambition.
show text box(7814)
wait(15)
textin(4)
wait for key(usekey)
textout(4)
advance text box
end
###

###########################
script, intropolish3, begin
write color(4+(6*16),0,read color(0,0))
write color(4+(6*16),1,read color(0,1))
write color(4+(6*16),2,read color(0,2))
write color(6+(6*16),0,read color(0,0))
write color(6+(6*16),1,read color(0,1))
write color(6+(6*16),2,read color(0,2))
update palette

alter npc(6,NPCstat:picture,609)
alter npc(6,NPCstat:palette,296)
create npc(6,45,5,down)
create npc(6,45,4,up)
create npc(6,46,5,left)
create npc(6,44,5,right)

wait(20)
reset palette
write color(4+(6*16),0,read color(0,0))
write color(4+(6*16),1,read color(0,1))
write color(4+(6*16),2,read color(0,2))
write color(6+(6*16),0,read color((6*16),0))
write color(6+(6*16),1,read color((6*16),1))
write color(6+(6*16),2,read color((6*16),2))
update palette
wait(3)
reset palette
write color(4+(6*16),0,read color(0,0))
write color(4+(6*16),1,read color(0,1))
write color(4+(6*16),2,read color(0,2))
write color(6+(6*16),0,read color(1+(6*16),0))
write color(6+(6*16),1,read color(1+(6*16),1))
write color(6+(6*16),2,read color(1+(6*16),2))
update palette
wait(3)
reset palette
write color(4+(6*16),0,read color((6*16),0))
write color(4+(6*16),1,read color((6*16),1))
write color(4+(6*16),2,read color((6*16),2))
write color(6+(6*16),0,read color(2+(6*16),0))
write color(6+(6*16),1,read color(2+(6*16),1))
write color(6+(6*16),2,read color(2+(6*16),2))
update palette
wait(3)
reset palette
write color(4+(6*16),0,read color(1+(6*16),0))
write color(4+(6*16),1,read color(1+(6*16),1))
write color(4+(6*16),2,read color(1+(6*16),2))
write color(6+(6*16),0,read color(3+(6*16),0))
write color(6+(6*16),1,read color(3+(6*16),1))
write color(6+(6*16),2,read color(3+(6*16),2))
update palette
wait(3)
reset palette
write color(4+(6*16),0,read color(2+(6*16),0))
write color(4+(6*16),1,read color(2+(6*16),1))
write color(4+(6*16),2,read color(2+(6*16),2))
write color(6+(6*16),0,read color(4+(6*16),0))
write color(6+(6*16),1,read color(4+(6*16),1))
write color(6+(6*16),2,read color(4+(6*16),2))
update palette
wait(3)
reset palette
write color(4+(6*16),0,read color(3+(6*16),0))
write color(4+(6*16),1,read color(3+(6*16),1))
write color(4+(6*16),2,read color(3+(6*16),2))
write color(6+(6*16),0,read color(5+(6*16),0))
write color(6+(6*16),1,read color(5+(6*16),1))
write color(6+(6*16),2,read color(5+(6*16),2))
update palette
wait(3)
reset palette
update palette

wait(30)

stop song
camera follows hero(0)
set hero position(0,9,19)
load tileset(111)
write color((5*16),0,read color(0,0))
write color((5*16),1,read color(0,1))
write color((5*16),2,read color(0,2))
write color(1+(5*16),0,read color(0,0))
write color(1+(5*16),1,read color(0,1))
write color(1+(5*16),2,read color(0,2))
write color(2+(5*16),0,read color(0,0))
write color(2+(5*16),1,read color(0,1))
write color(2+(5*16),2,read color(0,2))
write color(3+(5*16),0,read color(0,0))
write color(3+(5*16),1,read color(0,1))
write color(3+(5*16),2,read color(0,2))
write color(4+(5*16),0,read color(0,0))
write color(4+(5*16),1,read color(0,1))
write color(4+(5*16),2,read color(0,2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
end
###

###########################
script, intropolish4, begin
variable(thewait)
set variable(thewait,1)

wait(thewait)
reset palette
write color((5*16),0,read color((16*3),0))
write color((5*16),1,read color((16*3),1))
write color((5*16),2,read color((16*3),2))
write color(1+(5*16),0,read color(0,0))
write color(1+(5*16),1,read color(0,1))
write color(1+(5*16),2,read color(0,2))
write color(2+(5*16),0,read color(0,0))
write color(2+(5*16),1,read color(0,1))
write color(2+(5*16),2,read color(0,2))
write color(3+(5*16),0,read color(0,0))
write color(3+(5*16),1,read color(0,1))
write color(3+(5*16),2,read color(0,2))
write color(4+(5*16),0,read color(0,0))
write color(4+(5*16),1,read color(0,1))
write color(4+(5*16),2,read color(0,2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(1+(16*3),0))
write color((5*16),1,read color(1+(16*3),1))
write color((5*16),2,read color(1+(16*3),2))
write color(1+(5*16),0,read color((16*3),0))
write color(1+(5*16),1,read color((16*3),1))
write color(1+(5*16),2,read color((16*3),2))
write color(2+(5*16),0,read color(0,0))
write color(2+(5*16),1,read color(0,1))
write color(2+(5*16),2,read color(0,2))
write color(3+(5*16),0,read color(0,0))
write color(3+(5*16),1,read color(0,1))
write color(3+(5*16),2,read color(0,2))
write color(4+(5*16),0,read color(0,0))
write color(4+(5*16),1,read color(0,1))
write color(4+(5*16),2,read color(0,2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(2+(16*3),0))
write color((5*16),1,read color(2+(16*3),1))
write color((5*16),2,read color(2+(16*3),2))
write color(1+(5*16),0,read color(1+(16*3),0))
write color(1+(5*16),1,read color(1+(16*3),1))
write color(1+(5*16),2,read color(1+(16*3),2))
write color(2+(5*16),0,read color((16*3),0))
write color(2+(5*16),1,read color((16*3),1))
write color(2+(5*16),2,read color((16*3),2))
write color(3+(5*16),0,read color(0,0))
write color(3+(5*16),1,read color(0,1))
write color(3+(5*16),2,read color(0,2))
write color(4+(5*16),0,read color(0,0))
write color(4+(5*16),1,read color(0,1))
write color(4+(5*16),2,read color(0,2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(3+(16*3),0))
write color((5*16),1,read color(3+(16*3),1))
write color((5*16),2,read color(3+(16*3),2))
write color(1+(5*16),0,read color(2+(16*3),0))
write color(1+(5*16),1,read color(2+(16*3),1))
write color(1+(5*16),2,read color(2+(16*3),2))
write color(2+(5*16),0,read color(1+(16*3),0))
write color(2+(5*16),1,read color(1+(16*3),1))
write color(2+(5*16),2,read color(1+(16*3),2))
write color(3+(5*16),0,read color((16*3),0))
write color(3+(5*16),1,read color((16*3),1))
write color(3+(5*16),2,read color((16*3),2))
write color(4+(5*16),0,read color(0,0))
write color(4+(5*16),1,read color(0,1))
write color(4+(5*16),2,read color(0,2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(4+(16*3),0))
write color((5*16),1,read color(4+(16*3),1))
write color((5*16),2,read color(4+(16*3),2))
write color(1+(5*16),0,read color(3+(16*3),0))
write color(1+(5*16),1,read color(3+(16*3),1))
write color(1+(5*16),2,read color(3+(16*3),2))
write color(2+(5*16),0,read color(2+(16*3),0))
write color(2+(5*16),1,read color(2+(16*3),1))
write color(2+(5*16),2,read color(2+(16*3),2))
write color(3+(5*16),0,read color(1+(16*3),0))
write color(3+(5*16),1,read color(1+(16*3),1))
write color(3+(5*16),2,read color(1+(16*3),2))
write color(4+(5*16),0,read color((16*3),0))
write color(4+(5*16),1,read color((16*3),1))
write color(4+(5*16),2,read color((16*3),2))
write color(5+(5*16),0,read color(0,0))
write color(5+(5*16),1,read color(0,1))
write color(5+(5*16),2,read color(0,2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(5+(16*3),0))
write color((5*16),1,read color(5+(16*3),1))
write color((5*16),2,read color(5+(16*3),2))
write color(1+(5*16),0,read color(4+(16*3),0))
write color(1+(5*16),1,read color(4+(16*3),1))
write color(1+(5*16),2,read color(4+(16*3),2))
write color(2+(5*16),0,read color(3+(16*3),0))
write color(2+(5*16),1,read color(3+(16*3),1))
write color(2+(5*16),2,read color(3+(16*3),2))
write color(3+(5*16),0,read color(2+(16*3),0))
write color(3+(5*16),1,read color(2+(16*3),1))
write color(3+(5*16),2,read color(2+(16*3),2))
write color(4+(5*16),0,read color(1+(16*3),0))
write color(4+(5*16),1,read color(1+(16*3),1))
write color(4+(5*16),2,read color(1+(16*3),2))
write color(5+(5*16),0,read color((16*3),0))
write color(5+(5*16),1,read color((16*3),1))
write color(5+(5*16),2,read color((16*3),2))
write color(6+(5*16),0,read color(0,0))
write color(6+(5*16),1,read color(0,1))
write color(6+(5*16),2,read color(0,2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(5+(16*3),0))
write color(1+(5*16),1,read color(5+(16*3),1))
write color(1+(5*16),2,read color(5+(16*3),2))
write color(2+(5*16),0,read color(4+(16*3),0))
write color(2+(5*16),1,read color(4+(16*3),1))
write color(2+(5*16),2,read color(4+(16*3),2))
write color(3+(5*16),0,read color(3+(16*3),0))
write color(3+(5*16),1,read color(3+(16*3),1))
write color(3+(5*16),2,read color(3+(16*3),2))
write color(4+(5*16),0,read color(2+(16*3),0))
write color(4+(5*16),1,read color(2+(16*3),1))
write color(4+(5*16),2,read color(2+(16*3),2))
write color(5+(5*16),0,read color(1+(16*3),0))
write color(5+(5*16),1,read color(1+(16*3),1))
write color(5+(5*16),2,read color(1+(16*3),2))
write color(6+(5*16),0,read color((16*3),0))
write color(6+(5*16),1,read color((16*3),1))
write color(6+(5*16),2,read color((16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(5+(16*3),0))
write color(2+(5*16),1,read color(5+(16*3),1))
write color(2+(5*16),2,read color(5+(16*3),2))
write color(3+(5*16),0,read color(4+(16*3),0))
write color(3+(5*16),1,read color(4+(16*3),1))
write color(3+(5*16),2,read color(4+(16*3),2))
write color(4+(5*16),0,read color(3+(16*3),0))
write color(4+(5*16),1,read color(3+(16*3),1))
write color(4+(5*16),2,read color(3+(16*3),2))
write color(5+(5*16),0,read color(2+(16*3),0))
write color(5+(5*16),1,read color(2+(16*3),1))
write color(5+(5*16),2,read color(2+(16*3),2))
write color(6+(5*16),0,read color(1+(16*3),0))
write color(6+(5*16),1,read color(1+(16*3),1))
write color(6+(5*16),2,read color(1+(16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(6+(16*3),0))
write color(2+(5*16),1,read color(6+(16*3),1))
write color(2+(5*16),2,read color(6+(16*3),2))
write color(3+(5*16),0,read color(5+(16*3),0))
write color(3+(5*16),1,read color(5+(16*3),1))
write color(3+(5*16),2,read color(5+(16*3),2))
write color(4+(5*16),0,read color(4+(16*3),0))
write color(4+(5*16),1,read color(4+(16*3),1))
write color(4+(5*16),2,read color(4+(16*3),2))
write color(5+(5*16),0,read color(3+(16*3),0))
write color(5+(5*16),1,read color(3+(16*3),1))
write color(5+(5*16),2,read color(3+(16*3),2))
write color(6+(5*16),0,read color(2+(16*3),0))
write color(6+(5*16),1,read color(2+(16*3),1))
write color(6+(5*16),2,read color(2+(16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(6+(16*3),0))
write color(2+(5*16),1,read color(6+(16*3),1))
write color(2+(5*16),2,read color(6+(16*3),2))
write color(3+(5*16),0,read color(6+(16*3),0))
write color(3+(5*16),1,read color(6+(16*3),1))
write color(3+(5*16),2,read color(6+(16*3),2))
write color(4+(5*16),0,read color(5+(16*3),0))
write color(4+(5*16),1,read color(5+(16*3),1))
write color(4+(5*16),2,read color(5+(16*3),2))
write color(5+(5*16),0,read color(4+(16*3),0))
write color(5+(5*16),1,read color(4+(16*3),1))
write color(5+(5*16),2,read color(4+(16*3),2))
write color(6+(5*16),0,read color(3+(16*3),0))
write color(6+(5*16),1,read color(3+(16*3),1))
write color(6+(5*16),2,read color(3+(16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(6+(16*3),0))
write color(2+(5*16),1,read color(6+(16*3),1))
write color(2+(5*16),2,read color(6+(16*3),2))
write color(3+(5*16),0,read color(6+(16*3),0))
write color(3+(5*16),1,read color(6+(16*3),1))
write color(3+(5*16),2,read color(6+(16*3),2))
write color(4+(5*16),0,read color(6+(16*3),0))
write color(4+(5*16),1,read color(6+(16*3),1))
write color(4+(5*16),2,read color(6+(16*3),2))
write color(5+(5*16),0,read color(5+(16*3),0))
write color(5+(5*16),1,read color(5+(16*3),1))
write color(5+(5*16),2,read color(5+(16*3),2))
write color(6+(5*16),0,read color(4+(16*3),0))
write color(6+(5*16),1,read color(4+(16*3),1))
write color(6+(5*16),2,read color(4+(16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(6+(16*3),0))
write color(2+(5*16),1,read color(6+(16*3),1))
write color(2+(5*16),2,read color(6+(16*3),2))
write color(3+(5*16),0,read color(6+(16*3),0))
write color(3+(5*16),1,read color(6+(16*3),1))
write color(3+(5*16),2,read color(6+(16*3),2))
write color(4+(5*16),0,read color(6+(16*3),0))
write color(4+(5*16),1,read color(6+(16*3),1))
write color(4+(5*16),2,read color(6+(16*3),2))
write color(5+(5*16),0,read color(6+(16*3),0))
write color(5+(5*16),1,read color(6+(16*3),1))
write color(5+(5*16),2,read color(6+(16*3),2))
write color(6+(5*16),0,read color(5+(16*3),0))
write color(6+(5*16),1,read color(5+(16*3),1))
write color(6+(5*16),2,read color(5+(16*3),2))
update palette
wait(thewait)
reset palette
write color((5*16),0,read color(6+(16*3),0))
write color((5*16),1,read color(6+(16*3),1))
write color((5*16),2,read color(6+(16*3),2))
write color(1+(5*16),0,read color(6+(16*3),0))
write color(1+(5*16),1,read color(6+(16*3),1))
write color(1+(5*16),2,read color(6+(16*3),2))
write color(2+(5*16),0,read color(6+(16*3),0))
write color(2+(5*16),1,read color(6+(16*3),1))
write color(2+(5*16),2,read color(6+(16*3),2))
write color(3+(5*16),0,read color(6+(16*3),0))
write color(3+(5*16),1,read color(6+(16*3),1))
write color(3+(5*16),2,read color(6+(16*3),2))
write color(4+(5*16),0,read color(6+(16*3),0))
write color(4+(5*16),1,read color(6+(16*3),1))
write color(4+(5*16),2,read color(6+(16*3),2))
write color(5+(5*16),0,read color(6+(16*3),0))
write color(5+(5*16),1,read color(6+(16*3),1))
write color(5+(5*16),2,read color(6+(16*3),2))
write color(6+(5*16),0,read color(6+(16*3),0))
write color(6+(5*16),1,read color(6+(16*3),1))
write color(6+(5*16),2,read color(6+(16*3),2))
update palette
wait(thewait)

end
###

###########################
script, intropolish5, begin
#[Text 7815]The living knew only suffering and loss,
textout(1)
show text box(7815)
wait(20)
textin(4)
wait for key(usekey)
textout(4)
advance text box

#[Text 7816]the loss one feels when the leaves fade and fall, the autumn wind scattering them aimlessly.
show text box(7816)
wait(5)
textin(4)
wait for key(usekey)
textout(4)
advance text box

palout(1)
set hero position(0,9,6)
reset palette
wait(1)
write map block(8,4,12+(7*16))
write map block(9,4,13+(7*16))
write map block(10,4,14+(7*16))
write map block(8,5,12+(8*16))
write map block(9,5,13+(8*16))
write map block(10,5,14+(8*16))
write map block(9,6,13+(9*16))
wait(20)
play song(34)
palin(10)

#[Text 7817]One creature emerged from the darkness and gave the living hope.
textout(1)
show text box(7817)
wait(20)
textin(4)
wait for key(usekey)
textout(4)
advance text box

#[Text 7818]His ambition brought light to the ambition of a new generation.
show text box(7818)
wait(5)
textin(4)
wait for key(usekey)
textout(4)
advance text box

fade screen out(0,63,0)
set hero position(0,46,19)
wait(20)
fade screen in

#[Text 7819]He forged a sword unlike any seen before it, yet familiar to those who had endured.
show text box(7819)
wait(5)
textin(4)
wait for key(usekey)
textout(4)
advance text box

alter npc(7,NPCstat:picture,610)
alter npc(7,NPCstat:palette,1)
alter npc(7,NPCstat:movespeed,2)
alter npc(8,NPCstat:picture,611)
alter npc(8,NPCstat:palette,1)
alter npc(8,NPCstat:movespeed,2)
alter npc(9,NPCstat:picture,612)
alter npc(9,NPCstat:palette,1)
alter npc(9,NPCstat:movespeed,2)
variable(sevenup)
variable(sevenright)
variable(sevendown)
variable(sevenleft)
variable(eightup)
variable(eightright)
variable(eightdown)
variable(eightleft)
variable(nineup)
variable(nineright)
set variable(sevenup,create npc(7,14,19))
set variable(sevenright,create npc(7,15,19))
set variable(sevendown,create npc(7,16,19))
set variable(sevenleft,create npc(7,17,19))
set variable(eightup,create npc(8,18,19))
set variable(eightright,create npc(8,15,18))
set variable(eightdown,create npc(8,16,18))
set variable(eightleft,create npc(8,17,18))
set variable(nineup,create npc(9,15,17))
set variable(nineright,create npc(9,16,17))

wait(4)
pan camera(left,2,4)
wait for camera
pan camera(left,16,4)
walk npc(sevenup,right,8)
set npc direction(sevenup,up)
walk npc(sevenright,right,8)
walk npc(sevendown,right,8)
set npc direction(sevendown,down)
walk npc(sevenleft,right,8)
set npc direction(sevenleft,left)

walk npc(eightup,right,8)
set npc direction(eightup,up)
walk npc(eightright,right,8)
walk npc(eightdown,right,8)
set npc direction(eightdown,down)
walk npc(eightleft,right,8)
set npc direction(eightleft,left)

walk npc(nineup,right,8)
set npc direction(nineup,up)
walk npc(nineright,right,8)
wait(5)
set hero position(0,herox(0)--9,heroy(0))
wait for camera
wait(10)

#[Text 7820]He gave it to me, to oppress evil forever...
show text box(7820)
wait(5)
textin(4)
wait for key(usekey)
textout(4)
advance text box
wait(1)
reset palette
update palette

#set picture back to wanderer
set hero picture(0,98)
resume box advance
stop song
palout(1)
end
###

##################################
script, partytime, whichone, begin
suspend player

#1 Charbile
if(whichone==1) then(

	wait for npc(1)
	alter npc(1,NPCstat:movespeed,0)
	npcfaceplayer(1)

	#end the party
	if(check tag(656),and,check tag(657)) then(
		jig npc(1)
		tb(7890)
		tb(7891)
		jig npc(1)
		tb(7892)
		if(check tag(258)) then(
			jig npc(1)
			tb(7893)
			battleflash(1)
			fade screen out(0,0,0)
			show backdrop(0)
			ff(607)
			play song(99)
			show backdrop(0)
			suspend box advance
			palout(1)
			wait(2)
			show text box(7894)
			wait(5)
			palin(1)
			wait for key(usekey)
			palout(1)
			advance text box
			show text box(7895)
			wait(5)
			palin(1)
			wait for key(usekey)
			palout(1)
			advance text box
			show text box(7896)
			wait(5)
			palin(1)
			wait for key(usekey)
			palout(1)
			advance textbox
			show text box(7897)
			wait(5)
			palin(10)
			wait for key(usekey)
			advance text box
			wait(2)
			variable(loopla)
			for(loopla,1,10,1) do(
				showtextbox(7897)
				wait(2)
				advance text box
				wait(2)
			)
			fade screen out(0,0,0)
			show backdrop(2)
			wait(2)
			fade screen in
			game over
		)
	)
	else(
		jig npc(1)
		tb(7888)
	)

	alter npc(1,NPCstat:movespeed,1)
)

#2 FyreWulff
if(whichone==2) then(
	if(check tag(658),and,check tag(659)) then(
		if(check tag(640),and,check tag(641)) then(
			jig npc(2)
			tb(7900)
		)
		else(
			variable(hx)
			variable(hy)
			set variable(hx,herox(0))
			set variable(hy,heroy(0))
			jig npc(2)
			tb(8006)
			stop song
			palout(1)
			teleport to map(58,173,99)
			stop song
			wait(1)
			pan camera(south,0,0)
			set hero position(0,173,89)
			wait(1)
			palin(1)
			wait(20)
			palout(1)
			camera follows hero(0)
			set hero position(0,149,48)
			wait(1)
			pan camera(south,0,0)
			set hero position(0,149,38)
			wait(1)
			palin(1)
			wait(20)
			palout(1)
			camera follows hero(0)
			teleport to map(99,hx,hy)
			wait(1)
			palin(1)
		)
		set tag(658,0)
		set tag(659,0)
	)
	else(
		jig npc(2)
		tb(7898)
	)
)

#3 Fenrir
if(whichone==3) then(
	npcfaceplayer(3)
	wait for npc(3)
	alter npc(3,NPCstat:movespeed,0)
	jig npc(3)
	tb(7901)
	alter npc(3,NPCstat:movespeed,1)
)

#4 Gizmog
if(whichone==4) then(
	wait for npc(4)
	alter npc(4,NPCstat:movespeed,0)
	jig npc(4)
	tb(7907)
	alter npc(4,NPCstat:movespeed,1)
)

#5 Hachi-Roku
if(whichone==5) then(
	npcfaceplayer(5)
	wait for npc(5)
	alter npc(5,NPCstat:movespeed,0)
	jig npc(5)
	tb(7910)
	alter npc(5,NPCstat:movespeed,1)
)

#6 Harlock
if(whichone==6) then(
	npcfaceplayer(6)
	wait for npc(6)
	alter npc(6,NPCstat:movespeed,0)
	jig npc(6)
	tb(7915)
	alter npc(6,NPCstat:movespeed,1)
)

#7 Jazzman
if(whichone==7) then(
	npcfaceplayer(7)
	wait for npc(7)
	alter npc(7,NPCstat:movespeed,0)
	#royal dogero
	if(check tag(670),and,check tag(671)) then(
		show backdrop(46)
		set hero picture(find hero(0),32,insidebattle)
		set hero palette(find hero(0),469,insidebattle)
		set hero picture(find hero(0),629,outsidebattle)
		set hero palette(find hero(0),469,outsidebattle)
		wait(3)
		show map
		wait(2)
		jig npc(7)
		tb(7921)
	)
	else(
		jig npc(7)
		tb(7919)
	)
	alter npc(7,NPCstat:movespeed,1)
)

#8 Komera
if(whichone==8) then(
	npcfaceplayer(8)
	wait for npc(8)
	alter npc(8,NPCstat:movespeed,0)
	jig npc(8)
	tb(7922)
	alter npc(8,NPCstat:movespeed,1)
)

#9 LongeBane
if(whichone==9) then(
	wait for npc(9)
	alter npc(9,NPCstat:movespeed,0)
	jig npc(9)
	tb(7925)
	alter npc(9,NPCstat:movespeed,1)
)

#10 NeoTA
if(whichone==10) then(
	npcfaceplayer(10)
	wait for npc(10)
	alter npc(10,NPCstat:movespeed,0)
	jig npc(10)
	tb(7929)
	alter npc(10,NPCstat:movespeed,1)
)

#11 No_Shot
if(whichone==11) then(
	npcfaceplayer(11)
	wait for npc(11)
	alter npc(11,NPCstat:movespeed,0)
	jig npc(11)
	tb(7932)
	alter npc(11,NPCstat:movespeed,1)
)

#12 Orchard
if(whichone==12) then(
	npcfaceplayer(12)
	wait for npc(12)
	alter npc(12,NPCstat:movespeed,0)
	jig npc(12)
	tb(7935)
	alter npc(12,NPCstat:movespeed,1)
)

#13 Rinku
if(whichone==13) then(
	npcfaceplayer(13)
	wait for npc(13)
	alter npc(13,NPCstat:movespeed,0)
	jig npc(13)
	tb(7938)
	alter npc(13,NPCstat:movespeed,1)
)

#14 Mad Cacti
if(whichone==14) then(
	wait for npc(14)
	alter npc(14,NPCstat:movespeed,0)
	jig npc(14)
	tb(7945)
	alter npc(14,NPCstat:movespeed,1)
)

#15 Hat
if(whichone==15) then(
	wait for npc(15)
	alter npc(15,NPCstat:movespeed,0)
	jig npc(15)
	tb(7904)
	alter npc(15,NPCstat:movespeed,1)
)

#16 Giant Spider
if(whichone==16) then(
	npcfaceplayer(16)
	wait for npc(16)
	alter npc(16,NPCstat:movespeed,0)
	jig npc(16)
	tb(7918)
	alter npc(16,NPCstat:movespeed,1)
)

#17 SOJPD IS BORN sign
if(whichone==17) then(
	tb(7948)
)

#18 Numbers sign
if(whichone==18) then(
	tb(7949)
	tb(7950)
)

#19 ABC sign
if(whichone==19) then(
	variable(abc)
	for(abc,0,26,1) do(
		tb(7951+abc)
		wait(1)
	)
)

#20 website plug
if(whichone==20) then(
	show backdrop(7)
	wait(3)
	show text box(7978)
	show map
	wait for text box
)

#21 Pug
if(whichone==21) then(
	npcfaceplayer(21)
	wait for npc(21)
	alter npc(21,NPCstat:movespeed,0)
	jig npc(21)
	tb(7887)
	alter npc(21,NPCstat:movespeed,1)
)

#22 victory
if(whichone==22) then(
	jig npc(22)
	tb(7885)
)

#23 error
if(whichone==23) then(
	jig npc(23)
	tb(7886)
)

#24 happy face
if(whichone==24) then(
	npcfaceplayer(24)
	wait for npc(24)
	alter npc(24,NPCstat:movespeed,0)
	if(check tag(706),and,check tag(707)) then(
		set tag(716,1)
		jig npc(24)
		tb(8021)
		set tag(716,0)
		set tag(706,0)
		set tag(707,0)
	)
	else(
		if(check tag(706)) then(
			jig npc(24)
			tb(8020)
			set tag(707,1)
		)
		else(
			jig npc(24)
			tb(8019)
			set tag(706,1)
		)
	)
	alter npc(24,NPCstat:movespeed,2)
)

#25 King Haggard
if(whichone==25) then(
	if(check tag(708),and,check tag(709)) then(
		hithaggard
		set tag(708,0)
		set tag(709,0)
	)
	else(
		if(check tag(708)) then(
			jig npc(25)
			tb(8024)
			set tag(709,1)
		)
		else(
			jig npc(25)
			tb(8023)
			set tag(708,1)
		)
	)
)

resume player
end
###

#############################
script, nixescapefinal, begin
	suspend player
	pan camera(down,3,5)
	wait(2)
	set hero direction(0,right)
	wait(2)
	set hero direction(0,down)
	wait for camera
	set npc direction(npc at spot(5,64),right)
	set npc direction(npc at spot(9,64),right)
	set npc direction(npc at spot(5,67),right)
	set npc direction(npc at spot(9,67),right)
	wait(4)
	set npc direction(npc at spot(5,64),up)
	set npc direction(npc at spot(9,64),up)
	set npc direction(npc at spot(5,67),up)
	set npc direction(npc at spot(9,67),up)
	wait(15)
	pan camera(up,3,10)
	write pass block(5,64,0)
	write pass block(9,64,0)
	write pass block(5,67,0)
	write pass block(9,67,0)
	alter npc(8,NPCstat:script,303)
	alter npc(8,NPCstat:scriptargument,8)
	alter npc(8,NPCstat:movespeed,10)
	alter npc(8,NPCstat:activation,NPCactivation:touch)
	alter npc(9,NPCstat:script,303)
	alter npc(9,NPCstat:scriptargument,9)
	alter npc(9,NPCstat:movespeed,10)
	alter npc(9,NPCstat:activation,NPCactivation:touch)
	wait for camera
	camera follows hero(0)
	set tag(596,1)
	write pass block(7,65,1+2+4+8)
	resume player
end
###

########################
script, partydoor, begin
suspend player

variable(skipero)
set variable(skipero,0)

#at the party
if(herox(0)==30,and,heroy(0)==8) then(
	set variable(skipero,1)
	palout(1)
	set hp
	set hero direction(0,down)
	teleport to map(53+poff,51,38)
	palin(3)
)

#not at the party
if(herox(0)==51,and,heroy(0)==38,and,skipero==0) then(
	if(check tag(686)) then(
		palout(1)
		set pal(noon)
		set hero direction(0,down)
		teleport to map(99,30,9)
		wait(1)
		palin(1)
	)
	else(
		play song(2)
		tweak palette(63,63,63)
		update palette
		wait(2)
		reset palette
		update palette
		wait(2)
		reset palette
		tweak palette(5,5,5)
		tweak palette(10,0,10)
		update palette
		wait(5)
		reset palette
		tweak palette(0,0,0)
		tweak palette(10,0,10)
		update palette
		wait(5)
		reset palette
		tweak palette(-5,-5,-5)
		tweak palette(10,0,10)
		update palette
		wait(5)
		reset palette
		tweak palette(-10,-10,-10)
		tweak palette(10,0,10)
		update palette
		wait(5)
		tb(7880)
		if(check tag(258)) then(
			#stop song
			set tag(686,1)
			palout(1)
			wait(1)
			teleport to map(0,0,0)
			wait(1)
			palin(1)
			ftextout(1)
			suspend box advance
			show text box(7881)
			wait(5)
			ftextin(2)
			wait for key(use key)
			ftextout(2)
			advance text box
			show text box(7882)
			wait(5)
			ftextin(2)
			wait for key(use key)
			ftextout(2)
			advance text box
			show text box(7883)
			wait(5)
			ftextin(2)
			wait for key(use key)
			ftextout(2)
			advance text box
			#ftextin(1)
			wait(30)
			show backdrop(7)
			wait(4)
			show map
			#text out(1)
			play song(0)
			show text box(7884)
			wait(5)
			ftextin(2)
			wait for key(use key)
			ftextout(2)
			advance text box
			resume box advance
			set pal(noon)
			set hero direction(0,down)
			teleport to map(99,30,9)
			wait(1)
			palin(1)
		)
		else(
			stop song
			reset palette
			tweak palette(-10,-10,-10)
			tweak palette(10,0,10)
			update palette
			wait(5)
			reset palette
			tweak palette(-5,-5,-5)
			tweak palette(10,0,10)
			update palette
			wait(5)
			reset palette
			tweak palette(0,0,0)
			tweak palette(10,0,10)
			update palette
			wait(5)
			reset palette
			tweak palette(5,5,5)
			tweak palette(10,0,10)
			update palette
			wait(5)
			reset palette
			update palette
			if(check tag(3)) then(play song(76))
			if(check tag(4)) then(play song(76))
			if(check tag(5)) then(play song(76))
			if(check tag(6)) then(play song(4))
		)
	)
)

resume player
end
###

###############################
script, keltanindoorload, begin
#if raider battle, play the raider attack song
if(check tag(385)) then(play song(5))
end
###

#############################
script, fralinautoload, begin

#if fralin npcs dead due to dormant monster, play the breeze fx
if(check tag(297)) then(play song(17))

end
###

###############################
script, secrettoeveryone, begin
suspend player
suspend npcs

#have already unlocked
if(check tag(705)) then(
palout(1)
set hero position(0,56,134)
set hero direction(0,down)
wait(1)
palin(1)
)

#init!
else(

palout(1)
variable(heropic)
set variable(heropic,get hero picture(0))
set hero picture(0,0)
teleport to map(99,30,15)
set npc direction(1,down)
wait(1)
palin(1)

wait(5)

jig npc(1)
tb(8007)
variable(nx)
variable(ny)
set variable(nx, npc pixel x(1))
set variable(ny, npc pixel y(1))
put npc(1,nx,ny)
wait(2)
put npc(1,nx,ny--3)
wait(2)
put npc(1,nx,ny)
wait(2)
put npc(1,nx,ny--3)
wait(2)
put npc(1,nx,ny)
wait(2)
put npc(1,nx,ny--3)
wait(2)
put npc(1,nx,ny)
tb(8008)
wait(5)
jig npc(2)
show text box(8009)
wait(2)
set npc direction(1,right)
wait for text box
wait(5)
show backdrop(46)
set debug keys disable(OFF)
wait(3)
show map
tb(8010)
wait(3)
jig npc(2)
show text box(8011)
wait(2)
set npc direction(1,down)
wait for text box
wait(2)

palout(1)
show backdrop(0)
wait(1)
palin(1)
wait(10)

tb(8012)
tb(8013)
tb(8014)
tb(8015)
tb(8016)
tb(8017)

wait(10)
palout(1)
show map
teleport to map(66,56,134)
play song(92)
set hero picture(0,heropic)
set hero direction(0,down)
wait(1)
palin(1)

set tag(705,1)
)

resume npcs
resume player
end
###

#########################
script, hithaggard, begin

pan camera(south,0,0)

variable(nx)
variable(ny)
set variable(nx,npc pixel x(25))
set variable(ny,npc pixel y(25))
variable(hag)
if(hero direction(0)==up) then(set variable(hag,1))
if(hero direction(0)==down) then(set variable(hag,2))
if(hero direction(0)==left) then(set variable(hag,3))
if(hero direction(0)==right) then(set variable(hag,4))

#up
if(hag==1) then(
#put hero(0,nx,ny+15)
#wait(1)
put hero(0,nx,ny+10)
wait(1)
#put hero(0,nx,ny+5)
#wait(1)
show backdrop(46)
suspend box advance
put hero(0,nx,ny+20)
show text box(8025)
wait(3)
show map
resume box advance
)
#down
if(hag==2) then(
#put hero(0,nx,ny--15)
#wait(1)
put hero(0,nx,ny--10)
wait(1)
#put hero(0,nx,ny--5)
#wait(1)
show backdrop(46)
suspend box advance
put hero(0,nx,ny--20)
show text box(8025)
wait(3)
show map
resume box advance
)
#left
if(hag==3) then(
#put hero(0,nx+15,ny)
#wait(1)
put hero(0,nx+10,ny)
wait(1)
#put hero(0,nx+5,ny)
#wait(1)
show backdrop(46)
suspend box advance
put hero(0,nx+20,ny)
show text box(8025)
wait(3)
show map
resume box advance
)
#right
if(hag==4) then(
#put hero(0,nx--15,ny)
#wait(1)
put hero(0,nx--10,ny)
wait(1)
#put hero(0,nx--5,ny)
#wait(1)
show backdrop(46)
suspend box advance
put hero(0,nx--20,ny)
show text box(8025)
wait(3)
show map
resume box advance
)

wait for text box

camera follows hero(0)

end
###

#################################
script, npcfaceplayer, num, begin
if(herox(0)<<npcx(num)) then(set npc direction(num,left))
if(herox(0)>>npcx(num)) then(set npc direction(num,right))
if(heroy(0)<<npcy(num)) then(set npc direction(num,up))
if(heroy(0)>>npcy(num)) then(set npc direction(num,down))
end
###

###############################
script, skillitemtrigger, begin
skillitem
end
###

#########################
script, scarf1auto, begin
if(check tag(717)) then(
	set npc position(5,50,80)
	set npc direction(5,right)
)
end
###